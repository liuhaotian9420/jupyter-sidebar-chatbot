"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[8735],{66195:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.ApiClient=void 0;class n{constructor(e="http://localhost:8000"){this.baseUrl=e}async streamChat(e,t=null,n,o,i){try{const i=await fetch(`${this.baseUrl}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,context:t})});if(!i.ok){throw new Error(`API error: ${i.statusText}`)}if(!i.body){throw new Error("ReadableStream not supported in this browser.")}const s=i.body.getReader();const r=new TextDecoder;let a=false;while(!a){const{value:e,done:t}=await s.read();a=t;if(e){const t=r.decode(e,{stream:!a});n(t)}}o()}catch(s){i(s instanceof Error?s:new Error(String(s)))}}async healthCheck(){try{const e=await fetch(`${this.baseUrl}/health`);return e.ok}catch(e){console.error("API health check failed:",e);return false}}}t.ApiClient=n},64556:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.CellContextTracker=void 0;class n{constructor(e,t){this.activeCellEditorNode=null;this.lastCellContext=null;this._isDisposed=false;this.handleEditorEvent=e=>{try{const e=this.notebookTracker.activeCell;if(!e||!e.editor)return;const t=e.editor;const n=t.editor;if(!n)return;this.lastCellContext=this.getCmContext(n)}catch(t){console.error("Error in editor event handler:",t)}};this.notebookTracker=t;this.setupTrackers()}get isDisposed(){return this._isDisposed}setupTrackers(){this.notebookTracker.activeCellChanged.connect(this.setupCellListeners,this);this.notebookTracker.currentChanged.connect(this.handleNotebookChange,this)}handleNotebookChange(e,t){this.cleanupPreviousListeners();if(t&&t.content){const n=t.content.activeCell;this.setupCellListeners(e,n)}}setupCellListeners(e,t){if(!t)return;this.cleanupPreviousListeners();if(t.editor){try{const e=t.node;const n=e.querySelector(".jp-Editor")||e.querySelector(".jp-InputArea-editor");if(n){this.activeCellEditorNode=n;n.addEventListener("keydown",this.handleEditorEvent);n.addEventListener("mouseup",this.handleEditorEvent);const e=t.editor.editor;if(e){this.lastCellContext=this.getCmContext(e)}}}catch(n){console.error("Error setting up cell listeners:",n)}}}cleanupPreviousListeners(){if(this.activeCellEditorNode){this.activeCellEditorNode.removeEventListener("keydown",this.handleEditorEvent);this.activeCellEditorNode.removeEventListener("mouseup",this.handleEditorEvent);this.activeCellEditorNode=null}}getCmContext(e){const t=e.state;const n=t.selection.main.head;const o=t.doc.toString();const i=t.doc.lineAt(n);const s={line:i.number-1,column:n-i.from,offset:n};const r=100;const a=Math.max(0,n-r);const l=Math.min(o.length,n+r);return{text:o,position:s,contextBefore:o.substring(a,n),contextAfter:o.substring(n,l)}}getCurrentCellContext(){return this.lastCellContext}dispose(){if(this._isDisposed){return}this._isDisposed=true;this.cleanupPreviousListeners();this.notebookTracker.activeCellChanged.disconnect(this.setupCellListeners,this);this.notebookTracker.currentChanged.disconnect(this.handleNotebookChange,this)}}t.CellContextTracker=n},22485:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:true});t.registerCommands=i;const o=n(77693);function i(e,t,n,i){e.commands.addCommand("simple-extension:toggle-sidebar",{label:"Toggle AI Assistant Sidebar",icon:o.extensionIcon,execute:()=>{if(i.isAttached){i.parent=null}else{e.shell.add(i,"left",{rank:9999})}}});t.addItem({command:"simple-extension:toggle-sidebar",category:"Extension"});n.add({command:"simple-extension:toggle-sidebar",category:"Other",rank:9999})}},96095:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.globals=void 0;t.initGlobals=n;t.globals={};function n(e,n){t.globals.app=e;t.globals.notebookTracker=n}},77693:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:true});t.extensionIcon=void 0;const o=n(75037);const i='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-text" viewBox="0 0 16 16">'+'<path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>'+'<path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>'+"</svg>";t.extensionIcon=new o.LabIcon({name:"simple:icon",svgstr:i})},88735:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:true});t.ApiClient=void 0;const o=n(18093);const i=n(96312);const s=n(89275);const r=n(86043);const a=n(43820);const l=n(96095);const c=n(22485);const d=n(64556);n(56531);var h=n(66195);Object.defineProperty(t,"ApiClient",{enumerable:true,get:function(){return h.ApiClient}});const p={id:"jupyter-simple-extension:plugin",autoStart:true,requires:[o.ILauncher,i.ICommandPalette,s.INotebookTracker,r.IDocumentManager],activate:(e,t,n,o,i)=>{console.log("JupyterLab extension jupyter-simple-extension is activated!");(0,l.initGlobals)(e,o);l.globals.cellContextTracker=new d.CellContextTracker(e,o);const s=new a.SimpleSidebarWidget(i);e.shell.add(s,"left",{rank:9999});(0,c.registerCommands)(e,n,t,s)}};t["default"]=p},65937:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:true});t.configureMarked=i;t.preprocessMarkdown=s;const o=n(14507);function i(){o.marked.setOptions({gfm:true,breaks:true,pedantic:false,async:false,silent:false})}function s(e){let t=false;const n=e.split("\n");const o=n.map(((e,n)=>{if(e.trim().startsWith("```")){t=!t;return e.trim()}if(t){return e}return e.replace(/([^\n\s])-\s/g,"$1\n- ")}));return o.join("\n")}},30135:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:true});t.PopupMenuManager=void 0;const o=n(96095);class i{constructor(e,t,n){this.currentMenuLevel="top";this.currentMenuPath="";this.menuHistory=[];this.currentNotebook=null;this.docManager=e;this.widgetNode=t;this.callbacks=n;this.popupMenuContainer=document.createElement("div");this.popupMenuContainer.className="jp-llm-ext-popup-menu-container";this.popupMenuContainer.style.display="none";this.widgetNode.appendChild(this.popupMenuContainer);document.addEventListener("click",this.handleDocumentClick.bind(this),true);if(o.globals.notebookTracker){this.currentNotebook=o.globals.notebookTracker.currentWidget;o.globals.notebookTracker.currentChanged.connect(((e,t)=>{this.currentNotebook=t}))}}dispose(){document.removeEventListener("click",this.handleDocumentClick.bind(this),true);if(this.popupMenuContainer.parentNode===this.widgetNode){this.popupMenuContainer.parentNode.removeChild(this.popupMenuContainer)}}handleDocumentClick(e){if(this.popupMenuContainer.style.display!=="none"&&!this.popupMenuContainer.contains(e.target)){const t=this.widgetNode.querySelector("#jp-llm-ext-at-button");if(t&&t.contains(e.target)){console.log("POPUP: Click was on the @ button, not hiding.");return}console.log("POPUP: Click detected outside the menu.");this.hidePopupMenu()}}async showPopupMenu(e,t){console.log(`POPUP: Showing menu at (${e}, ${t})`);if(this.popupMenuContainer.style.display==="none"){this.currentMenuLevel="top";this.currentMenuPath="";this.menuHistory=[];await this.setCurrentDirectoryPath()}await this.renderMenuContent();this.widgetNode.appendChild(this.popupMenuContainer);this.popupMenuContainer.style.position="absolute";this.popupMenuContainer.style.left=`${e}px`;this.popupMenuContainer.style.top=`${t}px`;this.popupMenuContainer.style.display="block"}hidePopupMenu(){if(this.popupMenuContainer.style.display!=="none"){console.log("POPUP: Hiding menu.");this.popupMenuContainer.style.display="none"}}async renderMenuContent(){console.log(`POPUP: Rendering content for level: ${this.currentMenuLevel}, path: ${this.currentMenuPath}`);this.popupMenuContainer.innerHTML="";if(this.menuHistory.length>0){const e=this.createMenuItem("â† Back","navigate-back","","Return to previous menu");this.popupMenuContainer.appendChild(e)}if(this.currentMenuLevel==="files"||this.currentMenuLevel==="directories"){const e=document.createElement("div");e.className="jp-llm-ext-popup-menu-path";e.textContent=`Path: ${this.currentMenuPath||"/"}`;this.popupMenuContainer.appendChild(e)}if(this.currentMenuLevel==="top"){this.renderTopLevelItems()}else if(this.currentMenuLevel==="files"||this.currentMenuLevel==="directories"){await this.renderDirectoryBrowserItems()}}renderTopLevelItems(){const e=[{label:"Code",description:"Insert selected code",actionId:"insert-code"},{label:"Cell",description:"Insert entire cell content",actionId:"insert-cell"},{label:"File",description:"Browse and select a file",actionId:"browse-files"},{label:"Directory",description:"Browse and select a directory",actionId:"browse-directories"}];e.forEach((e=>{const t=this.createMenuItem(e.label,e.actionId,"",e.description);this.popupMenuContainer.appendChild(t)}))}async renderDirectoryBrowserItems(){const e=this.createMenuItem("Loading...","loading","","");e.style.pointerEvents="none";this.popupMenuContainer.appendChild(e);try{const t=this.currentMenuLevel==="files"?"file":"directory";const n=await this.listCurrentDirectoryContents(this.currentMenuPath,t);this.popupMenuContainer.removeChild(e);if(n&&n.length>0){n.forEach((e=>{const t=e.name;const n=e.type;const o=e.path;const i=n==="directory"?"ðŸ“":"ðŸ“„";const s=n==="directory"?"select-directory":"select-file";const r=this.createMenuItem(`${i} ${t}`,s,o);this.popupMenuContainer.appendChild(r)}))}else{const e=this.createMenuItem(`No ${t}s found`,"empty","","");e.style.pointerEvents="none";this.popupMenuContainer.appendChild(e)}}catch(t){if(this.popupMenuContainer.contains(e)){this.popupMenuContainer.removeChild(e)}const n=this.createMenuItem(`Error: ${t}`,"error","","");n.style.color="red";n.style.pointerEvents="none";this.popupMenuContainer.appendChild(n);console.error("POPUP: Error loading directory contents:",t)}}createMenuItem(e,t,n="",o=""){const i=document.createElement("div");i.className="jp-llm-ext-popup-menu-item";i.dataset.actionId=t;if(n){i.dataset.path=n}i.onclick=e=>this.handleMenuClick(e);const s=document.createElement("span");s.textContent=e;i.appendChild(s);if(o){s.style.fontWeight="bold";const e=document.createElement("span");e.textContent=o;e.style.display="block";e.style.fontSize="0.8em";e.style.color="var(--jp-ui-font-color2)";i.appendChild(e)}return i}async handleMenuClick(e){const t=e.currentTarget;const n=t.dataset.actionId;const o=t.dataset.path||"";console.log(`POPUP: Menu item clicked. Action: ${n}, Path: ${o}`);switch(n){case"navigate-back":this.navigateBackMenu();break;case"insert-code":{const e=this.callbacks.getSelectedText?this.callbacks.getSelectedText():null;if(e){this.callbacks.insertCode(e)}else{const e=this.callbacks.getCurrentCellContent?this.callbacks.getCurrentCellContent():null;if(e){this.callbacks.insertCode(e)}}this.hidePopupMenu();break}case"insert-cell":{const e=this.callbacks.getCurrentCellContent?this.callbacks.getCurrentCellContent():null;if(e){this.callbacks.insertCell(e)}this.hidePopupMenu();break}case"browse-files":await this.navigateMenu("files",this.currentMenuPath||"");break;case"browse-directories":await this.navigateMenu("directories",this.currentMenuPath||"");break;case"select-file":if(o){this.callbacks.insertFilePath(o);this.hidePopupMenu()}else{console.error("POPUP: File selected but path is missing.")}break;case"select-directory":if(o){await this.navigateMenu("files",o)}else{console.error("POPUP: Directory selected but path is missing.")}break;case"placeholder-action":console.log("Placeholder action triggered.");this.hidePopupMenu();break;case"loading":case"empty":case"error":break;default:console.warn("Unknown menu action:",n);this.hidePopupMenu();break}e.stopPropagation()}async navigateMenu(e,t){console.log(`POPUP: Navigating to level: ${e}, path: ${t}`);this.menuHistory.push({level:this.currentMenuLevel,path:this.currentMenuPath});this.currentMenuLevel=e;this.currentMenuPath=t;await this.renderMenuContent()}navigateBackMenu(){const e=this.menuHistory.pop();if(e){console.log(`POPUP: Navigating back to level: ${e.level}, path: ${e.path}`);this.currentMenuLevel=e.level;this.currentMenuPath=e.path;this.renderMenuContent()}else{console.log("POPUP: Already at the top level.");this.hidePopupMenu()}}async listCurrentDirectoryContents(e,t){console.log(`POPUP: Listing directory contents for path: '${e}', filter: ${t||"all"}`);try{const n=e==="/"?"":e;const o=await this.docManager.services.contents.get(n);if(o.type==="directory"){let e=o.content.map((e=>({name:e.name,path:e.path,type:e.type})));e=e.filter((e=>e.type==="file"||e.type==="directory"));if(t){e=e.filter((e=>e.type===t))}console.log("Directory items:",e);return e.sort(((e,t)=>e.name.localeCompare(t.name)))}else{console.error("Path is not a directory:",e);return null}}catch(n){console.error("Error listing directory contents:",n);return null}}async setCurrentDirectoryPath(){var e;let t=null;const n=o.globals.app;if(!n){console.error("POPUP: Application reference not available");this.currentMenuPath="";return}const i=n.shell.currentWidget;if(i){const e=this.docManager.contextForWidget(i);if(e){const n=e.path;t=this.getParentDirectory(n);console.log(`POPUP: Path from current widget context: ${n} -> ${t}`)}}if(t===null&&this.currentNotebook&&this.currentNotebook.context){const e=this.currentNotebook.context.path;if(typeof e==="string"){t=this.getParentDirectory(e);console.log(`POPUP: Path from active notebook: ${e} -> ${t}`)}}if(t===null){try{const o=Array.from(n.shell.widgets("left"));const i=o.find((e=>e.id==="filebrowser"));if(i&&((e=i.model)===null||e===void 0?void 0:e.path)){t=i.model.path;console.log(`POPUP: Path from file browser widget model: ${t}`)}else{console.log("POPUP: File browser widget path not directly accessible.")}}catch(s){console.warn("POPUP: Could not get path from file browser.",s)}}if(t===null){t="";console.log("POPUP: Falling back to server root path.")}this.currentMenuPath=t;console.log(`POPUP: Initial current menu path set to: '${this.currentMenuPath}'`)}getParentDirectory(e){if(!e)return"";const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\\\"));if(t===-1)return"";return e.substring(0,t)}}t.PopupMenuManager=i},43820:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.SimpleSidebarWidget=void 0;const i=n(1143);const s=n(14507);const r=o(n(59764));const a=n(77693);const l=n(96095);const c=n(66195);const d=n(65937);const h=n(30135);(0,d.configureMarked)();class p extends i.Widget{constructor(e){super();this.isMarkdownMode=false;this.isInputExpanded=false;this.chatHistory=[];this.currentChatId="";this.isHistoryViewActive=false;this.handleKeyDown=e=>{var t,n;if(e.ctrlKey&&e.key.toLowerCase()==="l"){e.preventDefault();e.stopPropagation();const i=(t=l.globals.notebookTracker)===null||t===void 0?void 0:t.activeCell;if(!i||!i.editor){return}try{const e=i.editor;const t=e.editor;if(!t){return}const o=t.state;const s=o.selection;if(!s.main.empty){const e=s.main.from;const t=s.main.to;const n=o.doc.sliceString(e,t);this.appendToInput(`@code\n${n}`);this.showKeyboardShortcutIndicator("Selected code inserted")}else{const e=(n=l.globals.cellContextTracker)===null||n===void 0?void 0:n.getCurrentCellContext();if(e){this.appendToInput(`@cell\n${e.text}`);this.showKeyboardShortcutIndicator("Cell content inserted")}}if(this.isHidden){this.show()}this.inputField.focus()}catch(o){console.error("Error handling keyboard shortcut:",o)}}};this.docManager=e;this.id="simple-sidebar";this.title.label="";this.title.caption="AI Chat Interface";this.title.icon=a.extensionIcon;this.title.closable=true;this.addClass("jp-llm-ext-sidebar");this.apiClient=new c.ApiClient;this.messageContainer=document.createElement("div");this.inputContainer=document.createElement("div");this.inputField=document.createElement("textarea");this.titleInput=document.createElement("input");this.historyContainer=document.createElement("div");this.keyboardShortcutIndicator=document.createElement("div");this.keyboardShortcutIndicator.className="jp-llm-ext-keyboard-shortcut-indicator";this.node.appendChild(this.keyboardShortcutIndicator);this.settingsModalContainer=this.createSettingsModal();this.node.appendChild(this.settingsModalContainer);this.popupMenuManager=new h.PopupMenuManager(this.docManager,this.node,{insertCode:e=>this.appendToInput(`@code\n${e}`),insertCell:e=>this.appendToInput(`@cell\n${e}`),insertFilePath:e=>this.appendToInput(`@file\n${e}`),insertDirectoryPath:e=>this.appendToInput(`@directory\n${e}`),getSelectedText:()=>this.getSelectedText(),getCurrentCellContent:()=>this.getCurrentCellContent()});this.createNewChat();this.node.appendChild(this.createLayout());document.addEventListener("keydown",this.handleKeyDown)}showKeyboardShortcutIndicator(e){this.keyboardShortcutIndicator.textContent=e;this.keyboardShortcutIndicator.classList.add("visible");setTimeout((()=>{this.keyboardShortcutIndicator.classList.remove("visible")}),1e3)}dispose(){document.removeEventListener("keydown",this.handleKeyDown);if(this.keyboardShortcutIndicator.parentNode){this.keyboardShortcutIndicator.parentNode.removeChild(this.keyboardShortcutIndicator)}if(this.popupMenuManager){this.popupMenuManager.dispose()}super.dispose()}createLayout(){const e=document.createElement("div");e.className="jp-llm-ext-content-wrapper";const t=document.createElement("div");t.className="jp-llm-ext-title-container";this.titleInput.className="chat-title-input";this.titleInput.type="text";this.titleInput.placeholder="Chat title";this.titleInput.value="New Chat";this.titleInput.addEventListener("change",(()=>this.updateCurrentChatTitle()));t.appendChild(this.titleInput);const n=document.createElement("button");n.className="jp-Button jp-llm-ext-action-button";n.textContent="+ New Chat";n.title="Start a new chat";n.addEventListener("click",(()=>this.createNewChat()));const o=document.createElement("button");o.className="jp-Button jp-llm-ext-action-button";o.textContent="History";o.title="View chat history";o.addEventListener("click",(()=>this.toggleHistoryView()));this.messageContainer.className="jp-llm-ext-message-container";this.historyContainer.className="jp-llm-ext-history-container";this.historyContainer.style.display="none";this.inputContainer.className="jp-llm-ext-input-area-container";this.inputField.placeholder="Ask me anything...";this.inputField.rows=1;this.inputField.addEventListener("keypress",(e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();this.handleSendMessage()}}));const i=document.createElement("div");i.className="jp-llm-ext-input-actions-container";const s=document.createElement("button");s.className="jp-Button jp-llm-ext-send-button";s.textContent="Send";s.addEventListener("click",(()=>this.handleSendMessage()));i.appendChild(s);const r=this.createControlsContainer();this.inputContainer.appendChild(r);this.inputContainer.appendChild(this.inputField);this.inputContainer.appendChild(i);const a=document.createElement("div");a.className="jp-llm-ext-bottom-bar-container";a.appendChild(this.inputContainer);a.appendChild(n);a.appendChild(o);e.appendChild(t);e.appendChild(this.messageContainer);e.appendChild(this.historyContainer);e.appendChild(a);return e}createNewChat(){const e=`chat-${Date.now()}`;const t={id:e,title:"New Chat",messages:[]};this.chatHistory.push(t);this.currentChatId=e;this.titleInput.value=t.title;if(this.messageContainer){this.messageContainer.innerHTML=""}if(this.isHistoryViewActive){this.toggleHistoryView()}}toggleHistoryView(){this.isHistoryViewActive=!this.isHistoryViewActive;if(this.isHistoryViewActive){this.messageContainer.style.display="none";this.historyContainer.style.display="block";this.inputContainer.style.display="none";this.titleInput.style.display="none";this.renderChatHistory()}else{this.messageContainer.style.display="block";this.historyContainer.style.display="none";this.inputContainer.style.display="flex";this.titleInput.style.display="block"}}renderChatHistory(){this.historyContainer.innerHTML="";if(this.chatHistory.length===0){const e=document.createElement("div");e.className="jp-llm-ext-empty-history-message";e.textContent="No chat history yet";this.historyContainer.appendChild(e);return}this.chatHistory.forEach((e=>{const t=document.createElement("div");t.className="jp-llm-ext-history-item";if(e.id===this.currentChatId){t.classList.add("jp-llm-ext-active")}const n=document.createElement("div");n.className="jp-llm-ext-history-title";n.textContent=e.title;const o=document.createElement("div");o.className="jp-llm-ext-history-preview";const i=e.messages[e.messages.length-1];o.textContent=i?`${i.text.substring(0,40)}${i.text.length>40?"...":""}`:"Empty chat";t.addEventListener("click",(()=>this.loadChat(e.id)));t.appendChild(n);t.appendChild(o);this.historyContainer.appendChild(t)}))}loadChat(e){const t=this.chatHistory.find((t=>t.id===e));if(!t)return;this.currentChatId=e;this.titleInput.value=t.title;this.messageContainer.innerHTML="";t.messages.forEach((e=>{this.addMessage(e.text,e.sender,e.isMarkdown,false)}));if(this.isHistoryViewActive){this.toggleHistoryView()}}updateCurrentChatTitle(){const e=this.chatHistory.find((e=>e.id===this.currentChatId));if(e){e.title=this.titleInput.value}}createControlsContainer(){const e=document.createElement("div");e.className="jp-llm-ext-controls-container";const t=document.createElement("div");t.className="jp-llm-ext-toggle-container";const n=document.createElement("input");n.type="checkbox";n.id="markdown-toggle";n.addEventListener("change",(e=>{const t=e.target;this.isMarkdownMode=t.checked;this.inputField.placeholder=this.isMarkdownMode?"Write markdown here...\n\n# Example heading\n- List item\n\n```code block```":"Ask me anything..."}));const o=document.createElement("label");o.htmlFor="markdown-toggle";o.textContent="Markdown mode";t.appendChild(n);t.appendChild(o);const i=document.createElement("div");i.className="jp-llm-ext-action-buttons-container";const s=[{text:"@",title:"Insert context (@)",action:e=>{const t=e.currentTarget;const n=t.getBoundingClientRect();this.popupMenuManager.showPopupMenu(n.left,n.bottom);e.preventDefault();e.stopPropagation()}},{text:"â¤¢",title:"Expand input",action:()=>this.toggleInputExpansion(i.children[3])},{text:"âš™ï¸",title:"Settings",action:e=>{e.preventDefault();e.stopPropagation();this.showSettingsModal()}}];s.forEach((e=>{const t=this.createButton(e.text,e.title);t.addEventListener("click",(t=>e.action(t)));i.appendChild(t)}));e.appendChild(t);e.appendChild(i);return e}toggleInputExpansion(e){this.isInputExpanded=!this.isInputExpanded;if(this.isInputExpanded){this.inputField.style.height="100px";this.inputField.style.resize="vertical";e.textContent="â¤¡";e.title="Collapse input"}else{this.inputField.style.height="";this.inputField.style.resize="none";this.inputField.rows=1;e.textContent="â¤¢";e.title="Expand input"}}createButton(e,t){const n=document.createElement("button");n.textContent=e;n.title=t;n.className="jp-Button jp-llm-ext-action-button";return n}handleSendMessage(){const e=this.inputField.value.trim();if(e){this.addMessage(e,"user",this.isMarkdownMode);this.inputField.value="";this.inputField.rows=1;this.inputField.style.height="";if(this.isInputExpanded){const e=this.node.querySelector('.jp-llm-ext-action-buttons-container button[title*="Collapse"]');if(e){this.toggleInputExpansion(e)}else{this.inputField.style.height="";this.inputField.rows=1}}const t=document.createElement("div");t.className="jp-llm-ext-bot-message";const n=document.createElement("div");n.textContent="MD";n.className="markdown-indicator";t.appendChild(n);const o=document.createElement("div");o.className="streaming-content";o.style.whiteSpace="pre-wrap";o.style.fontFamily="monospace";o.style.fontSize="0.9em";t.appendChild(o);const i=document.createElement("div");i.className="markdown-content";i.style.display="none";t.appendChild(i);this.messageContainer.appendChild(t);let a="";const c=l.globals.cellContextTracker?l.globals.cellContextTracker.getCurrentCellContext():null;this.apiClient.streamChat(e,{cellContext:c},(e=>{a+=e;o.textContent=a;this.messageContainer.scrollTop=this.messageContainer.scrollHeight}),(()=>{o.style.display="none";i.style.display="block";try{const e=(0,d.preprocessMarkdown)(a);const n=s.marked.parse(e);const o=r.default.sanitize(n);i.innerHTML=o;const l=i.querySelectorAll("pre code");l.forEach((e=>{var t;e.classList.add("jp-RenderedText");(t=e.parentElement)===null||t===void 0?void 0:t.classList.add("jp-RenderedHTMLCommon")}));console.log("Adding action buttons to streamed bot message");const c=document.createElement("div");c.className="jp-llm-ext-message-actions";c.style.display="flex";const h=document.createElement("button");h.className="jp-llm-ext-message-action-button";h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';h.title="Copy message to clipboard";h.addEventListener("click",(e=>{e.stopPropagation();this.copyMessageToClipboard(a)}));c.appendChild(h);const p=document.createElement("button");p.className="jp-llm-ext-message-action-button";p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M12 11v6"></path><path d="M9 14h6"></path></svg>';p.title="Add message to current cell";p.addEventListener("click",(e=>{e.stopPropagation();this.addMessageToCell(a)}));c.appendChild(p);t.appendChild(c);console.log("Action buttons added to bot message:",c)}catch(n){i.textContent=a;console.error("Failed to render markdown:",n)}const e=this.chatHistory.find((e=>e.id===this.currentChatId));if(e){e.messages.push({text:a,sender:"bot",isMarkdown:true})}this.messageContainer.scrollTop=this.messageContainer.scrollHeight}),(e=>{o.style.display="none";i.style.display="block";i.innerHTML=`<div class="error-message">Error: ${e.message}</div>`;console.error("API Error:",e)}))}}addMessage(e,t,n=false,o=true){console.log("Adding message:",{sender:t,isMarkdown:n});const i=document.createElement("div");i.className=t==="user"?"jp-llm-ext-user-message":"jp-llm-ext-bot-message";if(n||t==="bot"){const n=document.createElement("div");n.textContent="MD";n.className="markdown-indicator";i.appendChild(n);const o=document.createElement("div");o.className="markdown-content";try{const t=(0,d.preprocessMarkdown)(e);const n=s.marked.parse(t);const i=r.default.sanitize(n);o.innerHTML=i;const a=o.querySelectorAll("pre code");a.forEach((e=>{var t;e.classList.add("jp-RenderedText");(t=e.parentElement)===null||t===void 0?void 0:t.classList.add("jp-RenderedHTMLCommon")}))}catch(a){o.textContent=e;console.error("Failed to render markdown:",a)}i.appendChild(o);if(t==="bot"){console.log("Adding action buttons to bot message");const t=document.createElement("div");t.className="jp-llm-ext-message-actions";const n=document.createElement("button");n.className="jp-llm-ext-message-action-button";n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';n.title="Copy message to clipboard";n.addEventListener("click",(t=>{t.stopPropagation();this.copyMessageToClipboard(e)}));t.appendChild(n);const o=document.createElement("button");o.className="jp-llm-ext-message-action-button";o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M12 11v6"></path><path d="M9 14h6"></path></svg>';o.title="Add message to current cell";o.addEventListener("click",(t=>{t.stopPropagation();this.addMessageToCell(e)}));t.appendChild(o);i.appendChild(t);console.log("Action buttons added to message:",t)}}else{i.textContent=e}this.messageContainer.appendChild(i);this.messageContainer.scrollTop=this.messageContainer.scrollHeight;if(o){const o=this.chatHistory.find((e=>e.id===this.currentChatId));if(o){o.messages.push({text:e,sender:t,isMarkdown:n||t==="bot"})}}}copyMessageToClipboard(e){try{navigator.clipboard.writeText(e).then((()=>{console.log("Content copied to clipboard");const e=document.querySelectorAll(".jp-llm-ext-message-action-button");let t=null;for(let n=0;n<e.length;n++){const o=e[n];if(o.title==="Copy message to clipboard"&&o===document.activeElement){t=o;break}}if(t){const e=t.innerHTML;t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"></path></svg>';setTimeout((()=>{t.innerHTML=e}),2e3)}})).catch((e=>{console.error("Failed to copy text: ",e)}))}catch(t){console.error("Error copying to clipboard:",t)}}addMessageToCell(e){var t;const n=(t=l.globals.notebookTracker)===null||t===void 0?void 0:t.activeCell;if(!n||!n.editor){return}try{const t=n.editor;const o=t.editor;if(!o){return}const i=o.state;const s=i.selection;const r=s.main.head;const a=i.update({changes:{from:r,insert:`\n${e}`},selection:{anchor:r+e.length+1}});o.dispatch(a)}catch(o){console.error("Error adding message to cell:",o)}}getSelectedText(){var e,t,n;const o=(e=l.globals.notebookTracker)===null||e===void 0?void 0:e.activeCell;if(o===null||o===void 0?void 0:o.editor){const e=o.editor;const t=e.editor;if(t&&t.state){const e=t.state;const n=e.selection.main;if(n.empty){return null}return e.doc.sliceString(n.from,n.to)}console.warn("Could not access CodeMirror state to get selection.");return null}else{const e=(n=(t=l.globals.app)===null||t===void 0?void 0:t.shell)===null||n===void 0?void 0:n.currentWidget;if(e&&"content"in e&&e.content.editor){const t=e.content.editor;const n=t.editor;if(n&&n.state){const e=n.state;const t=e.selection.main;if(t.empty){return null}return e.doc.sliceString(t.from,t.to)}console.warn("Could not access CodeMirror state for non-notebook editor selection.");return null}}return null}getCurrentCellContent(){var e,t,n;const o=(e=l.globals.notebookTracker)===null||e===void 0?void 0:e.activeCell;if(o===null||o===void 0?void 0:o.model){if(o.model.sharedModel&&typeof o.model.sharedModel.getSource==="function"){return o.model.sharedModel.getSource()}const e=o.model.toJSON();if(typeof(e===null||e===void 0?void 0:e.source)==="string"){return e.source}else if(Array.isArray(e===null||e===void 0?void 0:e.source)){return e.source.join("\n")}console.warn("Could not get cell content via model.value.text or toJSON().source");return null}const i=(n=(t=l.globals.app)===null||t===void 0?void 0:t.shell)===null||n===void 0?void 0:n.currentWidget;if(i&&"content"in i&&i.content.model){return i.content.model.value.text}return null}appendToInput(e){try{const t=this.inputField.value;if(t){this.inputField.value=`${t}\n\n${e}`}else{this.inputField.value=e}this.inputField.focus();this.inputField.setSelectionRange(this.inputField.value.length,this.inputField.value.length)}catch(t){console.error("Error appending to input:",t)}}createSettingsModal(){const e=document.createElement("div");e.className="jp-llm-ext-settings-modal";e.style.display="none";const t=document.createElement("div");t.className="jp-llm-ext-settings-content";const n=document.createElement("h2");n.className="jp-llm-ext-settings-title";n.textContent="Settings";t.appendChild(n);const o=document.createElement("form");o.className="jp-llm-ext-settings-form";const i=document.createElement("label");i.className="jp-llm-ext-settings-label";i.textContent="API Provider:";o.appendChild(i);const s=document.createElement("select");s.className="jp-llm-ext-settings-select";s.id="settings-provider";["OpenAI","HuggingFace","Local"].forEach((e=>{const t=document.createElement("option");t.value=e;t.textContent=e;s.appendChild(t)}));o.appendChild(s);const r=document.createElement("label");r.className="jp-llm-ext-settings-label";r.textContent="API Key:";o.appendChild(r);const a=document.createElement("input");a.className="jp-llm-ext-settings-input";a.type="password";a.id="settings-api-key";o.appendChild(a);const l=document.createElement("label");l.className="jp-llm-ext-settings-label";l.textContent="API URL (optional):";o.appendChild(l);const c=document.createElement("input");c.className="jp-llm-ext-settings-input";c.type="text";c.id="settings-api-url";o.appendChild(c);const d=document.createElement("label");d.className="jp-llm-ext-settings-label";d.textContent="Custom Rules (optional):";o.appendChild(d);const h=document.createElement("textarea");h.className="jp-llm-ext-settings-textarea";h.id="settings-rules";o.appendChild(h);const p=document.createElement("div");p.className="jp-llm-ext-settings-buttons";const u=document.createElement("button");u.className="jp-llm-ext-settings-button jp-llm-ext-settings-save-button";u.textContent="Save";u.addEventListener("click",(()=>{const e=document.getElementById("settings-provider").value;const t=document.getElementById("settings-api-key").value;const n=document.getElementById("settings-api-url").value;const o=document.getElementById("settings-rules").value;console.log("Settings saved:",{provider:e,key:t,url:n,rules:o});this.hideSettingsModal()}));const m=document.createElement("button");m.className="jp-llm-ext-settings-button jp-llm-ext-settings-cancel-button";m.textContent="Cancel";m.addEventListener("click",(()=>this.hideSettingsModal()));p.appendChild(u);p.appendChild(m);o.appendChild(p);t.appendChild(o);e.appendChild(t);return e}showSettingsModal(){this.settingsModalContainer.style.display="flex"}hideSettingsModal(){this.settingsModalContainer.style.display="none"}}t.SimpleSidebarWidget=p}}]);
//# sourceMappingURL=8735.6ae339bdafff48e4f22b.js.map?v=6ae339bdafff48e4f22b