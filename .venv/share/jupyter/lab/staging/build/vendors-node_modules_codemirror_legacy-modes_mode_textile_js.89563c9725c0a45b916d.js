"use strict";
(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["vendors-node_modules_codemirror_legacy-modes_mode_textile_js"],{

/***/ "./node_modules/@codemirror/legacy-modes/mode/textile.js":
/*!***************************************************************!*\
  !*** ./node_modules/@codemirror/legacy-modes/mode/textile.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   textile: () => (/* binding */ textile)
/* harmony export */ });
var TOKEN_STYLES = {
  addition: "inserted",
  attributes: "propertyName",
  bold: "strong",
  cite: "keyword",
  code: "monospace",
  definitionList: "list",
  deletion: "deleted",
  div: "punctuation",
  em: "emphasis",
  footnote: "variable",
  footCite: "qualifier",
  header: "heading",
  html: "comment",
  image: "atom",
  italic: "emphasis",
  link: "link",
  linkDefinition: "link",
  list1: "list",
  list2: "list.special",
  list3: "list",
  notextile: "string.special",
  pre: "operator",
  p: "content",
  quote: "bracket",
  span: "quote",
  specialChar: "character",
  strong: "strong",
  sub: "content.special",
  sup: "content.special",
  table: "variableName.special",
  tableHeading: "operator"
};

function startNewLine(stream, state) {
  state.mode = Modes.newLayout;
  state.tableHeading = false;

  if (state.layoutType === "definitionList" && state.spanningLayout &&
      stream.match(RE("definitionListEnd"), false))
    state.spanningLayout = false;
}

function handlePhraseModifier(stream, state, ch) {
  if (ch === "_") {
    if (stream.eat("_"))
      return togglePhraseModifier(stream, state, "italic", /__/, 2);
    else
      return togglePhraseModifier(stream, state, "em", /_/, 1);
  }

  if (ch === "*") {
    if (stream.eat("*")) {
      return togglePhraseModifier(stream, state, "bold", /\*\*/, 2);
    }
    return togglePhraseModifier(stream, state, "strong", /\*/, 1);
  }

  if (ch === "[") {
    if (stream.match(/\d+\]/)) state.footCite = true;
    return tokenStyles(state);
  }

  if (ch === "(") {
    var spec = stream.match(/^(r|tm|c)\)/);
    if (spec)
      return TOKEN_STYLES.specialChar
  }

  if (ch === "<" && stream.match(/(\w+)[^>]+>[^<]+<\/\1>/))
    return TOKEN_STYLES.html

  if (ch === "?" && stream.eat("?"))
    return togglePhraseModifier(stream, state, "cite", /\?\?/, 2);

  if (ch === "=" && stream.eat("="))
    return togglePhraseModifier(stream, state, "notextile", /==/, 2);

  if (ch === "-" && !stream.eat("-"))
    return togglePhraseModifier(stream, state, "deletion", /-/, 1);

  if (ch === "+")
    return togglePhraseModifier(stream, state, "addition", /\+/, 1);

  if (ch === "~")
    return togglePhraseModifier(stream, state, "sub", /~/, 1);

  if (ch === "^")
    return togglePhraseModifier(stream, state, "sup", /\^/, 1);

  if (ch === "%")
    return togglePhraseModifier(stream, state, "span", /%/, 1);

  if (ch === "@")
    return togglePhraseModifier(stream, state, "code", /@/, 1);

  if (ch === "!") {
    var type = togglePhraseModifier(stream, state, "image", /(?:\([^\)]+\))?!/, 1);
    stream.match(/^:\S+/); // optional Url portion
    return type;
  }
  return tokenStyles(state);
}

function togglePhraseModifier(stream, state, phraseModifier, closeRE, openSize) {
  var charBefore = stream.pos > openSize ? stream.string.charAt(stream.pos - openSize - 1) : null;
  var charAfter = stream.peek();
  if (state[phraseModifier]) {
    if ((!charAfter || /\W/.test(charAfter)) && charBefore && /\S/.test(charBefore)) {
      var type = tokenStyles(state);
      state[phraseModifier] = false;
      return type;
    }
  } else if ((!charBefore || /\W/.test(charBefore)) && charAfter && /\S/.test(charAfter) &&
             stream.match(new RegExp("^.*\\S" + closeRE.source + "(?:\\W|$)"), false)) {
    state[phraseModifier] = true;
    state.mode = Modes.attributes;
  }
  return tokenStyles(state);
};

function tokenStyles(state) {
  var disabled = textileDisabled(state);
  if (disabled) return disabled;

  var styles = [];
  if (state.layoutType) styles.push(TOKEN_STYLES[state.layoutType]);

  styles = styles.concat(activeStyles(
    state, "addition", "bold", "cite", "code", "deletion", "em", "footCite",
    "image", "italic", "link", "span", "strong", "sub", "sup", "table", "tableHeading"));

  if (state.layoutType === "header")
    styles.push(TOKEN_STYLES.header + "-" + state.header);

  return styles.length ? styles.join(" ") : null;
}

function textileDisabled(state) {
  var type = state.layoutType;

  switch(type) {
  case "notextile":
  case "code":
  case "pre":
    return TOKEN_STYLES[type];
  default:
    if (state.notextile)
      return TOKEN_STYLES.notextile + (type ? (" " + TOKEN_STYLES[type]) : "");
    return null;
  }
}

function activeStyles(state) {
  var styles = [];
  for (var i = 1; i < arguments.length; ++i) {
    if (state[arguments[i]])
      styles.push(TOKEN_STYLES[arguments[i]]);
  }
  return styles;
}

function blankLine(state) {
  var spanningLayout = state.spanningLayout, type = state.layoutType;

  for (var key in state) if (state.hasOwnProperty(key))
    delete state[key];

  state.mode = Modes.newLayout;
  if (spanningLayout) {
    state.layoutType = type;
    state.spanningLayout = true;
  }
}

var REs = {
  cache: {},
  single: {
    bc: "bc",
    bq: "bq",
    definitionList: /- .*?:=+/,
    definitionListEnd: /.*=:\s*$/,
    div: "div",
    drawTable: /\|.*\|/,
    foot: /fn\d+/,
    header: /h[1-6]/,
    html: /\s*<(?:\/)?(\w+)(?:[^>]+)?>(?:[^<]+<\/\1>)?/,
    link: /[^"]+":\S/,
    linkDefinition: /\[[^\s\]]+\]\S+/,
    list: /(?:#+|\*+)/,
    notextile: "notextile",
    para: "p",
    pre: "pre",
    table: "table",
    tableCellAttributes: /[\/\\]\d+/,
    tableHeading: /\|_\./,
    tableText: /[^"_\*\[\(\?\+~\^%@|-]+/,
    text: /[^!"_=\*\[\(<\?\+~\^%@-]+/
  },
  attributes: {
    align: /(?:<>|<|>|=)/,
    selector: /\([^\(][^\)]+\)/,
    lang: /\[[^\[\]]+\]/,
    pad: /(?:\(+|\)+){1,2}/,
    css: /\{[^\}]+\}/
  },
  createRe: function(name) {
    switch (name) {
    case "drawTable":
      return REs.makeRe("^", REs.single.drawTable, "$");
    case "html":
      return REs.makeRe("^", REs.single.html, "(?:", REs.single.html, ")*", "$");
    case "linkDefinition":
      return REs.makeRe("^", REs.single.linkDefinition, "$");
    case "listLayout":
      return REs.makeRe("^", REs.single.list, RE("allAttributes"), "*\\s+");
    case "tableCellAttributes":
      return REs.makeRe("^", REs.choiceRe(REs.single.tableCellAttributes,
                                          RE("allAttributes")), "+\\.");
    case "type":
      return REs.makeRe("^", RE("allTypes"));
    case "typeLayout":
      return REs.makeRe("^", RE("allTypes"), RE("allAttributes"),
                        "*\\.\\.?", "(\\s+|$)");
    case "attributes":
      return REs.makeRe("^", RE("allAttributes"), "+");

    case "allTypes":
      return REs.choiceRe(REs.single.div, REs.single.foot,
                          REs.single.header, REs.single.bc, REs.single.bq,
                          REs.single.notextile, REs.single.pre, REs.single.table,
                          REs.single.para);

    case "allAttributes":
      return REs.choiceRe(REs.attributes.selector, REs.attributes.css,
                          REs.attributes.lang, REs.attributes.align, REs.attributes.pad);

    default:
      return REs.makeRe("^", REs.single[name]);
    }
  },
  makeRe: function() {
    var pattern = "";
    for (var i = 0; i < arguments.length; ++i) {
      var arg = arguments[i];
      pattern += (typeof arg === "string") ? arg : arg.source;
    }
    return new RegExp(pattern);
  },
  choiceRe: function() {
    var parts = [arguments[0]];
    for (var i = 1; i < arguments.length; ++i) {
      parts[i * 2 - 1] = "|";
      parts[i * 2] = arguments[i];
    }

    parts.unshift("(?:");
    parts.push(")");
    return REs.makeRe.apply(null, parts);
  }
};

function RE(name) {
  return (REs.cache[name] || (REs.cache[name] = REs.createRe(name)));
}

var Modes = {
  newLayout: function(stream, state) {
    if (stream.match(RE("typeLayout"), false)) {
      state.spanningLayout = false;
      return (state.mode = Modes.blockType)(stream, state);
    }
    var newMode;
    if (!textileDisabled(state)) {
      if (stream.match(RE("listLayout"), false))
        newMode = Modes.list;
      else if (stream.match(RE("drawTable"), false))
        newMode = Modes.table;
      else if (stream.match(RE("linkDefinition"), false))
        newMode = Modes.linkDefinition;
      else if (stream.match(RE("definitionList")))
        newMode = Modes.definitionList;
      else if (stream.match(RE("html"), false))
        newMode = Modes.html;
    }
    return (state.mode = (newMode || Modes.text))(stream, state);
  },

  blockType: function(stream, state) {
    var match, type;
    state.layoutType = null;

    if (match = stream.match(RE("type")))
      type = match[0];
    else
      return (state.mode = Modes.text)(stream, state);

    if (match = type.match(RE("header"))) {
      state.layoutType = "header";
      state.header = parseInt(match[0][1]);
    } else if (type.match(RE("bq"))) {
      state.layoutType = "quote";
    } else if (type.match(RE("bc"))) {
      state.layoutType = "code";
    } else if (type.match(RE("foot"))) {
      state.layoutType = "footnote";
    } else if (type.match(RE("notextile"))) {
      state.layoutType = "notextile";
    } else if (type.match(RE("pre"))) {
      state.layoutType = "pre";
    } else if (type.match(RE("div"))) {
      state.layoutType = "div";
    } else if (type.match(RE("table"))) {
      state.layoutType = "table";
    }

    state.mode = Modes.attributes;
    return tokenStyles(state);
  },

  text: function(stream, state) {
    if (stream.match(RE("text"))) return tokenStyles(state);

    var ch = stream.next();
    if (ch === '"')
      return (state.mode = Modes.link)(stream, state);
    return handlePhraseModifier(stream, state, ch);
  },

  attributes: function(stream, state) {
    state.mode = Modes.layoutLength;

    if (stream.match(RE("attributes")))
      return TOKEN_STYLES.attributes
    else
      return tokenStyles(state);
  },

  layoutLength: function(stream, state) {
    if (stream.eat(".") && stream.eat("."))
      state.spanningLayout = true;

    state.mode = Modes.text;
    return tokenStyles(state);
  },

  list: function(stream, state) {
    var match = stream.match(RE("list"));
    state.listDepth = match[0].length;
    var listMod = (state.listDepth - 1) % 3;
    if (!listMod)
      state.layoutType = "list1";
    else if (listMod === 1)
      state.layoutType = "list2";
    else
      state.layoutType = "list3";

    state.mode = Modes.attributes;
    return tokenStyles(state);
  },

  link: function(stream, state) {
    state.mode = Modes.text;
    if (stream.match(RE("link"))) {
      stream.match(/\S+/);
      return TOKEN_STYLES.link
    }
    return tokenStyles(state);
  },

  linkDefinition: function(stream) {
    stream.skipToEnd();
    return TOKEN_STYLES.linkDefinition
  },

  definitionList: function(stream, state) {
    stream.match(RE("definitionList"));

    state.layoutType = "definitionList";

    if (stream.match(/\s*$/))
      state.spanningLayout = true;
    else
      state.mode = Modes.attributes;

    return tokenStyles(state);
  },

  html: function(stream) {
    stream.skipToEnd();
    return TOKEN_STYLES.html
  },

  table: function(stream, state) {
    state.layoutType = "table";
    return (state.mode = Modes.tableCell)(stream, state);
  },

  tableCell: function(stream, state) {
    if (stream.match(RE("tableHeading")))
      state.tableHeading = true;
    else
      stream.eat("|");

    state.mode = Modes.tableCellAttributes;
    return tokenStyles(state);
  },

  tableCellAttributes: function(stream, state) {
    state.mode = Modes.tableText;

    if (stream.match(RE("tableCellAttributes")))
      return TOKEN_STYLES.attributes
    else
      return tokenStyles(state);
  },

  tableText: function(stream, state) {
    if (stream.match(RE("tableText")))
      return tokenStyles(state);

    if (stream.peek() === "|") { // end of cell
      state.mode = Modes.tableCell;
      return tokenStyles(state);
    }
    return handlePhraseModifier(stream, state, stream.next());
  }
};

const textile = {
  name: "textile",
  startState: function() {
    return { mode: Modes.newLayout };
  },
  token: function(stream, state) {
    if (stream.sol()) startNewLine(stream, state);
    return state.mode(stream, state);
  },
  blankLine: blankLine
};


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfY29kZW1pcnJvcl9sZWdhY3ktbW9kZXNfbW9kZV90ZXh0aWxlX2pzLjg5NTYzYzk3MjVjMGE0NWI5MTZkLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCLHNCQUFzQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLElBQUk7QUFDMUIsWUFBWSxJQUFJLElBQUk7QUFDcEIsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVPO0FBQ1A7QUFDQTtBQUNBLGFBQWE7QUFDYixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvQGNvZGVtaXJyb3IvbGVnYWN5LW1vZGVzL21vZGUvdGV4dGlsZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVE9LRU5fU1RZTEVTID0ge1xuICBhZGRpdGlvbjogXCJpbnNlcnRlZFwiLFxuICBhdHRyaWJ1dGVzOiBcInByb3BlcnR5TmFtZVwiLFxuICBib2xkOiBcInN0cm9uZ1wiLFxuICBjaXRlOiBcImtleXdvcmRcIixcbiAgY29kZTogXCJtb25vc3BhY2VcIixcbiAgZGVmaW5pdGlvbkxpc3Q6IFwibGlzdFwiLFxuICBkZWxldGlvbjogXCJkZWxldGVkXCIsXG4gIGRpdjogXCJwdW5jdHVhdGlvblwiLFxuICBlbTogXCJlbXBoYXNpc1wiLFxuICBmb290bm90ZTogXCJ2YXJpYWJsZVwiLFxuICBmb290Q2l0ZTogXCJxdWFsaWZpZXJcIixcbiAgaGVhZGVyOiBcImhlYWRpbmdcIixcbiAgaHRtbDogXCJjb21tZW50XCIsXG4gIGltYWdlOiBcImF0b21cIixcbiAgaXRhbGljOiBcImVtcGhhc2lzXCIsXG4gIGxpbms6IFwibGlua1wiLFxuICBsaW5rRGVmaW5pdGlvbjogXCJsaW5rXCIsXG4gIGxpc3QxOiBcImxpc3RcIixcbiAgbGlzdDI6IFwibGlzdC5zcGVjaWFsXCIsXG4gIGxpc3QzOiBcImxpc3RcIixcbiAgbm90ZXh0aWxlOiBcInN0cmluZy5zcGVjaWFsXCIsXG4gIHByZTogXCJvcGVyYXRvclwiLFxuICBwOiBcImNvbnRlbnRcIixcbiAgcXVvdGU6IFwiYnJhY2tldFwiLFxuICBzcGFuOiBcInF1b3RlXCIsXG4gIHNwZWNpYWxDaGFyOiBcImNoYXJhY3RlclwiLFxuICBzdHJvbmc6IFwic3Ryb25nXCIsXG4gIHN1YjogXCJjb250ZW50LnNwZWNpYWxcIixcbiAgc3VwOiBcImNvbnRlbnQuc3BlY2lhbFwiLFxuICB0YWJsZTogXCJ2YXJpYWJsZU5hbWUuc3BlY2lhbFwiLFxuICB0YWJsZUhlYWRpbmc6IFwib3BlcmF0b3JcIlxufTtcblxuZnVuY3Rpb24gc3RhcnROZXdMaW5lKHN0cmVhbSwgc3RhdGUpIHtcbiAgc3RhdGUubW9kZSA9IE1vZGVzLm5ld0xheW91dDtcbiAgc3RhdGUudGFibGVIZWFkaW5nID0gZmFsc2U7XG5cbiAgaWYgKHN0YXRlLmxheW91dFR5cGUgPT09IFwiZGVmaW5pdGlvbkxpc3RcIiAmJiBzdGF0ZS5zcGFubmluZ0xheW91dCAmJlxuICAgICAgc3RyZWFtLm1hdGNoKFJFKFwiZGVmaW5pdGlvbkxpc3RFbmRcIiksIGZhbHNlKSlcbiAgICBzdGF0ZS5zcGFubmluZ0xheW91dCA9IGZhbHNlO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBjaCkge1xuICBpZiAoY2ggPT09IFwiX1wiKSB7XG4gICAgaWYgKHN0cmVhbS5lYXQoXCJfXCIpKVxuICAgICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiaXRhbGljXCIsIC9fXy8sIDIpO1xuICAgIGVsc2VcbiAgICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImVtXCIsIC9fLywgMSk7XG4gIH1cblxuICBpZiAoY2ggPT09IFwiKlwiKSB7XG4gICAgaWYgKHN0cmVhbS5lYXQoXCIqXCIpKSB7XG4gICAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJib2xkXCIsIC9cXCpcXCovLCAyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwic3Ryb25nXCIsIC9cXCovLCAxKTtcbiAgfVxuXG4gIGlmIChjaCA9PT0gXCJbXCIpIHtcbiAgICBpZiAoc3RyZWFtLm1hdGNoKC9cXGQrXFxdLykpIHN0YXRlLmZvb3RDaXRlID0gdHJ1ZTtcbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9XG5cbiAgaWYgKGNoID09PSBcIihcIikge1xuICAgIHZhciBzcGVjID0gc3RyZWFtLm1hdGNoKC9eKHJ8dG18YylcXCkvKTtcbiAgICBpZiAoc3BlYylcbiAgICAgIHJldHVybiBUT0tFTl9TVFlMRVMuc3BlY2lhbENoYXJcbiAgfVxuXG4gIGlmIChjaCA9PT0gXCI8XCIgJiYgc3RyZWFtLm1hdGNoKC8oXFx3KylbXj5dKz5bXjxdKzxcXC9cXDE+LykpXG4gICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5odG1sXG5cbiAgaWYgKGNoID09PSBcIj9cIiAmJiBzdHJlYW0uZWF0KFwiP1wiKSlcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJjaXRlXCIsIC9cXD9cXD8vLCAyKTtcblxuICBpZiAoY2ggPT09IFwiPVwiICYmIHN0cmVhbS5lYXQoXCI9XCIpKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcIm5vdGV4dGlsZVwiLCAvPT0vLCAyKTtcblxuICBpZiAoY2ggPT09IFwiLVwiICYmICFzdHJlYW0uZWF0KFwiLVwiKSlcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJkZWxldGlvblwiLCAvLS8sIDEpO1xuXG4gIGlmIChjaCA9PT0gXCIrXCIpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiYWRkaXRpb25cIiwgL1xcKy8sIDEpO1xuXG4gIGlmIChjaCA9PT0gXCJ+XCIpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwic3ViXCIsIC9+LywgMSk7XG5cbiAgaWYgKGNoID09PSBcIl5cIilcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJzdXBcIiwgL1xcXi8sIDEpO1xuXG4gIGlmIChjaCA9PT0gXCIlXCIpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwic3BhblwiLCAvJS8sIDEpO1xuXG4gIGlmIChjaCA9PT0gXCJAXCIpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiY29kZVwiLCAvQC8sIDEpO1xuXG4gIGlmIChjaCA9PT0gXCIhXCIpIHtcbiAgICB2YXIgdHlwZSA9IHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiaW1hZ2VcIiwgLyg/OlxcKFteXFwpXStcXCkpPyEvLCAxKTtcbiAgICBzdHJlYW0ubWF0Y2goL146XFxTKy8pOyAvLyBvcHRpb25hbCBVcmwgcG9ydGlvblxuICAgIHJldHVybiB0eXBlO1xuICB9XG4gIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIHBocmFzZU1vZGlmaWVyLCBjbG9zZVJFLCBvcGVuU2l6ZSkge1xuICB2YXIgY2hhckJlZm9yZSA9IHN0cmVhbS5wb3MgPiBvcGVuU2l6ZSA/IHN0cmVhbS5zdHJpbmcuY2hhckF0KHN0cmVhbS5wb3MgLSBvcGVuU2l6ZSAtIDEpIDogbnVsbDtcbiAgdmFyIGNoYXJBZnRlciA9IHN0cmVhbS5wZWVrKCk7XG4gIGlmIChzdGF0ZVtwaHJhc2VNb2RpZmllcl0pIHtcbiAgICBpZiAoKCFjaGFyQWZ0ZXIgfHwgL1xcVy8udGVzdChjaGFyQWZ0ZXIpKSAmJiBjaGFyQmVmb3JlICYmIC9cXFMvLnRlc3QoY2hhckJlZm9yZSkpIHtcbiAgICAgIHZhciB0eXBlID0gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICAgICAgc3RhdGVbcGhyYXNlTW9kaWZpZXJdID0gZmFsc2U7XG4gICAgICByZXR1cm4gdHlwZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoKCFjaGFyQmVmb3JlIHx8IC9cXFcvLnRlc3QoY2hhckJlZm9yZSkpICYmIGNoYXJBZnRlciAmJiAvXFxTLy50ZXN0KGNoYXJBZnRlcikgJiZcbiAgICAgICAgICAgICBzdHJlYW0ubWF0Y2gobmV3IFJlZ0V4cChcIl4uKlxcXFxTXCIgKyBjbG9zZVJFLnNvdXJjZSArIFwiKD86XFxcXFd8JClcIiksIGZhbHNlKSkge1xuICAgIHN0YXRlW3BocmFzZU1vZGlmaWVyXSA9IHRydWU7XG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLmF0dHJpYnV0ZXM7XG4gIH1cbiAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbn07XG5cbmZ1bmN0aW9uIHRva2VuU3R5bGVzKHN0YXRlKSB7XG4gIHZhciBkaXNhYmxlZCA9IHRleHRpbGVEaXNhYmxlZChzdGF0ZSk7XG4gIGlmIChkaXNhYmxlZCkgcmV0dXJuIGRpc2FibGVkO1xuXG4gIHZhciBzdHlsZXMgPSBbXTtcbiAgaWYgKHN0YXRlLmxheW91dFR5cGUpIHN0eWxlcy5wdXNoKFRPS0VOX1NUWUxFU1tzdGF0ZS5sYXlvdXRUeXBlXSk7XG5cbiAgc3R5bGVzID0gc3R5bGVzLmNvbmNhdChhY3RpdmVTdHlsZXMoXG4gICAgc3RhdGUsIFwiYWRkaXRpb25cIiwgXCJib2xkXCIsIFwiY2l0ZVwiLCBcImNvZGVcIiwgXCJkZWxldGlvblwiLCBcImVtXCIsIFwiZm9vdENpdGVcIixcbiAgICBcImltYWdlXCIsIFwiaXRhbGljXCIsIFwibGlua1wiLCBcInNwYW5cIiwgXCJzdHJvbmdcIiwgXCJzdWJcIiwgXCJzdXBcIiwgXCJ0YWJsZVwiLCBcInRhYmxlSGVhZGluZ1wiKSk7XG5cbiAgaWYgKHN0YXRlLmxheW91dFR5cGUgPT09IFwiaGVhZGVyXCIpXG4gICAgc3R5bGVzLnB1c2goVE9LRU5fU1RZTEVTLmhlYWRlciArIFwiLVwiICsgc3RhdGUuaGVhZGVyKTtcblxuICByZXR1cm4gc3R5bGVzLmxlbmd0aCA/IHN0eWxlcy5qb2luKFwiIFwiKSA6IG51bGw7XG59XG5cbmZ1bmN0aW9uIHRleHRpbGVEaXNhYmxlZChzdGF0ZSkge1xuICB2YXIgdHlwZSA9IHN0YXRlLmxheW91dFR5cGU7XG5cbiAgc3dpdGNoKHR5cGUpIHtcbiAgY2FzZSBcIm5vdGV4dGlsZVwiOlxuICBjYXNlIFwiY29kZVwiOlxuICBjYXNlIFwicHJlXCI6XG4gICAgcmV0dXJuIFRPS0VOX1NUWUxFU1t0eXBlXTtcbiAgZGVmYXVsdDpcbiAgICBpZiAoc3RhdGUubm90ZXh0aWxlKVxuICAgICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5ub3RleHRpbGUgKyAodHlwZSA/IChcIiBcIiArIFRPS0VOX1NUWUxFU1t0eXBlXSkgOiBcIlwiKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5mdW5jdGlvbiBhY3RpdmVTdHlsZXMoc3RhdGUpIHtcbiAgdmFyIHN0eWxlcyA9IFtdO1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkge1xuICAgIGlmIChzdGF0ZVthcmd1bWVudHNbaV1dKVxuICAgICAgc3R5bGVzLnB1c2goVE9LRU5fU1RZTEVTW2FyZ3VtZW50c1tpXV0pO1xuICB9XG4gIHJldHVybiBzdHlsZXM7XG59XG5cbmZ1bmN0aW9uIGJsYW5rTGluZShzdGF0ZSkge1xuICB2YXIgc3Bhbm5pbmdMYXlvdXQgPSBzdGF0ZS5zcGFubmluZ0xheW91dCwgdHlwZSA9IHN0YXRlLmxheW91dFR5cGU7XG5cbiAgZm9yICh2YXIga2V5IGluIHN0YXRlKSBpZiAoc3RhdGUuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICBkZWxldGUgc3RhdGVba2V5XTtcblxuICBzdGF0ZS5tb2RlID0gTW9kZXMubmV3TGF5b3V0O1xuICBpZiAoc3Bhbm5pbmdMYXlvdXQpIHtcbiAgICBzdGF0ZS5sYXlvdXRUeXBlID0gdHlwZTtcbiAgICBzdGF0ZS5zcGFubmluZ0xheW91dCA9IHRydWU7XG4gIH1cbn1cblxudmFyIFJFcyA9IHtcbiAgY2FjaGU6IHt9LFxuICBzaW5nbGU6IHtcbiAgICBiYzogXCJiY1wiLFxuICAgIGJxOiBcImJxXCIsXG4gICAgZGVmaW5pdGlvbkxpc3Q6IC8tIC4qPzo9Ky8sXG4gICAgZGVmaW5pdGlvbkxpc3RFbmQ6IC8uKj06XFxzKiQvLFxuICAgIGRpdjogXCJkaXZcIixcbiAgICBkcmF3VGFibGU6IC9cXHwuKlxcfC8sXG4gICAgZm9vdDogL2ZuXFxkKy8sXG4gICAgaGVhZGVyOiAvaFsxLTZdLyxcbiAgICBodG1sOiAvXFxzKjwoPzpcXC8pPyhcXHcrKSg/OltePl0rKT8+KD86W148XSs8XFwvXFwxPik/LyxcbiAgICBsaW5rOiAvW15cIl0rXCI6XFxTLyxcbiAgICBsaW5rRGVmaW5pdGlvbjogL1xcW1teXFxzXFxdXStcXF1cXFMrLyxcbiAgICBsaXN0OiAvKD86Iyt8XFwqKykvLFxuICAgIG5vdGV4dGlsZTogXCJub3RleHRpbGVcIixcbiAgICBwYXJhOiBcInBcIixcbiAgICBwcmU6IFwicHJlXCIsXG4gICAgdGFibGU6IFwidGFibGVcIixcbiAgICB0YWJsZUNlbGxBdHRyaWJ1dGVzOiAvW1xcL1xcXFxdXFxkKy8sXG4gICAgdGFibGVIZWFkaW5nOiAvXFx8X1xcLi8sXG4gICAgdGFibGVUZXh0OiAvW15cIl9cXCpcXFtcXChcXD9cXCt+XFxeJUB8LV0rLyxcbiAgICB0ZXh0OiAvW14hXCJfPVxcKlxcW1xcKDxcXD9cXCt+XFxeJUAtXSsvXG4gIH0sXG4gIGF0dHJpYnV0ZXM6IHtcbiAgICBhbGlnbjogLyg/Ojw+fDx8Pnw9KS8sXG4gICAgc2VsZWN0b3I6IC9cXChbXlxcKF1bXlxcKV0rXFwpLyxcbiAgICBsYW5nOiAvXFxbW15cXFtcXF1dK1xcXS8sXG4gICAgcGFkOiAvKD86XFwoK3xcXCkrKXsxLDJ9LyxcbiAgICBjc3M6IC9cXHtbXlxcfV0rXFx9L1xuICB9LFxuICBjcmVhdGVSZTogZnVuY3Rpb24obmFtZSkge1xuICAgIHN3aXRjaCAobmFtZSkge1xuICAgIGNhc2UgXCJkcmF3VGFibGVcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRXMuc2luZ2xlLmRyYXdUYWJsZSwgXCIkXCIpO1xuICAgIGNhc2UgXCJodG1sXCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkVzLnNpbmdsZS5odG1sLCBcIig/OlwiLCBSRXMuc2luZ2xlLmh0bWwsIFwiKSpcIiwgXCIkXCIpO1xuICAgIGNhc2UgXCJsaW5rRGVmaW5pdGlvblwiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFcy5zaW5nbGUubGlua0RlZmluaXRpb24sIFwiJFwiKTtcbiAgICBjYXNlIFwibGlzdExheW91dFwiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFcy5zaW5nbGUubGlzdCwgUkUoXCJhbGxBdHRyaWJ1dGVzXCIpLCBcIipcXFxccytcIik7XG4gICAgY2FzZSBcInRhYmxlQ2VsbEF0dHJpYnV0ZXNcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRXMuY2hvaWNlUmUoUkVzLnNpbmdsZS50YWJsZUNlbGxBdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUkUoXCJhbGxBdHRyaWJ1dGVzXCIpKSwgXCIrXFxcXC5cIik7XG4gICAgY2FzZSBcInR5cGVcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRShcImFsbFR5cGVzXCIpKTtcbiAgICBjYXNlIFwidHlwZUxheW91dFwiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFKFwiYWxsVHlwZXNcIiksIFJFKFwiYWxsQXR0cmlidXRlc1wiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiKlxcXFwuXFxcXC4/XCIsIFwiKFxcXFxzK3wkKVwiKTtcbiAgICBjYXNlIFwiYXR0cmlidXRlc1wiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFKFwiYWxsQXR0cmlidXRlc1wiKSwgXCIrXCIpO1xuXG4gICAgY2FzZSBcImFsbFR5cGVzXCI6XG4gICAgICByZXR1cm4gUkVzLmNob2ljZVJlKFJFcy5zaW5nbGUuZGl2LCBSRXMuc2luZ2xlLmZvb3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFJFcy5zaW5nbGUuaGVhZGVyLCBSRXMuc2luZ2xlLmJjLCBSRXMuc2luZ2xlLmJxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBSRXMuc2luZ2xlLm5vdGV4dGlsZSwgUkVzLnNpbmdsZS5wcmUsIFJFcy5zaW5nbGUudGFibGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFJFcy5zaW5nbGUucGFyYSk7XG5cbiAgICBjYXNlIFwiYWxsQXR0cmlidXRlc1wiOlxuICAgICAgcmV0dXJuIFJFcy5jaG9pY2VSZShSRXMuYXR0cmlidXRlcy5zZWxlY3RvciwgUkVzLmF0dHJpYnV0ZXMuY3NzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBSRXMuYXR0cmlidXRlcy5sYW5nLCBSRXMuYXR0cmlidXRlcy5hbGlnbiwgUkVzLmF0dHJpYnV0ZXMucGFkKTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkVzLnNpbmdsZVtuYW1lXSk7XG4gICAgfVxuICB9LFxuICBtYWtlUmU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwYXR0ZXJuID0gXCJcIjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgIHBhdHRlcm4gKz0gKHR5cGVvZiBhcmcgPT09IFwic3RyaW5nXCIpID8gYXJnIDogYXJnLnNvdXJjZTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBSZWdFeHAocGF0dGVybik7XG4gIH0sXG4gIGNob2ljZVJlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcGFydHMgPSBbYXJndW1lbnRzWzBdXTtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgcGFydHNbaSAqIDIgLSAxXSA9IFwifFwiO1xuICAgICAgcGFydHNbaSAqIDJdID0gYXJndW1lbnRzW2ldO1xuICAgIH1cblxuICAgIHBhcnRzLnVuc2hpZnQoXCIoPzpcIik7XG4gICAgcGFydHMucHVzaChcIilcIik7XG4gICAgcmV0dXJuIFJFcy5tYWtlUmUuYXBwbHkobnVsbCwgcGFydHMpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBSRShuYW1lKSB7XG4gIHJldHVybiAoUkVzLmNhY2hlW25hbWVdIHx8IChSRXMuY2FjaGVbbmFtZV0gPSBSRXMuY3JlYXRlUmUobmFtZSkpKTtcbn1cblxudmFyIE1vZGVzID0ge1xuICBuZXdMYXlvdXQ6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwidHlwZUxheW91dFwiKSwgZmFsc2UpKSB7XG4gICAgICBzdGF0ZS5zcGFubmluZ0xheW91dCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIChzdGF0ZS5tb2RlID0gTW9kZXMuYmxvY2tUeXBlKShzdHJlYW0sIHN0YXRlKTtcbiAgICB9XG4gICAgdmFyIG5ld01vZGU7XG4gICAgaWYgKCF0ZXh0aWxlRGlzYWJsZWQoc3RhdGUpKSB7XG4gICAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwibGlzdExheW91dFwiKSwgZmFsc2UpKVxuICAgICAgICBuZXdNb2RlID0gTW9kZXMubGlzdDtcbiAgICAgIGVsc2UgaWYgKHN0cmVhbS5tYXRjaChSRShcImRyYXdUYWJsZVwiKSwgZmFsc2UpKVxuICAgICAgICBuZXdNb2RlID0gTW9kZXMudGFibGU7XG4gICAgICBlbHNlIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJsaW5rRGVmaW5pdGlvblwiKSwgZmFsc2UpKVxuICAgICAgICBuZXdNb2RlID0gTW9kZXMubGlua0RlZmluaXRpb247XG4gICAgICBlbHNlIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJkZWZpbml0aW9uTGlzdFwiKSkpXG4gICAgICAgIG5ld01vZGUgPSBNb2Rlcy5kZWZpbml0aW9uTGlzdDtcbiAgICAgIGVsc2UgaWYgKHN0cmVhbS5tYXRjaChSRShcImh0bWxcIiksIGZhbHNlKSlcbiAgICAgICAgbmV3TW9kZSA9IE1vZGVzLmh0bWw7XG4gICAgfVxuICAgIHJldHVybiAoc3RhdGUubW9kZSA9IChuZXdNb2RlIHx8IE1vZGVzLnRleHQpKShzdHJlYW0sIHN0YXRlKTtcbiAgfSxcblxuICBibG9ja1R5cGU6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICB2YXIgbWF0Y2gsIHR5cGU7XG4gICAgc3RhdGUubGF5b3V0VHlwZSA9IG51bGw7XG5cbiAgICBpZiAobWF0Y2ggPSBzdHJlYW0ubWF0Y2goUkUoXCJ0eXBlXCIpKSlcbiAgICAgIHR5cGUgPSBtYXRjaFswXTtcbiAgICBlbHNlXG4gICAgICByZXR1cm4gKHN0YXRlLm1vZGUgPSBNb2Rlcy50ZXh0KShzdHJlYW0sIHN0YXRlKTtcblxuICAgIGlmIChtYXRjaCA9IHR5cGUubWF0Y2goUkUoXCJoZWFkZXJcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJoZWFkZXJcIjtcbiAgICAgIHN0YXRlLmhlYWRlciA9IHBhcnNlSW50KG1hdGNoWzBdWzFdKTtcbiAgICB9IGVsc2UgaWYgKHR5cGUubWF0Y2goUkUoXCJicVwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcInF1b3RlXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwiYmNcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJjb2RlXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwiZm9vdFwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImZvb3Rub3RlXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwibm90ZXh0aWxlXCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwibm90ZXh0aWxlXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwicHJlXCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwicHJlXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwiZGl2XCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwiZGl2XCI7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwidGFibGVcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJ0YWJsZVwiO1xuICAgIH1cblxuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy5hdHRyaWJ1dGVzO1xuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgdGV4dDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJ0ZXh0XCIpKSkgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcblxuICAgIHZhciBjaCA9IHN0cmVhbS5uZXh0KCk7XG4gICAgaWYgKGNoID09PSAnXCInKVxuICAgICAgcmV0dXJuIChzdGF0ZS5tb2RlID0gTW9kZXMubGluaykoc3RyZWFtLCBzdGF0ZSk7XG4gICAgcmV0dXJuIGhhbmRsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIGNoKTtcbiAgfSxcblxuICBhdHRyaWJ1dGVzOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLmxheW91dExlbmd0aDtcblxuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJhdHRyaWJ1dGVzXCIpKSlcbiAgICAgIHJldHVybiBUT0tFTl9TVFlMRVMuYXR0cmlidXRlc1xuICAgIGVsc2VcbiAgICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgbGF5b3V0TGVuZ3RoOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5lYXQoXCIuXCIpICYmIHN0cmVhbS5lYXQoXCIuXCIpKVxuICAgICAgc3RhdGUuc3Bhbm5pbmdMYXlvdXQgPSB0cnVlO1xuXG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLnRleHQ7XG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICBsaXN0OiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgdmFyIG1hdGNoID0gc3RyZWFtLm1hdGNoKFJFKFwibGlzdFwiKSk7XG4gICAgc3RhdGUubGlzdERlcHRoID0gbWF0Y2hbMF0ubGVuZ3RoO1xuICAgIHZhciBsaXN0TW9kID0gKHN0YXRlLmxpc3REZXB0aCAtIDEpICUgMztcbiAgICBpZiAoIWxpc3RNb2QpXG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJsaXN0MVwiO1xuICAgIGVsc2UgaWYgKGxpc3RNb2QgPT09IDEpXG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJsaXN0MlwiO1xuICAgIGVsc2VcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImxpc3QzXCI7XG5cbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMuYXR0cmlidXRlcztcbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIGxpbms6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMudGV4dDtcbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwibGlua1wiKSkpIHtcbiAgICAgIHN0cmVhbS5tYXRjaCgvXFxTKy8pO1xuICAgICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5saW5rXG4gICAgfVxuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgbGlua0RlZmluaXRpb246IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgIHN0cmVhbS5za2lwVG9FbmQoKTtcbiAgICByZXR1cm4gVE9LRU5fU1RZTEVTLmxpbmtEZWZpbml0aW9uXG4gIH0sXG5cbiAgZGVmaW5pdGlvbkxpc3Q6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBzdHJlYW0ubWF0Y2goUkUoXCJkZWZpbml0aW9uTGlzdFwiKSk7XG5cbiAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJkZWZpbml0aW9uTGlzdFwiO1xuXG4gICAgaWYgKHN0cmVhbS5tYXRjaCgvXFxzKiQvKSlcbiAgICAgIHN0YXRlLnNwYW5uaW5nTGF5b3V0ID0gdHJ1ZTtcbiAgICBlbHNlXG4gICAgICBzdGF0ZS5tb2RlID0gTW9kZXMuYXR0cmlidXRlcztcblxuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgaHRtbDogZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgIHJldHVybiBUT0tFTl9TVFlMRVMuaHRtbFxuICB9LFxuXG4gIHRhYmxlOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgc3RhdGUubGF5b3V0VHlwZSA9IFwidGFibGVcIjtcbiAgICByZXR1cm4gKHN0YXRlLm1vZGUgPSBNb2Rlcy50YWJsZUNlbGwpKHN0cmVhbSwgc3RhdGUpO1xuICB9LFxuXG4gIHRhYmxlQ2VsbDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJ0YWJsZUhlYWRpbmdcIikpKVxuICAgICAgc3RhdGUudGFibGVIZWFkaW5nID0gdHJ1ZTtcbiAgICBlbHNlXG4gICAgICBzdHJlYW0uZWF0KFwifFwiKTtcblxuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy50YWJsZUNlbGxBdHRyaWJ1dGVzO1xuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgdGFibGVDZWxsQXR0cmlidXRlczogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy50YWJsZVRleHQ7XG5cbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwidGFibGVDZWxsQXR0cmlidXRlc1wiKSkpXG4gICAgICByZXR1cm4gVE9LRU5fU1RZTEVTLmF0dHJpYnV0ZXNcbiAgICBlbHNlXG4gICAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIHRhYmxlVGV4dDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJ0YWJsZVRleHRcIikpKVxuICAgICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcblxuICAgIGlmIChzdHJlYW0ucGVlaygpID09PSBcInxcIikgeyAvLyBlbmQgb2YgY2VsbFxuICAgICAgc3RhdGUubW9kZSA9IE1vZGVzLnRhYmxlQ2VsbDtcbiAgICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiBoYW5kbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBzdHJlYW0ubmV4dCgpKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHRleHRpbGUgPSB7XG4gIG5hbWU6IFwidGV4dGlsZVwiLFxuICBzdGFydFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4geyBtb2RlOiBNb2Rlcy5uZXdMYXlvdXQgfTtcbiAgfSxcbiAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLnNvbCgpKSBzdGFydE5ld0xpbmUoc3RyZWFtLCBzdGF0ZSk7XG4gICAgcmV0dXJuIHN0YXRlLm1vZGUoc3RyZWFtLCBzdGF0ZSk7XG4gIH0sXG4gIGJsYW5rTGluZTogYmxhbmtMaW5lXG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9