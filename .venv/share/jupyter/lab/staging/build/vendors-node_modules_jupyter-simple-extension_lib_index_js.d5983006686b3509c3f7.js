"use strict";
(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["vendors-node_modules_jupyter-simple-extension_lib_index_js"],{

/***/ "./node_modules/jupyter-simple-extension/lib/api-client.js":
/*!*****************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/api-client.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ApiClient: () => (/* binding */ ApiClient)
/* harmony export */ });
/**
 * API client for interacting with the backend LLM service
 */
class ApiClient {
    constructor(baseUrl = 'http://localhost:8000') {
        this.baseUrl = baseUrl;
    }
    /**
     * Stream a chat response from the mock LLM
     * @param message The user message to send
     * @param context Optional context information
     * @param onChunk Callback for each text chunk received
     * @param onComplete Callback when streaming is complete
     * @param onError Callback for errors
     */
    async streamChat(message, context = null, onChunk, onComplete, onError) {
        try {
            const response = await fetch(`${this.baseUrl}/chat`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message,
                    context
                })
            });
            if (!response.ok) {
                throw new Error(`API error: ${response.statusText}`);
            }
            if (!response.body) {
                throw new Error('ReadableStream not supported in this browser.');
            }
            // Set up stream reading
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let done = false;
            while (!done) {
                const { value, done: readerDone } = await reader.read();
                done = readerDone;
                if (value) {
                    const chunk = decoder.decode(value, { stream: !done });
                    onChunk(chunk);
                }
            }
            onComplete();
        }
        catch (error) {
            onError(error instanceof Error ? error : new Error(String(error)));
        }
    }
    /**
     * Simple health check for the API
     * @returns A promise that resolves to true if the API is healthy
     */
    async healthCheck() {
        try {
            const response = await fetch(`${this.baseUrl}/health`);
            return response.ok;
        }
        catch (error) {
            console.error('API health check failed:', error);
            return false;
        }
    }
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/cell-context-tracker.js":
/*!***************************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/cell-context-tracker.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CellContextTracker: () => (/* binding */ CellContextTracker)
/* harmony export */ });
/**
 * Tracks cell context and cursor position within Jupyter notebooks
 */
class CellContextTracker {
    constructor(app, notebookTracker) {
        this.activeCellEditorNode = null;
        this.lastCellContext = null;
        this._isDisposed = false;
        /**
         * Handles editor events (keydown, mouseup)
         */
        this.handleEditorEvent = (event) => {
            try {
                // Get the current active cell from the tracker
                const cell = this.notebookTracker.activeCell;
                if (!cell || !cell.editor)
                    return;
                // Find the inner EditorView instance
                const editor = cell.editor;
                const view = editor.editor;
                if (!view)
                    return;
                // Get and store the cursor context
                this.lastCellContext = this.getCmContext(view);
            }
            catch (error) {
                console.error("Error in editor event handler:", error);
            }
        };
        this.notebookTracker = notebookTracker;
        this.setupTrackers();
    }
    /**
     * Whether this object has been disposed
     */
    get isDisposed() {
        return this._isDisposed;
    }
    /**
     * Sets up all the necessary event trackers
     */
    setupTrackers() {
        // Handle active cell changes
        this.notebookTracker.activeCellChanged.connect(this.setupCellListeners, this);
        // Handle notebook changes
        this.notebookTracker.currentChanged.connect(this.handleNotebookChange, this);
    }
    /**
     * Handles notebook changes
     */
    handleNotebookChange(tracker, panel) {
        this.cleanupPreviousListeners();
        if (panel && panel.content) {
            const cell = panel.content.activeCell;
            this.setupCellListeners(tracker, cell);
        }
    }
    /**
     * Sets up event listeners on the active cell
     */
    setupCellListeners(_tracker, cell) {
        if (!cell)
            return;
        this.cleanupPreviousListeners();
        if (cell.editor) {
            try {
                const cellNode = cell.node;
                const editorNode = cellNode.querySelector('.jp-Editor') ||
                    cellNode.querySelector('.jp-InputArea-editor');
                if (editorNode) {
                    this.activeCellEditorNode = editorNode;
                    // Add event listeners for key and mouse events
                    editorNode.addEventListener('keydown', this.handleEditorEvent);
                    editorNode.addEventListener('mouseup', this.handleEditorEvent);
                    // Try to capture immediate context if EditorView available
                    const view = cell.editor.editor;
                    if (view) {
                        this.lastCellContext = this.getCmContext(view);
                    }
                }
            }
            catch (error) {
                console.error("Error setting up cell listeners:", error);
            }
        }
    }
    /**
     * Cleans up event listeners from the previous active cell
     */
    cleanupPreviousListeners() {
        if (this.activeCellEditorNode) {
            this.activeCellEditorNode.removeEventListener('keydown', this.handleEditorEvent);
            this.activeCellEditorNode.removeEventListener('mouseup', this.handleEditorEvent);
            this.activeCellEditorNode = null;
        }
    }
    /**
     * Gets context information from CodeMirror EditorView
     */
    getCmContext(view) {
        const state = view.state;
        const offset = state.selection.main.head;
        const fullText = state.doc.toString();
        const line = state.doc.lineAt(offset);
        const position = {
            line: line.number - 1,
            column: offset - line.from,
            offset: offset
        };
        const contextRadius = 100;
        const start = Math.max(0, offset - contextRadius);
        const end = Math.min(fullText.length, offset + contextRadius);
        return {
            text: fullText,
            position: position,
            contextBefore: fullText.substring(start, offset),
            contextAfter: fullText.substring(offset, end)
        };
    }
    /**
     * Gets the current cell context
     */
    getCurrentCellContext() {
        return this.lastCellContext;
    }
    /**
     * Disposes all resources
     */
    dispose() {
        if (this._isDisposed) {
            return;
        }
        this._isDisposed = true;
        this.cleanupPreviousListeners();
        this.notebookTracker.activeCellChanged.disconnect(this.setupCellListeners, this);
        this.notebookTracker.currentChanged.disconnect(this.handleNotebookChange, this);
    }
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/commands.js":
/*!***************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/commands.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   registerCommands: () => (/* binding */ registerCommands)
/* harmony export */ });
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./icons */ "./node_modules/jupyter-simple-extension/lib/icons.js");

/**
 * Registers commands for the extension
 */
function registerCommands(app, palette, launcher, sidebarWidget) {
    // Add command to toggle the sidebar
    app.commands.addCommand('simple-extension:toggle-sidebar', {
        label: 'Toggle AI Assistant Sidebar',
        icon: _icons__WEBPACK_IMPORTED_MODULE_0__.extensionIcon,
        execute: () => {
            if (sidebarWidget.isAttached) {
                sidebarWidget.parent = null;
            }
            else {
                app.shell.add(sidebarWidget, 'left', { rank: 9999 });
            }
        }
    });
    // Add the command to the command palette
    palette.addItem({
        command: 'simple-extension:toggle-sidebar',
        category: 'Extension'
    });
    // Add a launcher item
    launcher.add({
        command: 'simple-extension:toggle-sidebar',
        category: 'Other',
        rank: 9999
    });
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/globals.js":
/*!**************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/globals.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   globals: () => (/* binding */ globals),
/* harmony export */   initGlobals: () => (/* binding */ initGlobals)
/* harmony export */ });
/**
 * Global references to key components in the application
 */
const globals = {};
/**
 * Initialize global references
 */
function initGlobals(app, notebookTracker) {
    globals.app = app;
    globals.notebookTracker = notebookTracker;
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/icons.js":
/*!************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/icons.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   extensionIcon: () => (/* binding */ extensionIcon)
/* harmony export */ });
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/ui-components */ "webpack/sharing/consume/default/@jupyterlab/ui-components/@jupyterlab/ui-components");
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__);

// ===============================
// Icon Definition
// ===============================
const iconSvgStr = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-text" viewBox="0 0 16 16">' +
    '<path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>' +
    '<path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>' +
    '</svg>';
/**
 * Icon for the AI Assistant extension
 */
const extensionIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'simple:icon',
    svgstr: iconSvgStr
});


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/index.js":
/*!************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/index.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ApiClient: () => (/* reexport safe */ _api_client__WEBPACK_IMPORTED_MODULE_8__.ApiClient),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/launcher */ "webpack/sharing/consume/default/@jupyterlab/launcher/@jupyterlab/launcher");
/* harmony import */ var _jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @jupyterlab/notebook */ "webpack/sharing/consume/default/@jupyterlab/notebook/@jupyterlab/notebook");
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @jupyterlab/docmanager */ "webpack/sharing/consume/default/@jupyterlab/docmanager/@jupyterlab/docmanager");
/* harmony import */ var _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _sidebar_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sidebar-widget */ "./node_modules/jupyter-simple-extension/lib/sidebar-widget.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./node_modules/jupyter-simple-extension/lib/globals.js");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./commands */ "./node_modules/jupyter-simple-extension/lib/commands.js");
/* harmony import */ var _cell_context_tracker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./cell-context-tracker */ "./node_modules/jupyter-simple-extension/lib/cell-context-tracker.js");
/* harmony import */ var _api_client__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./api-client */ "./node_modules/jupyter-simple-extension/lib/api-client.js");








// import { ApiClient } from './api-client';
// Export ApiClient for use by other components

/**
 * Initialization data for the jupyter-simple-extension extension.
 */
const plugin = {
    id: 'jupyter-simple-extension:plugin',
    autoStart: true,
    requires: [_jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0__.ILauncher, _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__.ICommandPalette, _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2__.INotebookTracker, _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3__.IDocumentManager],
    activate: (jupyterApp, launcher, palette, tracker, docManager) => {
        console.log('JupyterLab extension jupyter-simple-extension is activated!');
        // Initialize global references
        (0,_globals__WEBPACK_IMPORTED_MODULE_5__.initGlobals)(jupyterApp, tracker);
        // Initialize cell context tracker
        _globals__WEBPACK_IMPORTED_MODULE_5__.globals.cellContextTracker = new _cell_context_tracker__WEBPACK_IMPORTED_MODULE_7__.CellContextTracker(jupyterApp, tracker);
        // Create and add sidebar widget
        const sidebarWidget = new _sidebar_widget__WEBPACK_IMPORTED_MODULE_4__.SimpleSidebarWidget(docManager);
        jupyterApp.shell.add(sidebarWidget, 'left', { rank: 9999 });
        // Register commands
        (0,_commands__WEBPACK_IMPORTED_MODULE_6__.registerCommands)(jupyterApp, palette, launcher, sidebarWidget);
    }
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (plugin);


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/sidebar-widget.js":
/*!*********************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/sidebar-widget.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SimpleSidebarWidget: () => (/* binding */ SimpleSidebarWidget)
/* harmony export */ });
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @lumino/widgets */ "webpack/sharing/consume/default/@lumino/widgets/@lumino/widgets");
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lumino_widgets__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jupyterlab/notebook */ "webpack/sharing/consume/default/@jupyterlab/notebook/@jupyterlab/notebook");
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var marked__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! marked */ "webpack/sharing/consume/default/marked/marked");
/* harmony import */ var marked__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(marked__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! dompurify */ "webpack/sharing/consume/default/dompurify/dompurify");
/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./icons */ "./node_modules/jupyter-simple-extension/lib/icons.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./node_modules/jupyter-simple-extension/lib/globals.js");
/* harmony import */ var _api_client__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./api-client */ "./node_modules/jupyter-simple-extension/lib/api-client.js");







/**
 * Main sidebar widget for the AI chat interface
 */
class SimpleSidebarWidget extends _lumino_widgets__WEBPACK_IMPORTED_MODULE_0__.Widget {
    constructor(docManager) {
        super();
        this.isMarkdownMode = false;
        this.isInputExpanded = false;
        this.chatHistory = [];
        this.currentChatId = '';
        this.isHistoryViewActive = false;
        this.docManager = docManager;
        this.id = 'simple-sidebar';
        this.title.label = '';
        this.title.caption = 'AI Chat Interface';
        this.title.icon = _icons__WEBPACK_IMPORTED_MODULE_4__.extensionIcon;
        this.title.closable = true;
        // Initialize API client
        this.apiClient = new _api_client__WEBPACK_IMPORTED_MODULE_6__.ApiClient();
        // Initialize container elements before creating layout
        this.messageContainer = document.createElement('div');
        this.inputContainer = document.createElement('div');
        this.inputField = document.createElement('textarea');
        this.titleInput = document.createElement('input');
        this.historyContainer = document.createElement('div');
        // Create a new chat on start
        this.createNewChat();
        this.node.appendChild(this.createLayout());
    }
    /**
     * Creates the main layout for the sidebar
     */
    createLayout() {
        // Create the main container
        const content = document.createElement('div');
        content.className = 'simple-sidebar-content';
        // Create title input container
        const titleContainer = document.createElement('div');
        titleContainer.className = 'title-container';
        // Set up title input
        this.titleInput.className = 'chat-title-input';
        this.titleInput.type = 'text';
        this.titleInput.placeholder = 'Chat title';
        this.titleInput.value = 'New Chat';
        this.titleInput.addEventListener('change', () => this.updateCurrentChatTitle());
        titleContainer.appendChild(this.titleInput);
        // Configure top action buttons (New Chat & History)
        const topActionsContainer = document.createElement('div');
        topActionsContainer.className = 'top-actions-container';
        const newChatButton = document.createElement('button');
        newChatButton.className = 'jp-Button action-button';
        newChatButton.textContent = '+ New Chat';
        newChatButton.title = 'Start a new chat';
        newChatButton.addEventListener('click', () => this.createNewChat());
        const historyButton = document.createElement('button');
        historyButton.className = 'jp-Button action-button';
        historyButton.textContent = 'History';
        historyButton.title = 'View chat history';
        historyButton.addEventListener('click', () => this.toggleHistoryView());
        topActionsContainer.appendChild(newChatButton);
        topActionsContainer.appendChild(historyButton);
        // Configure message container
        this.messageContainer.className = 'message-container';
        // Configure history container
        this.historyContainer.className = 'history-container';
        this.historyContainer.style.display = 'none'; // Initially hidden
        // Configure input container
        this.inputContainer.className = 'input-container';
        // Create controls container
        const controlsContainer = this.createControlsContainer();
        // Configure input field
        this.inputField.placeholder = 'Ask me anything...';
        this.inputField.style.flexGrow = '1';
        this.inputField.style.padding = '5px';
        this.inputField.style.border = '1px solid #ccc';
        this.inputField.style.borderRadius = '3px';
        this.inputField.style.resize = 'none';
        this.inputField.rows = 1;
        this.inputField.style.overflowY = 'auto';
        // Add keypress listener to input field
        this.inputField.addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                this.handleSendMessage();
            }
        });
        // Create send button container
        const inputActionsContainer = document.createElement('div');
        inputActionsContainer.className = 'input-actions-container';
        // Create send button
        const sendButton = document.createElement('button');
        sendButton.className = 'jp-Button send-button';
        sendButton.textContent = 'Send';
        sendButton.addEventListener('click', () => this.handleSendMessage());
        // Add button to actions container
        inputActionsContainer.appendChild(sendButton);
        // Assemble the input components
        this.inputContainer.appendChild(controlsContainer);
        this.inputContainer.appendChild(this.inputField);
        this.inputContainer.appendChild(inputActionsContainer);
        // Assemble all components
        content.appendChild(topActionsContainer);
        content.appendChild(titleContainer);
        content.appendChild(this.messageContainer);
        content.appendChild(this.historyContainer);
        content.appendChild(this.inputContainer);
        return content;
    }
    /**
     * Creates a new chat session
     */
    createNewChat() {
        // Generate a unique ID for the chat
        const chatId = `chat-${Date.now()}`;
        // Create a new chat item
        const newChat = {
            id: chatId,
            title: 'New Chat',
            messages: []
        };
        // Add to history
        this.chatHistory.push(newChat);
        // Set as current chat
        this.currentChatId = chatId;
        // Update title input
        this.titleInput.value = newChat.title;
        // Clear message container
        if (this.messageContainer) {
            this.messageContainer.innerHTML = '';
        }
        // Hide history if it's visible
        if (this.isHistoryViewActive) {
            this.toggleHistoryView();
        }
    }
    /**
     * Toggles between chat view and history view
     */
    toggleHistoryView() {
        this.isHistoryViewActive = !this.isHistoryViewActive;
        if (this.isHistoryViewActive) {
            // Show history view, hide message view
            this.messageContainer.style.display = 'none';
            this.historyContainer.style.display = 'block';
            this.inputContainer.style.display = 'none';
            this.titleInput.style.display = 'none';
            // Populate history
            this.renderChatHistory();
        }
        else {
            // Show message view, hide history view
            this.messageContainer.style.display = 'block';
            this.historyContainer.style.display = 'none';
            this.inputContainer.style.display = 'flex';
            this.titleInput.style.display = 'block';
        }
    }
    /**
     * Renders the chat history in the history container
     */
    renderChatHistory() {
        this.historyContainer.innerHTML = '';
        if (this.chatHistory.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-history-message';
            emptyMessage.textContent = 'No chat history yet';
            this.historyContainer.appendChild(emptyMessage);
            return;
        }
        // Create a list of chat history items
        this.chatHistory.forEach(chat => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            if (chat.id === this.currentChatId) {
                historyItem.classList.add('active');
            }
            // Add title
            const title = document.createElement('div');
            title.className = 'history-title';
            title.textContent = chat.title;
            // Add message preview
            const preview = document.createElement('div');
            preview.className = 'history-preview';
            const lastMessage = chat.messages[chat.messages.length - 1];
            preview.textContent = lastMessage
                ? `${lastMessage.text.substring(0, 40)}${lastMessage.text.length > 40 ? '...' : ''}`
                : 'Empty chat';
            // Add click event
            historyItem.addEventListener('click', () => this.loadChat(chat.id));
            historyItem.appendChild(title);
            historyItem.appendChild(preview);
            this.historyContainer.appendChild(historyItem);
        });
    }
    /**
     * Loads a chat from history
     */
    loadChat(chatId) {
        const chat = this.chatHistory.find(c => c.id === chatId);
        if (!chat)
            return;
        // Set as current chat
        this.currentChatId = chatId;
        // Update title
        this.titleInput.value = chat.title;
        // Clear and re-populate message container
        this.messageContainer.innerHTML = '';
        chat.messages.forEach(msg => {
            this.addMessage(msg.text, msg.sender, msg.isMarkdown, false);
        });
        // Switch back to chat view
        if (this.isHistoryViewActive) {
            this.toggleHistoryView();
        }
    }
    /**
     * Updates the title of the current chat
     */
    updateCurrentChatTitle() {
        const chat = this.chatHistory.find(c => c.id === this.currentChatId);
        if (chat) {
            chat.title = this.titleInput.value;
        }
    }
    /**
     * Creates the controls container with toggles and action buttons
     */
    createControlsContainer() {
        const controlsContainer = document.createElement('div');
        controlsContainer.className = 'controls-container';
        // Create markdown toggle container
        const toggleContainer = document.createElement('div');
        toggleContainer.className = 'toggle-container';
        // Create markdown toggle
        const markdownToggle = document.createElement('input');
        markdownToggle.type = 'checkbox';
        markdownToggle.id = 'markdown-toggle';
        markdownToggle.style.marginRight = '5px';
        markdownToggle.addEventListener('change', (e) => {
            const target = e.target;
            this.isMarkdownMode = target.checked;
            this.inputField.placeholder = this.isMarkdownMode ?
                'Write markdown here...\n\n# Example heading\n- List item\n\n```code block```' :
                'Ask me anything...';
        });
        // Create toggle label
        const toggleLabel = document.createElement('label');
        toggleLabel.htmlFor = 'markdown-toggle';
        toggleLabel.textContent = 'Markdown mode';
        toggleLabel.style.fontSize = '12px';
        // Add toggle elements to container
        toggleContainer.appendChild(markdownToggle);
        toggleContainer.appendChild(toggleLabel);
        // Create action buttons container
        const actionButtonsContainer = document.createElement('div');
        actionButtonsContainer.className = 'action-buttons-container';
        // Create all action buttons
        const buttons = [
            { text: '@', title: 'Command list', action: () => { } },
            { text: '📎', title: 'Upload file', action: () => { } },
            { text: '🔍', title: 'Browse files', action: () => { } },
            {
                text: '⤢',
                title: 'Expand input',
                action: () => this.toggleInputExpansion(actionButtonsContainer.children[3])
            },
            { text: '⚙️', title: 'Settings', action: () => { } },
            { text: '📁', title: 'List Directory Contents', action: () => this.listCurrentDirectoryContents() }
        ];
        // Add all buttons to the container
        buttons.forEach(button => {
            const btn = this.createButton(button.text, button.title);
            btn.addEventListener('click', button.action);
            actionButtonsContainer.appendChild(btn);
        });
        // Add toggle and action buttons to the controls container
        controlsContainer.appendChild(toggleContainer);
        controlsContainer.appendChild(actionButtonsContainer);
        return controlsContainer;
    }
    /**
     * Toggles the expansion state of the input field
     */
    toggleInputExpansion(button) {
        this.isInputExpanded = !this.isInputExpanded;
        if (this.isInputExpanded) {
            this.inputField.style.height = '100px';
            this.inputField.style.resize = 'vertical';
            button.textContent = '⤡';
            button.title = 'Collapse input';
        }
        else {
            this.inputField.style.height = 'auto';
            this.inputField.style.resize = 'none';
            button.textContent = '⤢';
            button.title = 'Expand input';
        }
    }
    /**
     * Helper function to create a button with given text and tooltip
     */
    createButton(text, tooltip) {
        const button = document.createElement('button');
        button.textContent = text;
        button.title = tooltip;
        button.className = 'jp-Button action-button';
        return button;
    }
    /**
     * Handles sending a message from the input field
     */
    handleSendMessage() {
        const message = this.inputField.value.trim();
        if (message) {
            // Add user message to UI
            this.addMessage(message, 'user', this.isMarkdownMode);
            this.inputField.value = '';
            // Reset expanded state if needed after sending
            if (this.isInputExpanded) {
                this.inputField.style.height = '100px';
            }
            else {
                this.inputField.style.height = 'auto';
                this.inputField.rows = 1;
            }
            // Create a temporary message container for the bot's streaming response
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'bot-message';
            const markdownIndicator = document.createElement('div');
            markdownIndicator.textContent = "MD";
            markdownIndicator.className = 'markdown-indicator';
            botMessageDiv.appendChild(markdownIndicator);
            const contentDiv = document.createElement('div');
            contentDiv.className = 'markdown-content';
            contentDiv.textContent = ''; // Start empty
            botMessageDiv.appendChild(contentDiv);
            this.messageContainer.appendChild(botMessageDiv);
            // Variable to collect the complete response
            let completeResponse = '';
            // Get cell context if available
            const cellContext = _globals__WEBPACK_IMPORTED_MODULE_5__.globals.cellContextTracker ?
                _globals__WEBPACK_IMPORTED_MODULE_5__.globals.cellContextTracker.getCurrentCellContext() : null;
            // Stream response from API
            this.apiClient.streamChat(message, { cellContext }, 
            // On each chunk received
            (chunk) => {
                completeResponse += chunk;
                contentDiv.textContent = completeResponse;
                this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
            }, 
            // On complete
            () => {
                // Replace plain text with rendered markdown
                try {
                    const rawHtml = marked__WEBPACK_IMPORTED_MODULE_2__.marked.parse(completeResponse);
                    const sanitizedHtml = dompurify__WEBPACK_IMPORTED_MODULE_3___default().sanitize(rawHtml);
                    contentDiv.innerHTML = sanitizedHtml;
                }
                catch (error) {
                    console.error('Failed to render markdown:', error);
                }
                // Save to chat history
                const chat = this.chatHistory.find(c => c.id === this.currentChatId);
                if (chat) {
                    chat.messages.push({
                        text: completeResponse,
                        sender: 'bot',
                        isMarkdown: true
                    });
                }
                this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
            }, 
            // On error
            (error) => {
                contentDiv.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
                console.error('API Error:', error);
            });
        }
    }
    /**
     * Adds a message to the chat interface
     */
    addMessage(text, sender, isMarkdown = false, saveToHistory = true) {
        const messageDiv = document.createElement('div');
        messageDiv.className = sender === 'user' ? 'user-message' : 'bot-message';
        // Add message content
        if (isMarkdown || sender === 'bot') {
            // Bot messages are always rendered as markdown
            const markdownIndicator = document.createElement('div');
            markdownIndicator.textContent = "MD";
            markdownIndicator.className = 'markdown-indicator';
            messageDiv.appendChild(markdownIndicator);
            // Create a container for the rendered markdown
            const contentDiv = document.createElement('div');
            contentDiv.className = 'markdown-content';
            try {
                const rawHtml = marked__WEBPACK_IMPORTED_MODULE_2__.marked.parse(text);
                const sanitizedHtml = dompurify__WEBPACK_IMPORTED_MODULE_3___default().sanitize(rawHtml);
                contentDiv.innerHTML = sanitizedHtml;
            }
            catch (error) {
                contentDiv.textContent = text;
                console.error('Failed to render markdown:', error);
            }
            messageDiv.appendChild(contentDiv);
        }
        else {
            messageDiv.textContent = text;
        }
        this.messageContainer.appendChild(messageDiv);
        this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
        // Save to chat history
        if (saveToHistory) {
            const chat = this.chatHistory.find(c => c.id === this.currentChatId);
            if (chat) {
                chat.messages.push({
                    text,
                    sender,
                    isMarkdown: isMarkdown || sender === 'bot'
                });
            }
        }
    }
    /**
     * Lists the contents of the current directory
     */
    async listCurrentDirectoryContents() {
        let dirPath = null;
        let source = null;
        // Try to get directory path from current widget
        const app = _globals__WEBPACK_IMPORTED_MODULE_5__.globals.app;
        if (!app) {
            this.addMessage('Error: Application reference not available', 'bot', false);
            return;
        }
        const currentShellWidget = app.shell.currentWidget;
        if (currentShellWidget) {
            const widgetContext = this.docManager.contextForWidget(currentShellWidget);
            if (widgetContext) {
                const path = widgetContext.path;
                const lastSlash = path.lastIndexOf('/');
                dirPath = lastSlash === -1 ? '' : path.substring(0, lastSlash);
                source = 'widget context';
            }
        }
        // Fallback to notebook tracker if no context from widget
        if (dirPath === null && _globals__WEBPACK_IMPORTED_MODULE_5__.globals.notebookTracker) {
            const currentNotebookPanel = _globals__WEBPACK_IMPORTED_MODULE_5__.globals.notebookTracker.currentWidget;
            if (currentNotebookPanel instanceof _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1__.NotebookPanel) {
                const nbPath = currentNotebookPanel.context.path;
                const lastSlash = nbPath.lastIndexOf('/');
                dirPath = lastSlash === -1 ? '' : nbPath.substring(0, lastSlash);
                source = 'active notebook';
            }
        }
        // List contents if path was found
        if (dirPath !== null) {
            try {
                const contents = await this.docManager.services.contents.get(dirPath);
                if (contents.content && contents.content.length > 0) {
                    const messageContent = `Directory contents (${source}):\n${contents.content.map((item) => `- ${item.name} (${item.type})`).join('\n')}`;
                    this.addMessage(messageContent, 'bot', true);
                }
                else {
                    this.addMessage(`Directory "${dirPath || '/'}" is empty.`, 'bot', true);
                }
            }
            catch (error) {
                this.addMessage(`Error listing directory contents for "${dirPath}": ${error}`, 'bot', true);
            }
        }
        else {
            this.addMessage('Could not determine current directory context.', 'bot', true);
        }
    }
}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uX2xpYl9pbmRleF9qcy5kNTk4MzAwNjY4NmIzNTA5YzNmNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxhQUFhO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0EsOENBQThDLG9CQUFvQjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsMEJBQTBCO0FBQ2xEO0FBQ0E7QUFDQSwwREFBMEQsZUFBZTtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsYUFBYTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7QUNqRUE7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FDekl3QztBQUN4QztBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQWE7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxZQUFZO0FBQ25FO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7Ozs7Ozs7Ozs7Ozs7OztBQzdCQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQ1ZvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLDBCQUEwQiw4REFBTztBQUN4QztBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNkZ0Q7QUFDTTtBQUNDO0FBQ0U7QUFDSDtBQUNOO0FBQ0g7QUFDYztBQUM1RCxZQUFZLFlBQVk7QUFDeEI7QUFDeUM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSwyREFBUyxFQUFFLGlFQUFlLEVBQUUsa0VBQWdCLEVBQUUsb0VBQWdCO0FBQzdFO0FBQ0E7QUFDQTtBQUNBLFFBQVEscURBQVc7QUFDbkI7QUFDQSxRQUFRLDZDQUFPLDBCQUEwQixxRUFBa0I7QUFDM0Q7QUFDQSxrQ0FBa0MsZ0VBQW1CO0FBQ3JELHNEQUFzRCxZQUFZO0FBQ2xFO0FBQ0EsUUFBUSwyREFBZ0I7QUFDeEI7QUFDQTtBQUNBLGlFQUFlLE1BQU0sRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMvQm1CO0FBQ1k7QUFDckI7QUFDRTtBQUNNO0FBQ0o7QUFDSztBQUN6QztBQUNBO0FBQ0E7QUFDTyxrQ0FBa0MsbURBQU07QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpREFBYTtBQUN2QztBQUNBO0FBQ0EsNkJBQTZCLGtEQUFTO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNEO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixXQUFXO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsa0NBQWtDLEVBQUUsMENBQTBDO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMscURBQXFEO0FBQ25FLGNBQWMscURBQXFEO0FBQ25FLGNBQWMsc0RBQXNEO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLGNBQWMsa0RBQWtEO0FBQ2hFLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLDZDQUFPO0FBQ3ZDLGdCQUFnQiw2Q0FBTztBQUN2QjtBQUNBLGlEQUFpRCxhQUFhO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsMENBQU07QUFDMUMsMENBQTBDLHlEQUFrQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsNEVBQTRFLGNBQWM7QUFDMUY7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsMENBQU07QUFDdEMsc0NBQXNDLHlEQUFrQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsNkNBQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLDZDQUFPO0FBQ3ZDLHlDQUF5Qyw2Q0FBTztBQUNoRCxnREFBZ0QsK0RBQWE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSxPQUFPLE1BQU0sb0NBQW9DLFdBQVcsR0FBRyxVQUFVLGVBQWU7QUFDMUo7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELGVBQWU7QUFDakU7QUFDQTtBQUNBO0FBQ0EseUVBQXlFLFFBQVEsS0FBSyxNQUFNO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4vbm9kZV9tb2R1bGVzL2p1cHl0ZXItc2ltcGxlLWV4dGVuc2lvbi9saWIvYXBpLWNsaWVudC5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uL2xpYi9jZWxsLWNvbnRleHQtdHJhY2tlci5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uL2xpYi9jb21tYW5kcy5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uL2xpYi9nbG9iYWxzLmpzIiwid2VicGFjazovL0BqdXB5dGVybGFiL2FwcGxpY2F0aW9uLXRvcC8uL25vZGVfbW9kdWxlcy9qdXB5dGVyLXNpbXBsZS1leHRlbnNpb24vbGliL2ljb25zLmpzIiwid2VicGFjazovL0BqdXB5dGVybGFiL2FwcGxpY2F0aW9uLXRvcC8uL25vZGVfbW9kdWxlcy9qdXB5dGVyLXNpbXBsZS1leHRlbnNpb24vbGliL2luZGV4LmpzIiwid2VicGFjazovL0BqdXB5dGVybGFiL2FwcGxpY2F0aW9uLXRvcC8uL25vZGVfbW9kdWxlcy9qdXB5dGVyLXNpbXBsZS1leHRlbnNpb24vbGliL3NpZGViYXItd2lkZ2V0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIGNsaWVudCBmb3IgaW50ZXJhY3Rpbmcgd2l0aCB0aGUgYmFja2VuZCBMTE0gc2VydmljZVxuICovXG5leHBvcnQgY2xhc3MgQXBpQ2xpZW50IHtcbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCcpIHtcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RyZWFtIGEgY2hhdCByZXNwb25zZSBmcm9tIHRoZSBtb2NrIExMTVxuICAgICAqIEBwYXJhbSBtZXNzYWdlIFRoZSB1c2VyIG1lc3NhZ2UgdG8gc2VuZFxuICAgICAqIEBwYXJhbSBjb250ZXh0IE9wdGlvbmFsIGNvbnRleHQgaW5mb3JtYXRpb25cbiAgICAgKiBAcGFyYW0gb25DaHVuayBDYWxsYmFjayBmb3IgZWFjaCB0ZXh0IGNodW5rIHJlY2VpdmVkXG4gICAgICogQHBhcmFtIG9uQ29tcGxldGUgQ2FsbGJhY2sgd2hlbiBzdHJlYW1pbmcgaXMgY29tcGxldGVcbiAgICAgKiBAcGFyYW0gb25FcnJvciBDYWxsYmFjayBmb3IgZXJyb3JzXG4gICAgICovXG4gICAgYXN5bmMgc3RyZWFtQ2hhdChtZXNzYWdlLCBjb250ZXh0ID0gbnVsbCwgb25DaHVuaywgb25Db21wbGV0ZSwgb25FcnJvcikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NoYXRgLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmJvZHkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlYWRhYmxlU3RyZWFtIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2V0IHVwIHN0cmVhbSByZWFkaW5nXG4gICAgICAgICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpO1xuICAgICAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xuICAgICAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHdoaWxlICghZG9uZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWUsIGRvbmU6IHJlYWRlckRvbmUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7XG4gICAgICAgICAgICAgICAgZG9uZSA9IHJlYWRlckRvbmU7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNodW5rID0gZGVjb2Rlci5kZWNvZGUodmFsdWUsIHsgc3RyZWFtOiAhZG9uZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgb25DaHVuayhjaHVuayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb25Db21wbGV0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgb25FcnJvcihlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNpbXBsZSBoZWFsdGggY2hlY2sgZm9yIHRoZSBBUElcbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byB0cnVlIGlmIHRoZSBBUEkgaXMgaGVhbHRoeVxuICAgICAqL1xuICAgIGFzeW5jIGhlYWx0aENoZWNrKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2hlYWx0aGApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQVBJIGhlYWx0aCBjaGVjayBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiLyoqXG4gKiBUcmFja3MgY2VsbCBjb250ZXh0IGFuZCBjdXJzb3IgcG9zaXRpb24gd2l0aGluIEp1cHl0ZXIgbm90ZWJvb2tzXG4gKi9cbmV4cG9ydCBjbGFzcyBDZWxsQ29udGV4dFRyYWNrZXIge1xuICAgIGNvbnN0cnVjdG9yKGFwcCwgbm90ZWJvb2tUcmFja2VyKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlQ2VsbEVkaXRvck5vZGUgPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RDZWxsQ29udGV4dCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2lzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgZWRpdG9yIGV2ZW50cyAoa2V5ZG93biwgbW91c2V1cClcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaGFuZGxlRWRpdG9yRXZlbnQgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IGFjdGl2ZSBjZWxsIGZyb20gdGhlIHRyYWNrZXJcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5ub3RlYm9va1RyYWNrZXIuYWN0aXZlQ2VsbDtcbiAgICAgICAgICAgICAgICBpZiAoIWNlbGwgfHwgIWNlbGwuZWRpdG9yKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgaW5uZXIgRWRpdG9yVmlldyBpbnN0YW5jZVxuICAgICAgICAgICAgICAgIGNvbnN0IGVkaXRvciA9IGNlbGwuZWRpdG9yO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBlZGl0b3IuZWRpdG9yO1xuICAgICAgICAgICAgICAgIGlmICghdmlldylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIC8vIEdldCBhbmQgc3RvcmUgdGhlIGN1cnNvciBjb250ZXh0XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q2VsbENvbnRleHQgPSB0aGlzLmdldENtQ29udGV4dCh2aWV3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBlZGl0b3IgZXZlbnQgaGFuZGxlcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm5vdGVib29rVHJhY2tlciA9IG5vdGVib29rVHJhY2tlcjtcbiAgICAgICAgdGhpcy5zZXR1cFRyYWNrZXJzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhpcyBvYmplY3QgaGFzIGJlZW4gZGlzcG9zZWRcbiAgICAgKi9cbiAgICBnZXQgaXNEaXNwb3NlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGlzcG9zZWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgYWxsIHRoZSBuZWNlc3NhcnkgZXZlbnQgdHJhY2tlcnNcbiAgICAgKi9cbiAgICBzZXR1cFRyYWNrZXJzKCkge1xuICAgICAgICAvLyBIYW5kbGUgYWN0aXZlIGNlbGwgY2hhbmdlc1xuICAgICAgICB0aGlzLm5vdGVib29rVHJhY2tlci5hY3RpdmVDZWxsQ2hhbmdlZC5jb25uZWN0KHRoaXMuc2V0dXBDZWxsTGlzdGVuZXJzLCB0aGlzKTtcbiAgICAgICAgLy8gSGFuZGxlIG5vdGVib29rIGNoYW5nZXNcbiAgICAgICAgdGhpcy5ub3RlYm9va1RyYWNrZXIuY3VycmVudENoYW5nZWQuY29ubmVjdCh0aGlzLmhhbmRsZU5vdGVib29rQ2hhbmdlLCB0aGlzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBub3RlYm9vayBjaGFuZ2VzXG4gICAgICovXG4gICAgaGFuZGxlTm90ZWJvb2tDaGFuZ2UodHJhY2tlciwgcGFuZWwpIHtcbiAgICAgICAgdGhpcy5jbGVhbnVwUHJldmlvdXNMaXN0ZW5lcnMoKTtcbiAgICAgICAgaWYgKHBhbmVsICYmIHBhbmVsLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBwYW5lbC5jb250ZW50LmFjdGl2ZUNlbGw7XG4gICAgICAgICAgICB0aGlzLnNldHVwQ2VsbExpc3RlbmVycyh0cmFja2VyLCBjZWxsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGV2ZW50IGxpc3RlbmVycyBvbiB0aGUgYWN0aXZlIGNlbGxcbiAgICAgKi9cbiAgICBzZXR1cENlbGxMaXN0ZW5lcnMoX3RyYWNrZXIsIGNlbGwpIHtcbiAgICAgICAgaWYgKCFjZWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmNsZWFudXBQcmV2aW91c0xpc3RlbmVycygpO1xuICAgICAgICBpZiAoY2VsbC5lZGl0b3IpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbE5vZGUgPSBjZWxsLm5vZGU7XG4gICAgICAgICAgICAgICAgY29uc3QgZWRpdG9yTm9kZSA9IGNlbGxOb2RlLnF1ZXJ5U2VsZWN0b3IoJy5qcC1FZGl0b3InKSB8fFxuICAgICAgICAgICAgICAgICAgICBjZWxsTm9kZS5xdWVyeVNlbGVjdG9yKCcuanAtSW5wdXRBcmVhLWVkaXRvcicpO1xuICAgICAgICAgICAgICAgIGlmIChlZGl0b3JOb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlQ2VsbEVkaXRvck5vZGUgPSBlZGl0b3JOb2RlO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzIGZvciBrZXkgYW5kIG1vdXNlIGV2ZW50c1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3JOb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmhhbmRsZUVkaXRvckV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yTm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5oYW5kbGVFZGl0b3JFdmVudCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRyeSB0byBjYXB0dXJlIGltbWVkaWF0ZSBjb250ZXh0IGlmIEVkaXRvclZpZXcgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBjZWxsLmVkaXRvci5lZGl0b3I7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RDZWxsQ29udGV4dCA9IHRoaXMuZ2V0Q21Db250ZXh0KHZpZXcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNldHRpbmcgdXAgY2VsbCBsaXN0ZW5lcnM6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbGVhbnMgdXAgZXZlbnQgbGlzdGVuZXJzIGZyb20gdGhlIHByZXZpb3VzIGFjdGl2ZSBjZWxsXG4gICAgICovXG4gICAgY2xlYW51cFByZXZpb3VzTGlzdGVuZXJzKCkge1xuICAgICAgICBpZiAodGhpcy5hY3RpdmVDZWxsRWRpdG9yTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVDZWxsRWRpdG9yTm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVFZGl0b3JFdmVudCk7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUNlbGxFZGl0b3JOb2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLmhhbmRsZUVkaXRvckV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlQ2VsbEVkaXRvck5vZGUgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgY29udGV4dCBpbmZvcm1hdGlvbiBmcm9tIENvZGVNaXJyb3IgRWRpdG9yVmlld1xuICAgICAqL1xuICAgIGdldENtQ29udGV4dCh2aWV3KSB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gdmlldy5zdGF0ZTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc3RhdGUuc2VsZWN0aW9uLm1haW4uaGVhZDtcbiAgICAgICAgY29uc3QgZnVsbFRleHQgPSBzdGF0ZS5kb2MudG9TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgbGluZSA9IHN0YXRlLmRvYy5saW5lQXQob2Zmc2V0KTtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICBsaW5lOiBsaW5lLm51bWJlciAtIDEsXG4gICAgICAgICAgICBjb2x1bW46IG9mZnNldCAtIGxpbmUuZnJvbSxcbiAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGNvbnRleHRSYWRpdXMgPSAxMDA7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoMCwgb2Zmc2V0IC0gY29udGV4dFJhZGl1cyk7XG4gICAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGZ1bGxUZXh0Lmxlbmd0aCwgb2Zmc2V0ICsgY29udGV4dFJhZGl1cyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZXh0OiBmdWxsVGV4dCxcbiAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgIGNvbnRleHRCZWZvcmU6IGZ1bGxUZXh0LnN1YnN0cmluZyhzdGFydCwgb2Zmc2V0KSxcbiAgICAgICAgICAgIGNvbnRleHRBZnRlcjogZnVsbFRleHQuc3Vic3RyaW5nKG9mZnNldCwgZW5kKVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBjdXJyZW50IGNlbGwgY29udGV4dFxuICAgICAqL1xuICAgIGdldEN1cnJlbnRDZWxsQ29udGV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGFzdENlbGxDb250ZXh0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEaXNwb3NlcyBhbGwgcmVzb3VyY2VzXG4gICAgICovXG4gICAgZGlzcG9zZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzRGlzcG9zZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jbGVhbnVwUHJldmlvdXNMaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5ub3RlYm9va1RyYWNrZXIuYWN0aXZlQ2VsbENoYW5nZWQuZGlzY29ubmVjdCh0aGlzLnNldHVwQ2VsbExpc3RlbmVycywgdGhpcyk7XG4gICAgICAgIHRoaXMubm90ZWJvb2tUcmFja2VyLmN1cnJlbnRDaGFuZ2VkLmRpc2Nvbm5lY3QodGhpcy5oYW5kbGVOb3RlYm9va0NoYW5nZSwgdGhpcyk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgZXh0ZW5zaW9uSWNvbiB9IGZyb20gJy4vaWNvbnMnO1xuLyoqXG4gKiBSZWdpc3RlcnMgY29tbWFuZHMgZm9yIHRoZSBleHRlbnNpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQ29tbWFuZHMoYXBwLCBwYWxldHRlLCBsYXVuY2hlciwgc2lkZWJhcldpZGdldCkge1xuICAgIC8vIEFkZCBjb21tYW5kIHRvIHRvZ2dsZSB0aGUgc2lkZWJhclxuICAgIGFwcC5jb21tYW5kcy5hZGRDb21tYW5kKCdzaW1wbGUtZXh0ZW5zaW9uOnRvZ2dsZS1zaWRlYmFyJywge1xuICAgICAgICBsYWJlbDogJ1RvZ2dsZSBBSSBBc3Npc3RhbnQgU2lkZWJhcicsXG4gICAgICAgIGljb246IGV4dGVuc2lvbkljb24sXG4gICAgICAgIGV4ZWN1dGU6ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzaWRlYmFyV2lkZ2V0LmlzQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICAgICBzaWRlYmFyV2lkZ2V0LnBhcmVudCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhcHAuc2hlbGwuYWRkKHNpZGViYXJXaWRnZXQsICdsZWZ0JywgeyByYW5rOiA5OTk5IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gQWRkIHRoZSBjb21tYW5kIHRvIHRoZSBjb21tYW5kIHBhbGV0dGVcbiAgICBwYWxldHRlLmFkZEl0ZW0oe1xuICAgICAgICBjb21tYW5kOiAnc2ltcGxlLWV4dGVuc2lvbjp0b2dnbGUtc2lkZWJhcicsXG4gICAgICAgIGNhdGVnb3J5OiAnRXh0ZW5zaW9uJ1xuICAgIH0pO1xuICAgIC8vIEFkZCBhIGxhdW5jaGVyIGl0ZW1cbiAgICBsYXVuY2hlci5hZGQoe1xuICAgICAgICBjb21tYW5kOiAnc2ltcGxlLWV4dGVuc2lvbjp0b2dnbGUtc2lkZWJhcicsXG4gICAgICAgIGNhdGVnb3J5OiAnT3RoZXInLFxuICAgICAgICByYW5rOiA5OTk5XG4gICAgfSk7XG59XG4iLCIvKipcbiAqIEdsb2JhbCByZWZlcmVuY2VzIHRvIGtleSBjb21wb25lbnRzIGluIHRoZSBhcHBsaWNhdGlvblxuICovXG5leHBvcnQgY29uc3QgZ2xvYmFscyA9IHt9O1xuLyoqXG4gKiBJbml0aWFsaXplIGdsb2JhbCByZWZlcmVuY2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0R2xvYmFscyhhcHAsIG5vdGVib29rVHJhY2tlcikge1xuICAgIGdsb2JhbHMuYXBwID0gYXBwO1xuICAgIGdsb2JhbHMubm90ZWJvb2tUcmFja2VyID0gbm90ZWJvb2tUcmFja2VyO1xufVxuIiwiaW1wb3J0IHsgTGFiSWNvbiB9IGZyb20gJ0BqdXB5dGVybGFiL3VpLWNvbXBvbmVudHMnO1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSWNvbiBEZWZpbml0aW9uXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5jb25zdCBpY29uU3ZnU3RyID0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCIxNlwiIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBjbGFzcz1cImJpIGJpLWNoYXQtbGVmdC10ZXh0XCIgdmlld0JveD1cIjAgMCAxNiAxNlwiPicgK1xuICAgICc8cGF0aCBkPVwiTTE0IDFhMSAxIDAgMCAxIDEgMXY4YTEgMSAwIDAgMS0xIDFINC40MTRBMiAyIDAgMCAwIDMgMTEuNTg2bC0yIDJWMmExIDEgMCAwIDEgMS0xaDEyek0yIDBhMiAyIDAgMCAwLTIgMnYxMi43OTNhLjUuNSAwIDAgMCAuODU0LjM1M2wyLjg1My0yLjg1M0ExIDEgMCAwIDEgNC40MTQgMTJIMTRhMiAyIDAgMCAwIDItMlYyYTIgMiAwIDAgMC0yLTJIMnpcIi8+JyArXG4gICAgJzxwYXRoIGQ9XCJNMyAzLjVhLjUuNSAwIDAgMSAuNS0uNWg5YS41LjUgMCAwIDEgMCAxaC05YS41LjUgMCAwIDEtLjUtLjV6TTMgNmEuNS41IDAgMCAxIC41LS41aDlhLjUuNSAwIDAgMSAwIDFoLTlBLjUuNSAwIDAgMSAzIDZ6bTAgMi41YS41LjUgMCAwIDEgLjUtLjVoNWEuNS41IDAgMCAxIDAgMWgtNWEuNS41IDAgMCAxLS41LS41elwiLz4nICtcbiAgICAnPC9zdmc+Jztcbi8qKlxuICogSWNvbiBmb3IgdGhlIEFJIEFzc2lzdGFudCBleHRlbnNpb25cbiAqL1xuZXhwb3J0IGNvbnN0IGV4dGVuc2lvbkljb24gPSBuZXcgTGFiSWNvbih7XG4gICAgbmFtZTogJ3NpbXBsZTppY29uJyxcbiAgICBzdmdzdHI6IGljb25TdmdTdHJcbn0pO1xuIiwiaW1wb3J0IHsgSUxhdW5jaGVyIH0gZnJvbSAnQGp1cHl0ZXJsYWIvbGF1bmNoZXInO1xuaW1wb3J0IHsgSUNvbW1hbmRQYWxldHRlIH0gZnJvbSAnQGp1cHl0ZXJsYWIvYXBwdXRpbHMnO1xuaW1wb3J0IHsgSU5vdGVib29rVHJhY2tlciB9IGZyb20gJ0BqdXB5dGVybGFiL25vdGVib29rJztcbmltcG9ydCB7IElEb2N1bWVudE1hbmFnZXIgfSBmcm9tICdAanVweXRlcmxhYi9kb2NtYW5hZ2VyJztcbmltcG9ydCB7IFNpbXBsZVNpZGViYXJXaWRnZXQgfSBmcm9tICcuL3NpZGViYXItd2lkZ2V0JztcbmltcG9ydCB7IGluaXRHbG9iYWxzLCBnbG9iYWxzIH0gZnJvbSAnLi9nbG9iYWxzJztcbmltcG9ydCB7IHJlZ2lzdGVyQ29tbWFuZHMgfSBmcm9tICcuL2NvbW1hbmRzJztcbmltcG9ydCB7IENlbGxDb250ZXh0VHJhY2tlciB9IGZyb20gJy4vY2VsbC1jb250ZXh0LXRyYWNrZXInO1xuLy8gaW1wb3J0IHsgQXBpQ2xpZW50IH0gZnJvbSAnLi9hcGktY2xpZW50Jztcbi8vIEV4cG9ydCBBcGlDbGllbnQgZm9yIHVzZSBieSBvdGhlciBjb21wb25lbnRzXG5leHBvcnQgeyBBcGlDbGllbnQgfSBmcm9tICcuL2FwaS1jbGllbnQnO1xuLyoqXG4gKiBJbml0aWFsaXphdGlvbiBkYXRhIGZvciB0aGUganVweXRlci1zaW1wbGUtZXh0ZW5zaW9uIGV4dGVuc2lvbi5cbiAqL1xuY29uc3QgcGx1Z2luID0ge1xuICAgIGlkOiAnanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uOnBsdWdpbicsXG4gICAgYXV0b1N0YXJ0OiB0cnVlLFxuICAgIHJlcXVpcmVzOiBbSUxhdW5jaGVyLCBJQ29tbWFuZFBhbGV0dGUsIElOb3RlYm9va1RyYWNrZXIsIElEb2N1bWVudE1hbmFnZXJdLFxuICAgIGFjdGl2YXRlOiAoanVweXRlckFwcCwgbGF1bmNoZXIsIHBhbGV0dGUsIHRyYWNrZXIsIGRvY01hbmFnZXIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0p1cHl0ZXJMYWIgZXh0ZW5zaW9uIGp1cHl0ZXItc2ltcGxlLWV4dGVuc2lvbiBpcyBhY3RpdmF0ZWQhJyk7XG4gICAgICAgIC8vIEluaXRpYWxpemUgZ2xvYmFsIHJlZmVyZW5jZXNcbiAgICAgICAgaW5pdEdsb2JhbHMoanVweXRlckFwcCwgdHJhY2tlcik7XG4gICAgICAgIC8vIEluaXRpYWxpemUgY2VsbCBjb250ZXh0IHRyYWNrZXJcbiAgICAgICAgZ2xvYmFscy5jZWxsQ29udGV4dFRyYWNrZXIgPSBuZXcgQ2VsbENvbnRleHRUcmFja2VyKGp1cHl0ZXJBcHAsIHRyYWNrZXIpO1xuICAgICAgICAvLyBDcmVhdGUgYW5kIGFkZCBzaWRlYmFyIHdpZGdldFxuICAgICAgICBjb25zdCBzaWRlYmFyV2lkZ2V0ID0gbmV3IFNpbXBsZVNpZGViYXJXaWRnZXQoZG9jTWFuYWdlcik7XG4gICAgICAgIGp1cHl0ZXJBcHAuc2hlbGwuYWRkKHNpZGViYXJXaWRnZXQsICdsZWZ0JywgeyByYW5rOiA5OTk5IH0pO1xuICAgICAgICAvLyBSZWdpc3RlciBjb21tYW5kc1xuICAgICAgICByZWdpc3RlckNvbW1hbmRzKGp1cHl0ZXJBcHAsIHBhbGV0dGUsIGxhdW5jaGVyLCBzaWRlYmFyV2lkZ2V0KTtcbiAgICB9XG59O1xuZXhwb3J0IGRlZmF1bHQgcGx1Z2luO1xuIiwiaW1wb3J0IHsgV2lkZ2V0IH0gZnJvbSAnQGx1bWluby93aWRnZXRzJztcbmltcG9ydCB7IE5vdGVib29rUGFuZWwgfSBmcm9tICdAanVweXRlcmxhYi9ub3RlYm9vayc7XG5pbXBvcnQgeyBtYXJrZWQgfSBmcm9tICdtYXJrZWQnO1xuaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknO1xuaW1wb3J0IHsgZXh0ZW5zaW9uSWNvbiB9IGZyb20gJy4vaWNvbnMnO1xuaW1wb3J0IHsgZ2xvYmFscyB9IGZyb20gJy4vZ2xvYmFscyc7XG5pbXBvcnQgeyBBcGlDbGllbnQgfSBmcm9tICcuL2FwaS1jbGllbnQnO1xuLyoqXG4gKiBNYWluIHNpZGViYXIgd2lkZ2V0IGZvciB0aGUgQUkgY2hhdCBpbnRlcmZhY2VcbiAqL1xuZXhwb3J0IGNsYXNzIFNpbXBsZVNpZGViYXJXaWRnZXQgZXh0ZW5kcyBXaWRnZXQge1xuICAgIGNvbnN0cnVjdG9yKGRvY01hbmFnZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5pc01hcmtkb3duTW9kZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzSW5wdXRFeHBhbmRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNoYXRIaXN0b3J5ID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudENoYXRJZCA9ICcnO1xuICAgICAgICB0aGlzLmlzSGlzdG9yeVZpZXdBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kb2NNYW5hZ2VyID0gZG9jTWFuYWdlcjtcbiAgICAgICAgdGhpcy5pZCA9ICdzaW1wbGUtc2lkZWJhcic7XG4gICAgICAgIHRoaXMudGl0bGUubGFiZWwgPSAnJztcbiAgICAgICAgdGhpcy50aXRsZS5jYXB0aW9uID0gJ0FJIENoYXQgSW50ZXJmYWNlJztcbiAgICAgICAgdGhpcy50aXRsZS5pY29uID0gZXh0ZW5zaW9uSWNvbjtcbiAgICAgICAgdGhpcy50aXRsZS5jbG9zYWJsZSA9IHRydWU7XG4gICAgICAgIC8vIEluaXRpYWxpemUgQVBJIGNsaWVudFxuICAgICAgICB0aGlzLmFwaUNsaWVudCA9IG5ldyBBcGlDbGllbnQoKTtcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBjb250YWluZXIgZWxlbWVudHMgYmVmb3JlIGNyZWF0aW5nIGxheW91dFxuICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5pbnB1dENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICB0aGlzLmhpc3RvcnlDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGNoYXQgb24gc3RhcnRcbiAgICAgICAgdGhpcy5jcmVhdGVOZXdDaGF0KCk7XG4gICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUxheW91dCgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyB0aGUgbWFpbiBsYXlvdXQgZm9yIHRoZSBzaWRlYmFyXG4gICAgICovXG4gICAgY3JlYXRlTGF5b3V0KCkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIG1haW4gY29udGFpbmVyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29udGVudC5jbGFzc05hbWUgPSAnc2ltcGxlLXNpZGViYXItY29udGVudCc7XG4gICAgICAgIC8vIENyZWF0ZSB0aXRsZSBpbnB1dCBjb250YWluZXJcbiAgICAgICAgY29uc3QgdGl0bGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGl0bGVDb250YWluZXIuY2xhc3NOYW1lID0gJ3RpdGxlLWNvbnRhaW5lcic7XG4gICAgICAgIC8vIFNldCB1cCB0aXRsZSBpbnB1dFxuICAgICAgICB0aGlzLnRpdGxlSW5wdXQuY2xhc3NOYW1lID0gJ2NoYXQtdGl0bGUtaW5wdXQnO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQudHlwZSA9ICd0ZXh0JztcbiAgICAgICAgdGhpcy50aXRsZUlucHV0LnBsYWNlaG9sZGVyID0gJ0NoYXQgdGl0bGUnO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQudmFsdWUgPSAnTmV3IENoYXQnO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gdGhpcy51cGRhdGVDdXJyZW50Q2hhdFRpdGxlKCkpO1xuICAgICAgICB0aXRsZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnRpdGxlSW5wdXQpO1xuICAgICAgICAvLyBDb25maWd1cmUgdG9wIGFjdGlvbiBidXR0b25zIChOZXcgQ2hhdCAmIEhpc3RvcnkpXG4gICAgICAgIGNvbnN0IHRvcEFjdGlvbnNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdG9wQWN0aW9uc0NvbnRhaW5lci5jbGFzc05hbWUgPSAndG9wLWFjdGlvbnMtY29udGFpbmVyJztcbiAgICAgICAgY29uc3QgbmV3Q2hhdEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBuZXdDaGF0QnV0dG9uLmNsYXNzTmFtZSA9ICdqcC1CdXR0b24gYWN0aW9uLWJ1dHRvbic7XG4gICAgICAgIG5ld0NoYXRCdXR0b24udGV4dENvbnRlbnQgPSAnKyBOZXcgQ2hhdCc7XG4gICAgICAgIG5ld0NoYXRCdXR0b24udGl0bGUgPSAnU3RhcnQgYSBuZXcgY2hhdCc7XG4gICAgICAgIG5ld0NoYXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLmNyZWF0ZU5ld0NoYXQoKSk7XG4gICAgICAgIGNvbnN0IGhpc3RvcnlCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgaGlzdG9yeUJ1dHRvbi5jbGFzc05hbWUgPSAnanAtQnV0dG9uIGFjdGlvbi1idXR0b24nO1xuICAgICAgICBoaXN0b3J5QnV0dG9uLnRleHRDb250ZW50ID0gJ0hpc3RvcnknO1xuICAgICAgICBoaXN0b3J5QnV0dG9uLnRpdGxlID0gJ1ZpZXcgY2hhdCBoaXN0b3J5JztcbiAgICAgICAgaGlzdG9yeUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMudG9nZ2xlSGlzdG9yeVZpZXcoKSk7XG4gICAgICAgIHRvcEFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3Q2hhdEJ1dHRvbik7XG4gICAgICAgIHRvcEFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoaGlzdG9yeUJ1dHRvbik7XG4gICAgICAgIC8vIENvbmZpZ3VyZSBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIuY2xhc3NOYW1lID0gJ21lc3NhZ2UtY29udGFpbmVyJztcbiAgICAgICAgLy8gQ29uZmlndXJlIGhpc3RvcnkgY29udGFpbmVyXG4gICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5jbGFzc05hbWUgPSAnaGlzdG9yeS1jb250YWluZXInO1xuICAgICAgICB0aGlzLmhpc3RvcnlDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgLy8gSW5pdGlhbGx5IGhpZGRlblxuICAgICAgICAvLyBDb25maWd1cmUgaW5wdXQgY29udGFpbmVyXG4gICAgICAgIHRoaXMuaW5wdXRDb250YWluZXIuY2xhc3NOYW1lID0gJ2lucHV0LWNvbnRhaW5lcic7XG4gICAgICAgIC8vIENyZWF0ZSBjb250cm9scyBjb250YWluZXJcbiAgICAgICAgY29uc3QgY29udHJvbHNDb250YWluZXIgPSB0aGlzLmNyZWF0ZUNvbnRyb2xzQ29udGFpbmVyKCk7XG4gICAgICAgIC8vIENvbmZpZ3VyZSBpbnB1dCBmaWVsZFxuICAgICAgICB0aGlzLmlucHV0RmllbGQucGxhY2Vob2xkZXIgPSAnQXNrIG1lIGFueXRoaW5nLi4uJztcbiAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLmZsZXhHcm93ID0gJzEnO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUucGFkZGluZyA9ICc1cHgnO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjY2NjJztcbiAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLmJvcmRlclJhZGl1cyA9ICczcHgnO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUucmVzaXplID0gJ25vbmUnO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQucm93cyA9IDE7XG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7XG4gICAgICAgIC8vIEFkZCBrZXlwcmVzcyBsaXN0ZW5lciB0byBpbnB1dCBmaWVsZFxuICAgICAgICB0aGlzLmlucHV0RmllbGQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicgJiYgIWV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNlbmRNZXNzYWdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBDcmVhdGUgc2VuZCBidXR0b24gY29udGFpbmVyXG4gICAgICAgIGNvbnN0IGlucHV0QWN0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBpbnB1dEFjdGlvbnNDb250YWluZXIuY2xhc3NOYW1lID0gJ2lucHV0LWFjdGlvbnMtY29udGFpbmVyJztcbiAgICAgICAgLy8gQ3JlYXRlIHNlbmQgYnV0dG9uXG4gICAgICAgIGNvbnN0IHNlbmRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgc2VuZEJ1dHRvbi5jbGFzc05hbWUgPSAnanAtQnV0dG9uIHNlbmQtYnV0dG9uJztcbiAgICAgICAgc2VuZEJ1dHRvbi50ZXh0Q29udGVudCA9ICdTZW5kJztcbiAgICAgICAgc2VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuaGFuZGxlU2VuZE1lc3NhZ2UoKSk7XG4gICAgICAgIC8vIEFkZCBidXR0b24gdG8gYWN0aW9ucyBjb250YWluZXJcbiAgICAgICAgaW5wdXRBY3Rpb25zQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlbmRCdXR0b24pO1xuICAgICAgICAvLyBBc3NlbWJsZSB0aGUgaW5wdXQgY29tcG9uZW50c1xuICAgICAgICB0aGlzLmlucHV0Q29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRyb2xzQ29udGFpbmVyKTtcbiAgICAgICAgdGhpcy5pbnB1dENvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmlucHV0RmllbGQpO1xuICAgICAgICB0aGlzLmlucHV0Q29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0QWN0aW9uc0NvbnRhaW5lcik7XG4gICAgICAgIC8vIEFzc2VtYmxlIGFsbCBjb21wb25lbnRzXG4gICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodG9wQWN0aW9uc0NvbnRhaW5lcik7XG4gICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGl0bGVDb250YWluZXIpO1xuICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHRoaXMubWVzc2FnZUNvbnRhaW5lcik7XG4gICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGhpcy5oaXN0b3J5Q29udGFpbmVyKTtcbiAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZCh0aGlzLmlucHV0Q29udGFpbmVyKTtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgY2hhdCBzZXNzaW9uXG4gICAgICovXG4gICAgY3JlYXRlTmV3Q2hhdCgpIHtcbiAgICAgICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgSUQgZm9yIHRoZSBjaGF0XG4gICAgICAgIGNvbnN0IGNoYXRJZCA9IGBjaGF0LSR7RGF0ZS5ub3coKX1gO1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgY2hhdCBpdGVtXG4gICAgICAgIGNvbnN0IG5ld0NoYXQgPSB7XG4gICAgICAgICAgICBpZDogY2hhdElkLFxuICAgICAgICAgICAgdGl0bGU6ICdOZXcgQ2hhdCcsXG4gICAgICAgICAgICBtZXNzYWdlczogW11cbiAgICAgICAgfTtcbiAgICAgICAgLy8gQWRkIHRvIGhpc3RvcnlcbiAgICAgICAgdGhpcy5jaGF0SGlzdG9yeS5wdXNoKG5ld0NoYXQpO1xuICAgICAgICAvLyBTZXQgYXMgY3VycmVudCBjaGF0XG4gICAgICAgIHRoaXMuY3VycmVudENoYXRJZCA9IGNoYXRJZDtcbiAgICAgICAgLy8gVXBkYXRlIHRpdGxlIGlucHV0XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC52YWx1ZSA9IG5ld0NoYXQudGl0bGU7XG4gICAgICAgIC8vIENsZWFyIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICAgIGlmICh0aGlzLm1lc3NhZ2VDb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgfVxuICAgICAgICAvLyBIaWRlIGhpc3RvcnkgaWYgaXQncyB2aXNpYmxlXG4gICAgICAgIGlmICh0aGlzLmlzSGlzdG9yeVZpZXdBY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlSGlzdG9yeVZpZXcoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUb2dnbGVzIGJldHdlZW4gY2hhdCB2aWV3IGFuZCBoaXN0b3J5IHZpZXdcbiAgICAgKi9cbiAgICB0b2dnbGVIaXN0b3J5VmlldygpIHtcbiAgICAgICAgdGhpcy5pc0hpc3RvcnlWaWV3QWN0aXZlID0gIXRoaXMuaXNIaXN0b3J5Vmlld0FjdGl2ZTtcbiAgICAgICAgaWYgKHRoaXMuaXNIaXN0b3J5Vmlld0FjdGl2ZSkge1xuICAgICAgICAgICAgLy8gU2hvdyBoaXN0b3J5IHZpZXcsIGhpZGUgbWVzc2FnZSB2aWV3XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIHRoaXMudGl0bGVJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgLy8gUG9wdWxhdGUgaGlzdG9yeVxuICAgICAgICAgICAgdGhpcy5yZW5kZXJDaGF0SGlzdG9yeSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gU2hvdyBtZXNzYWdlIHZpZXcsIGhpZGUgaGlzdG9yeSB2aWV3XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgICB0aGlzLmhpc3RvcnlDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgICAgIHRoaXMudGl0bGVJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW5kZXJzIHRoZSBjaGF0IGhpc3RvcnkgaW4gdGhlIGhpc3RvcnkgY29udGFpbmVyXG4gICAgICovXG4gICAgcmVuZGVyQ2hhdEhpc3RvcnkoKSB7XG4gICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgaWYgKHRoaXMuY2hhdEhpc3RvcnkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBlbXB0eU1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGVtcHR5TWVzc2FnZS5jbGFzc05hbWUgPSAnZW1wdHktaGlzdG9yeS1tZXNzYWdlJztcbiAgICAgICAgICAgIGVtcHR5TWVzc2FnZS50ZXh0Q29udGVudCA9ICdObyBjaGF0IGhpc3RvcnkgeWV0JztcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5hcHBlbmRDaGlsZChlbXB0eU1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIENyZWF0ZSBhIGxpc3Qgb2YgY2hhdCBoaXN0b3J5IGl0ZW1zXG4gICAgICAgIHRoaXMuY2hhdEhpc3RvcnkuZm9yRWFjaChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhpc3RvcnlJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBoaXN0b3J5SXRlbS5jbGFzc05hbWUgPSAnaGlzdG9yeS1pdGVtJztcbiAgICAgICAgICAgIGlmIChjaGF0LmlkID09PSB0aGlzLmN1cnJlbnRDaGF0SWQpIHtcbiAgICAgICAgICAgICAgICBoaXN0b3J5SXRlbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFkZCB0aXRsZVxuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHRpdGxlLmNsYXNzTmFtZSA9ICdoaXN0b3J5LXRpdGxlJztcbiAgICAgICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gY2hhdC50aXRsZTtcbiAgICAgICAgICAgIC8vIEFkZCBtZXNzYWdlIHByZXZpZXdcbiAgICAgICAgICAgIGNvbnN0IHByZXZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHByZXZpZXcuY2xhc3NOYW1lID0gJ2hpc3RvcnktcHJldmlldyc7XG4gICAgICAgICAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGNoYXQubWVzc2FnZXNbY2hhdC5tZXNzYWdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIHByZXZpZXcudGV4dENvbnRlbnQgPSBsYXN0TWVzc2FnZVxuICAgICAgICAgICAgICAgID8gYCR7bGFzdE1lc3NhZ2UudGV4dC5zdWJzdHJpbmcoMCwgNDApfSR7bGFzdE1lc3NhZ2UudGV4dC5sZW5ndGggPiA0MCA/ICcuLi4nIDogJyd9YFxuICAgICAgICAgICAgICAgIDogJ0VtcHR5IGNoYXQnO1xuICAgICAgICAgICAgLy8gQWRkIGNsaWNrIGV2ZW50XG4gICAgICAgICAgICBoaXN0b3J5SXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMubG9hZENoYXQoY2hhdC5pZCkpO1xuICAgICAgICAgICAgaGlzdG9yeUl0ZW0uYXBwZW5kQ2hpbGQodGl0bGUpO1xuICAgICAgICAgICAgaGlzdG9yeUl0ZW0uYXBwZW5kQ2hpbGQocHJldmlldyk7XG4gICAgICAgICAgICB0aGlzLmhpc3RvcnlDb250YWluZXIuYXBwZW5kQ2hpbGQoaGlzdG9yeUl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9hZHMgYSBjaGF0IGZyb20gaGlzdG9yeVxuICAgICAqL1xuICAgIGxvYWRDaGF0KGNoYXRJZCkge1xuICAgICAgICBjb25zdCBjaGF0ID0gdGhpcy5jaGF0SGlzdG9yeS5maW5kKGMgPT4gYy5pZCA9PT0gY2hhdElkKTtcbiAgICAgICAgaWYgKCFjaGF0KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAvLyBTZXQgYXMgY3VycmVudCBjaGF0XG4gICAgICAgIHRoaXMuY3VycmVudENoYXRJZCA9IGNoYXRJZDtcbiAgICAgICAgLy8gVXBkYXRlIHRpdGxlXG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC52YWx1ZSA9IGNoYXQudGl0bGU7XG4gICAgICAgIC8vIENsZWFyIGFuZCByZS1wb3B1bGF0ZSBtZXNzYWdlIGNvbnRhaW5lclxuICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGNoYXQubWVzc2FnZXMuZm9yRWFjaChtc2cgPT4ge1xuICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKG1zZy50ZXh0LCBtc2cuc2VuZGVyLCBtc2cuaXNNYXJrZG93biwgZmFsc2UpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gU3dpdGNoIGJhY2sgdG8gY2hhdCB2aWV3XG4gICAgICAgIGlmICh0aGlzLmlzSGlzdG9yeVZpZXdBY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlSGlzdG9yeVZpZXcoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSB0aXRsZSBvZiB0aGUgY3VycmVudCBjaGF0XG4gICAgICovXG4gICAgdXBkYXRlQ3VycmVudENoYXRUaXRsZSgpIHtcbiAgICAgICAgY29uc3QgY2hhdCA9IHRoaXMuY2hhdEhpc3RvcnkuZmluZChjID0+IGMuaWQgPT09IHRoaXMuY3VycmVudENoYXRJZCk7XG4gICAgICAgIGlmIChjaGF0KSB7XG4gICAgICAgICAgICBjaGF0LnRpdGxlID0gdGhpcy50aXRsZUlucHV0LnZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgdGhlIGNvbnRyb2xzIGNvbnRhaW5lciB3aXRoIHRvZ2dsZXMgYW5kIGFjdGlvbiBidXR0b25zXG4gICAgICovXG4gICAgY3JlYXRlQ29udHJvbHNDb250YWluZXIoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xzQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnRyb2xzQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdjb250cm9scy1jb250YWluZXInO1xuICAgICAgICAvLyBDcmVhdGUgbWFya2Rvd24gdG9nZ2xlIGNvbnRhaW5lclxuICAgICAgICBjb25zdCB0b2dnbGVDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdG9nZ2xlQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0b2dnbGUtY29udGFpbmVyJztcbiAgICAgICAgLy8gQ3JlYXRlIG1hcmtkb3duIHRvZ2dsZVxuICAgICAgICBjb25zdCBtYXJrZG93blRvZ2dsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIG1hcmtkb3duVG9nZ2xlLnR5cGUgPSAnY2hlY2tib3gnO1xuICAgICAgICBtYXJrZG93blRvZ2dsZS5pZCA9ICdtYXJrZG93bi10b2dnbGUnO1xuICAgICAgICBtYXJrZG93blRvZ2dsZS5zdHlsZS5tYXJnaW5SaWdodCA9ICc1cHgnO1xuICAgICAgICBtYXJrZG93blRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgICAgICB0aGlzLmlzTWFya2Rvd25Nb2RlID0gdGFyZ2V0LmNoZWNrZWQ7XG4gICAgICAgICAgICB0aGlzLmlucHV0RmllbGQucGxhY2Vob2xkZXIgPSB0aGlzLmlzTWFya2Rvd25Nb2RlID9cbiAgICAgICAgICAgICAgICAnV3JpdGUgbWFya2Rvd24gaGVyZS4uLlxcblxcbiMgRXhhbXBsZSBoZWFkaW5nXFxuLSBMaXN0IGl0ZW1cXG5cXG5gYGBjb2RlIGJsb2NrYGBgJyA6XG4gICAgICAgICAgICAgICAgJ0FzayBtZSBhbnl0aGluZy4uLic7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBDcmVhdGUgdG9nZ2xlIGxhYmVsXG4gICAgICAgIGNvbnN0IHRvZ2dsZUxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICAgICAgdG9nZ2xlTGFiZWwuaHRtbEZvciA9ICdtYXJrZG93bi10b2dnbGUnO1xuICAgICAgICB0b2dnbGVMYWJlbC50ZXh0Q29udGVudCA9ICdNYXJrZG93biBtb2RlJztcbiAgICAgICAgdG9nZ2xlTGFiZWwuc3R5bGUuZm9udFNpemUgPSAnMTJweCc7XG4gICAgICAgIC8vIEFkZCB0b2dnbGUgZWxlbWVudHMgdG8gY29udGFpbmVyXG4gICAgICAgIHRvZ2dsZUNvbnRhaW5lci5hcHBlbmRDaGlsZChtYXJrZG93blRvZ2dsZSk7XG4gICAgICAgIHRvZ2dsZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0b2dnbGVMYWJlbCk7XG4gICAgICAgIC8vIENyZWF0ZSBhY3Rpb24gYnV0dG9ucyBjb250YWluZXJcbiAgICAgICAgY29uc3QgYWN0aW9uQnV0dG9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBhY3Rpb25CdXR0b25zQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdhY3Rpb24tYnV0dG9ucy1jb250YWluZXInO1xuICAgICAgICAvLyBDcmVhdGUgYWxsIGFjdGlvbiBidXR0b25zXG4gICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBbXG4gICAgICAgICAgICB7IHRleHQ6ICdAJywgdGl0bGU6ICdDb21tYW5kIGxpc3QnLCBhY3Rpb246ICgpID0+IHsgfSB9LFxuICAgICAgICAgICAgeyB0ZXh0OiAn8J+TjicsIHRpdGxlOiAnVXBsb2FkIGZpbGUnLCBhY3Rpb246ICgpID0+IHsgfSB9LFxuICAgICAgICAgICAgeyB0ZXh0OiAn8J+UjScsIHRpdGxlOiAnQnJvd3NlIGZpbGVzJywgYWN0aW9uOiAoKSA9PiB7IH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAn4qSiJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0V4cGFuZCBpbnB1dCcsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAoKSA9PiB0aGlzLnRvZ2dsZUlucHV0RXhwYW5zaW9uKGFjdGlvbkJ1dHRvbnNDb250YWluZXIuY2hpbGRyZW5bM10pXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyB0ZXh0OiAn4pqZ77iPJywgdGl0bGU6ICdTZXR0aW5ncycsIGFjdGlvbjogKCkgPT4geyB9IH0sXG4gICAgICAgICAgICB7IHRleHQ6ICfwn5OBJywgdGl0bGU6ICdMaXN0IERpcmVjdG9yeSBDb250ZW50cycsIGFjdGlvbjogKCkgPT4gdGhpcy5saXN0Q3VycmVudERpcmVjdG9yeUNvbnRlbnRzKCkgfVxuICAgICAgICBdO1xuICAgICAgICAvLyBBZGQgYWxsIGJ1dHRvbnMgdG8gdGhlIGNvbnRhaW5lclxuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJ0biA9IHRoaXMuY3JlYXRlQnV0dG9uKGJ1dHRvbi50ZXh0LCBidXR0b24udGl0bGUpO1xuICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYnV0dG9uLmFjdGlvbik7XG4gICAgICAgICAgICBhY3Rpb25CdXR0b25zQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ0bik7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBZGQgdG9nZ2xlIGFuZCBhY3Rpb24gYnV0dG9ucyB0byB0aGUgY29udHJvbHMgY29udGFpbmVyXG4gICAgICAgIGNvbnRyb2xzQ29udGFpbmVyLmFwcGVuZENoaWxkKHRvZ2dsZUNvbnRhaW5lcik7XG4gICAgICAgIGNvbnRyb2xzQ29udGFpbmVyLmFwcGVuZENoaWxkKGFjdGlvbkJ1dHRvbnNDb250YWluZXIpO1xuICAgICAgICByZXR1cm4gY29udHJvbHNDb250YWluZXI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvZ2dsZXMgdGhlIGV4cGFuc2lvbiBzdGF0ZSBvZiB0aGUgaW5wdXQgZmllbGRcbiAgICAgKi9cbiAgICB0b2dnbGVJbnB1dEV4cGFuc2lvbihidXR0b24pIHtcbiAgICAgICAgdGhpcy5pc0lucHV0RXhwYW5kZWQgPSAhdGhpcy5pc0lucHV0RXhwYW5kZWQ7XG4gICAgICAgIGlmICh0aGlzLmlzSW5wdXRFeHBhbmRlZCkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLmhlaWdodCA9ICcxMDBweCc7XG4gICAgICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUucmVzaXplID0gJ3ZlcnRpY2FsJztcbiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICfipKEnO1xuICAgICAgICAgICAgYnV0dG9uLnRpdGxlID0gJ0NvbGxhcHNlIGlucHV0JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7XG4gICAgICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUucmVzaXplID0gJ25vbmUnO1xuICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ+Kkoic7XG4gICAgICAgICAgICBidXR0b24udGl0bGUgPSAnRXhwYW5kIGlucHV0JztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gY3JlYXRlIGEgYnV0dG9uIHdpdGggZ2l2ZW4gdGV4dCBhbmQgdG9vbHRpcFxuICAgICAqL1xuICAgIGNyZWF0ZUJ1dHRvbih0ZXh0LCB0b29sdGlwKSB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgICBidXR0b24udGl0bGUgPSB0b29sdGlwO1xuICAgICAgICBidXR0b24uY2xhc3NOYW1lID0gJ2pwLUJ1dHRvbiBhY3Rpb24tYnV0dG9uJztcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBzZW5kaW5nIGEgbWVzc2FnZSBmcm9tIHRoZSBpbnB1dCBmaWVsZFxuICAgICAqL1xuICAgIGhhbmRsZVNlbmRNZXNzYWdlKCkge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5pbnB1dEZpZWxkLnZhbHVlLnRyaW0oKTtcbiAgICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIC8vIEFkZCB1c2VyIG1lc3NhZ2UgdG8gVUlcbiAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShtZXNzYWdlLCAndXNlcicsIHRoaXMuaXNNYXJrZG93bk1vZGUpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnZhbHVlID0gJyc7XG4gICAgICAgICAgICAvLyBSZXNldCBleHBhbmRlZCBzdGF0ZSBpZiBuZWVkZWQgYWZ0ZXIgc2VuZGluZ1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbnB1dEV4cGFuZGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLmhlaWdodCA9ICcxMDBweCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUuaGVpZ2h0ID0gJ2F1dG8nO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC5yb3dzID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHRlbXBvcmFyeSBtZXNzYWdlIGNvbnRhaW5lciBmb3IgdGhlIGJvdCdzIHN0cmVhbWluZyByZXNwb25zZVxuICAgICAgICAgICAgY29uc3QgYm90TWVzc2FnZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgYm90TWVzc2FnZURpdi5jbGFzc05hbWUgPSAnYm90LW1lc3NhZ2UnO1xuICAgICAgICAgICAgY29uc3QgbWFya2Rvd25JbmRpY2F0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIG1hcmtkb3duSW5kaWNhdG9yLnRleHRDb250ZW50ID0gXCJNRFwiO1xuICAgICAgICAgICAgbWFya2Rvd25JbmRpY2F0b3IuY2xhc3NOYW1lID0gJ21hcmtkb3duLWluZGljYXRvcic7XG4gICAgICAgICAgICBib3RNZXNzYWdlRGl2LmFwcGVuZENoaWxkKG1hcmtkb3duSW5kaWNhdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnRlbnREaXYuY2xhc3NOYW1lID0gJ21hcmtkb3duLWNvbnRlbnQnO1xuICAgICAgICAgICAgY29udGVudERpdi50ZXh0Q29udGVudCA9ICcnOyAvLyBTdGFydCBlbXB0eVxuICAgICAgICAgICAgYm90TWVzc2FnZURpdi5hcHBlbmRDaGlsZChjb250ZW50RGl2KTtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChib3RNZXNzYWdlRGl2KTtcbiAgICAgICAgICAgIC8vIFZhcmlhYmxlIHRvIGNvbGxlY3QgdGhlIGNvbXBsZXRlIHJlc3BvbnNlXG4gICAgICAgICAgICBsZXQgY29tcGxldGVSZXNwb25zZSA9ICcnO1xuICAgICAgICAgICAgLy8gR2V0IGNlbGwgY29udGV4dCBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgIGNvbnN0IGNlbGxDb250ZXh0ID0gZ2xvYmFscy5jZWxsQ29udGV4dFRyYWNrZXIgP1xuICAgICAgICAgICAgICAgIGdsb2JhbHMuY2VsbENvbnRleHRUcmFja2VyLmdldEN1cnJlbnRDZWxsQ29udGV4dCgpIDogbnVsbDtcbiAgICAgICAgICAgIC8vIFN0cmVhbSByZXNwb25zZSBmcm9tIEFQSVxuICAgICAgICAgICAgdGhpcy5hcGlDbGllbnQuc3RyZWFtQ2hhdChtZXNzYWdlLCB7IGNlbGxDb250ZXh0IH0sIFxuICAgICAgICAgICAgLy8gT24gZWFjaCBjaHVuayByZWNlaXZlZFxuICAgICAgICAgICAgKGNodW5rKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVSZXNwb25zZSArPSBjaHVuaztcbiAgICAgICAgICAgICAgICBjb250ZW50RGl2LnRleHRDb250ZW50ID0gY29tcGxldGVSZXNwb25zZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIuc2Nyb2xsVG9wID0gdGhpcy5tZXNzYWdlQ29udGFpbmVyLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgIH0sIFxuICAgICAgICAgICAgLy8gT24gY29tcGxldGVcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIHBsYWluIHRleHQgd2l0aCByZW5kZXJlZCBtYXJrZG93blxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhd0h0bWwgPSBtYXJrZWQucGFyc2UoY29tcGxldGVSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZEh0bWwgPSBET01QdXJpZnkuc2FuaXRpemUocmF3SHRtbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gc2FuaXRpemVkSHRtbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byByZW5kZXIgbWFya2Rvd246JywgZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBTYXZlIHRvIGNoYXQgaGlzdG9yeVxuICAgICAgICAgICAgICAgIGNvbnN0IGNoYXQgPSB0aGlzLmNoYXRIaXN0b3J5LmZpbmQoYyA9PiBjLmlkID09PSB0aGlzLmN1cnJlbnRDaGF0SWQpO1xuICAgICAgICAgICAgICAgIGlmIChjaGF0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYXQubWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBjb21wbGV0ZVJlc3BvbnNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiAnYm90JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTWFya2Rvd246IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5zY3JvbGxUb3AgPSB0aGlzLm1lc3NhZ2VDb250YWluZXIuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgICAgfSwgXG4gICAgICAgICAgICAvLyBPbiBlcnJvclxuICAgICAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29udGVudERpdi5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIj5FcnJvcjogJHtlcnJvci5tZXNzYWdlfTwvZGl2PmA7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQVBJIEVycm9yOicsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBtZXNzYWdlIHRvIHRoZSBjaGF0IGludGVyZmFjZVxuICAgICAqL1xuICAgIGFkZE1lc3NhZ2UodGV4dCwgc2VuZGVyLCBpc01hcmtkb3duID0gZmFsc2UsIHNhdmVUb0hpc3RvcnkgPSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbWVzc2FnZURpdi5jbGFzc05hbWUgPSBzZW5kZXIgPT09ICd1c2VyJyA/ICd1c2VyLW1lc3NhZ2UnIDogJ2JvdC1tZXNzYWdlJztcbiAgICAgICAgLy8gQWRkIG1lc3NhZ2UgY29udGVudFxuICAgICAgICBpZiAoaXNNYXJrZG93biB8fCBzZW5kZXIgPT09ICdib3QnKSB7XG4gICAgICAgICAgICAvLyBCb3QgbWVzc2FnZXMgYXJlIGFsd2F5cyByZW5kZXJlZCBhcyBtYXJrZG93blxuICAgICAgICAgICAgY29uc3QgbWFya2Rvd25JbmRpY2F0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIG1hcmtkb3duSW5kaWNhdG9yLnRleHRDb250ZW50ID0gXCJNRFwiO1xuICAgICAgICAgICAgbWFya2Rvd25JbmRpY2F0b3IuY2xhc3NOYW1lID0gJ21hcmtkb3duLWluZGljYXRvcic7XG4gICAgICAgICAgICBtZXNzYWdlRGl2LmFwcGVuZENoaWxkKG1hcmtkb3duSW5kaWNhdG9yKTtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGNvbnRhaW5lciBmb3IgdGhlIHJlbmRlcmVkIG1hcmtkb3duXG4gICAgICAgICAgICBjb25zdCBjb250ZW50RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb250ZW50RGl2LmNsYXNzTmFtZSA9ICdtYXJrZG93bi1jb250ZW50JztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmF3SHRtbCA9IG1hcmtlZC5wYXJzZSh0ZXh0KTtcbiAgICAgICAgICAgICAgICBjb25zdCBzYW5pdGl6ZWRIdG1sID0gRE9NUHVyaWZ5LnNhbml0aXplKHJhd0h0bWwpO1xuICAgICAgICAgICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gc2FuaXRpemVkSHRtbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnRlbnREaXYudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byByZW5kZXIgbWFya2Rvd246JywgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWVzc2FnZURpdi5hcHBlbmRDaGlsZChjb250ZW50RGl2KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1lc3NhZ2VEaXYudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRGl2KTtcbiAgICAgICAgdGhpcy5tZXNzYWdlQ29udGFpbmVyLnNjcm9sbFRvcCA9IHRoaXMubWVzc2FnZUNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIC8vIFNhdmUgdG8gY2hhdCBoaXN0b3J5XG4gICAgICAgIGlmIChzYXZlVG9IaXN0b3J5KSB7XG4gICAgICAgICAgICBjb25zdCBjaGF0ID0gdGhpcy5jaGF0SGlzdG9yeS5maW5kKGMgPT4gYy5pZCA9PT0gdGhpcy5jdXJyZW50Q2hhdElkKTtcbiAgICAgICAgICAgIGlmIChjaGF0KSB7XG4gICAgICAgICAgICAgICAgY2hhdC5tZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgICAgICAgICAgc2VuZGVyLFxuICAgICAgICAgICAgICAgICAgICBpc01hcmtkb3duOiBpc01hcmtkb3duIHx8IHNlbmRlciA9PT0gJ2JvdCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBMaXN0cyB0aGUgY29udGVudHMgb2YgdGhlIGN1cnJlbnQgZGlyZWN0b3J5XG4gICAgICovXG4gICAgYXN5bmMgbGlzdEN1cnJlbnREaXJlY3RvcnlDb250ZW50cygpIHtcbiAgICAgICAgbGV0IGRpclBhdGggPSBudWxsO1xuICAgICAgICBsZXQgc291cmNlID0gbnVsbDtcbiAgICAgICAgLy8gVHJ5IHRvIGdldCBkaXJlY3RvcnkgcGF0aCBmcm9tIGN1cnJlbnQgd2lkZ2V0XG4gICAgICAgIGNvbnN0IGFwcCA9IGdsb2JhbHMuYXBwO1xuICAgICAgICBpZiAoIWFwcCkge1xuICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKCdFcnJvcjogQXBwbGljYXRpb24gcmVmZXJlbmNlIG5vdCBhdmFpbGFibGUnLCAnYm90JywgZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnJlbnRTaGVsbFdpZGdldCA9IGFwcC5zaGVsbC5jdXJyZW50V2lkZ2V0O1xuICAgICAgICBpZiAoY3VycmVudFNoZWxsV2lkZ2V0KSB7XG4gICAgICAgICAgICBjb25zdCB3aWRnZXRDb250ZXh0ID0gdGhpcy5kb2NNYW5hZ2VyLmNvbnRleHRGb3JXaWRnZXQoY3VycmVudFNoZWxsV2lkZ2V0KTtcbiAgICAgICAgICAgIGlmICh3aWRnZXRDb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aCA9IHdpZGdldENvbnRleHQucGF0aDtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0U2xhc2ggPSBwYXRoLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgICAgICAgICAgZGlyUGF0aCA9IGxhc3RTbGFzaCA9PT0gLTEgPyAnJyA6IHBhdGguc3Vic3RyaW5nKDAsIGxhc3RTbGFzaCk7XG4gICAgICAgICAgICAgICAgc291cmNlID0gJ3dpZGdldCBjb250ZXh0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBGYWxsYmFjayB0byBub3RlYm9vayB0cmFja2VyIGlmIG5vIGNvbnRleHQgZnJvbSB3aWRnZXRcbiAgICAgICAgaWYgKGRpclBhdGggPT09IG51bGwgJiYgZ2xvYmFscy5ub3RlYm9va1RyYWNrZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnROb3RlYm9va1BhbmVsID0gZ2xvYmFscy5ub3RlYm9va1RyYWNrZXIuY3VycmVudFdpZGdldDtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Tm90ZWJvb2tQYW5lbCBpbnN0YW5jZW9mIE5vdGVib29rUGFuZWwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuYlBhdGggPSBjdXJyZW50Tm90ZWJvb2tQYW5lbC5jb250ZXh0LnBhdGg7XG4gICAgICAgICAgICAgICAgY29uc3QgbGFzdFNsYXNoID0gbmJQYXRoLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgICAgICAgICAgZGlyUGF0aCA9IGxhc3RTbGFzaCA9PT0gLTEgPyAnJyA6IG5iUGF0aC5zdWJzdHJpbmcoMCwgbGFzdFNsYXNoKTtcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSAnYWN0aXZlIG5vdGVib29rJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBMaXN0IGNvbnRlbnRzIGlmIHBhdGggd2FzIGZvdW5kXG4gICAgICAgIGlmIChkaXJQYXRoICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRzID0gYXdhaXQgdGhpcy5kb2NNYW5hZ2VyLnNlcnZpY2VzLmNvbnRlbnRzLmdldChkaXJQYXRoKTtcbiAgICAgICAgICAgICAgICBpZiAoY29udGVudHMuY29udGVudCAmJiBjb250ZW50cy5jb250ZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUNvbnRlbnQgPSBgRGlyZWN0b3J5IGNvbnRlbnRzICgke3NvdXJjZX0pOlxcbiR7Y29udGVudHMuY29udGVudC5tYXAoKGl0ZW0pID0+IGAtICR7aXRlbS5uYW1lfSAoJHtpdGVtLnR5cGV9KWApLmpvaW4oJ1xcbicpfWA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShtZXNzYWdlQ29udGVudCwgJ2JvdCcsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKGBEaXJlY3RvcnkgXCIke2RpclBhdGggfHwgJy8nfVwiIGlzIGVtcHR5LmAsICdib3QnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoYEVycm9yIGxpc3RpbmcgZGlyZWN0b3J5IGNvbnRlbnRzIGZvciBcIiR7ZGlyUGF0aH1cIjogJHtlcnJvcn1gLCAnYm90JywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoJ0NvdWxkIG5vdCBkZXRlcm1pbmUgY3VycmVudCBkaXJlY3RvcnkgY29udGV4dC4nLCAnYm90JywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=