"use strict";
(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["vendors-node_modules_jupyter-simple-extension_lib_index_js"],{

/***/ "./node_modules/jupyter-simple-extension/lib/cell-context-tracker.js":
/*!***************************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/cell-context-tracker.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CellContextTracker: () => (/* binding */ CellContextTracker)
/* harmony export */ });
/**
 * Tracks cell context and cursor position within Jupyter notebooks
 */
class CellContextTracker {
    constructor(app, notebookTracker) {
        this.activeCellEditorNode = null;
        this.lastCellContext = null;
        this._isDisposed = false;
        /**
         * Handles editor events (keydown, mouseup)
         */
        this.handleEditorEvent = (event) => {
            try {
                // Get the current active cell from the tracker
                const cell = this.notebookTracker.activeCell;
                if (!cell || !cell.editor)
                    return;
                // Find the inner EditorView instance
                const editor = cell.editor;
                const view = editor.editor;
                if (!view)
                    return;
                // Get and store the cursor context
                this.lastCellContext = this.getCmContext(view);
            }
            catch (error) {
                console.error("Error in editor event handler:", error);
            }
        };
        this.notebookTracker = notebookTracker;
        this.setupTrackers();
    }
    /**
     * Whether this object has been disposed
     */
    get isDisposed() {
        return this._isDisposed;
    }
    /**
     * Sets up all the necessary event trackers
     */
    setupTrackers() {
        // Handle active cell changes
        this.notebookTracker.activeCellChanged.connect(this.setupCellListeners, this);
        // Handle notebook changes
        this.notebookTracker.currentChanged.connect(this.handleNotebookChange, this);
    }
    /**
     * Handles notebook changes
     */
    handleNotebookChange(tracker, panel) {
        this.cleanupPreviousListeners();
        if (panel && panel.content) {
            const cell = panel.content.activeCell;
            this.setupCellListeners(tracker, cell);
        }
    }
    /**
     * Sets up event listeners on the active cell
     */
    setupCellListeners(_tracker, cell) {
        if (!cell)
            return;
        this.cleanupPreviousListeners();
        if (cell.editor) {
            try {
                const cellNode = cell.node;
                const editorNode = cellNode.querySelector('.jp-Editor') ||
                    cellNode.querySelector('.jp-InputArea-editor');
                if (editorNode) {
                    this.activeCellEditorNode = editorNode;
                    // Add event listeners for key and mouse events
                    editorNode.addEventListener('keydown', this.handleEditorEvent);
                    editorNode.addEventListener('mouseup', this.handleEditorEvent);
                    // Try to capture immediate context if EditorView available
                    const view = cell.editor.editor;
                    if (view) {
                        this.lastCellContext = this.getCmContext(view);
                    }
                }
            }
            catch (error) {
                console.error("Error setting up cell listeners:", error);
            }
        }
    }
    /**
     * Cleans up event listeners from the previous active cell
     */
    cleanupPreviousListeners() {
        if (this.activeCellEditorNode) {
            this.activeCellEditorNode.removeEventListener('keydown', this.handleEditorEvent);
            this.activeCellEditorNode.removeEventListener('mouseup', this.handleEditorEvent);
            this.activeCellEditorNode = null;
        }
    }
    /**
     * Gets context information from CodeMirror EditorView
     */
    getCmContext(view) {
        const state = view.state;
        const offset = state.selection.main.head;
        const fullText = state.doc.toString();
        const line = state.doc.lineAt(offset);
        const position = {
            line: line.number - 1,
            column: offset - line.from,
            offset: offset
        };
        const contextRadius = 100;
        const start = Math.max(0, offset - contextRadius);
        const end = Math.min(fullText.length, offset + contextRadius);
        return {
            text: fullText,
            position: position,
            contextBefore: fullText.substring(start, offset),
            contextAfter: fullText.substring(offset, end)
        };
    }
    /**
     * Gets the current cell context
     */
    getCurrentCellContext() {
        return this.lastCellContext;
    }
    /**
     * Disposes all resources
     */
    dispose() {
        if (this._isDisposed) {
            return;
        }
        this._isDisposed = true;
        this.cleanupPreviousListeners();
        this.notebookTracker.activeCellChanged.disconnect(this.setupCellListeners, this);
        this.notebookTracker.currentChanged.disconnect(this.handleNotebookChange, this);
    }
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/commands.js":
/*!***************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/commands.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   registerCommands: () => (/* binding */ registerCommands)
/* harmony export */ });
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./icons */ "./node_modules/jupyter-simple-extension/lib/icons.js");

/**
 * Registers commands for the extension
 */
function registerCommands(app, palette, launcher, sidebarWidget) {
    // Add command to toggle the sidebar
    app.commands.addCommand('simple-extension:toggle-sidebar', {
        label: 'Toggle AI Assistant Sidebar',
        icon: _icons__WEBPACK_IMPORTED_MODULE_0__.extensionIcon,
        execute: () => {
            if (sidebarWidget.isAttached) {
                sidebarWidget.parent = null;
            }
            else {
                app.shell.add(sidebarWidget, 'left', { rank: 9999 });
            }
        }
    });
    // Add the command to the command palette
    palette.addItem({
        command: 'simple-extension:toggle-sidebar',
        category: 'Extension'
    });
    // Add a launcher item
    launcher.add({
        command: 'simple-extension:toggle-sidebar',
        category: 'Other',
        rank: 9999
    });
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/globals.js":
/*!**************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/globals.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   globals: () => (/* binding */ globals),
/* harmony export */   initGlobals: () => (/* binding */ initGlobals)
/* harmony export */ });
/**
 * Global references to key components in the application
 */
const globals = {};
/**
 * Initialize global references
 */
function initGlobals(app, notebookTracker) {
    globals.app = app;
    globals.notebookTracker = notebookTracker;
}


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/icons.js":
/*!************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/icons.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   extensionIcon: () => (/* binding */ extensionIcon)
/* harmony export */ });
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/ui-components */ "webpack/sharing/consume/default/@jupyterlab/ui-components/@jupyterlab/ui-components");
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__);

// ===============================
// Icon Definition
// ===============================
const iconSvgStr = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-left-text" viewBox="0 0 16 16">' +
    '<path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>' +
    '<path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>' +
    '</svg>';
/**
 * Icon for the AI Assistant extension
 */
const extensionIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'simple:icon',
    svgstr: iconSvgStr
});


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/index.js":
/*!************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/index.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/launcher */ "webpack/sharing/consume/default/@jupyterlab/launcher/@jupyterlab/launcher");
/* harmony import */ var _jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @jupyterlab/notebook */ "webpack/sharing/consume/default/@jupyterlab/notebook/@jupyterlab/notebook");
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @jupyterlab/docmanager */ "webpack/sharing/consume/default/@jupyterlab/docmanager/@jupyterlab/docmanager");
/* harmony import */ var _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _sidebar_widget__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sidebar-widget */ "./node_modules/jupyter-simple-extension/lib/sidebar-widget.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./node_modules/jupyter-simple-extension/lib/globals.js");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./commands */ "./node_modules/jupyter-simple-extension/lib/commands.js");
/* harmony import */ var _cell_context_tracker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./cell-context-tracker */ "./node_modules/jupyter-simple-extension/lib/cell-context-tracker.js");








/**
 * Initialization data for the jupyter-simple-extension extension.
 */
const plugin = {
    id: 'jupyter-simple-extension:plugin',
    autoStart: true,
    requires: [_jupyterlab_launcher__WEBPACK_IMPORTED_MODULE_0__.ILauncher, _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_1__.ICommandPalette, _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_2__.INotebookTracker, _jupyterlab_docmanager__WEBPACK_IMPORTED_MODULE_3__.IDocumentManager],
    activate: (jupyterApp, launcher, palette, tracker, docManager) => {
        console.log('JupyterLab extension jupyter-simple-extension is activated!');
        // Initialize global references
        (0,_globals__WEBPACK_IMPORTED_MODULE_5__.initGlobals)(jupyterApp, tracker);
        // Initialize cell context tracker
        _globals__WEBPACK_IMPORTED_MODULE_5__.globals.cellContextTracker = new _cell_context_tracker__WEBPACK_IMPORTED_MODULE_7__.CellContextTracker(jupyterApp, tracker);
        // Create and add sidebar widget
        const sidebarWidget = new _sidebar_widget__WEBPACK_IMPORTED_MODULE_4__.SimpleSidebarWidget(docManager);
        jupyterApp.shell.add(sidebarWidget, 'left', { rank: 9999 });
        // Register commands
        (0,_commands__WEBPACK_IMPORTED_MODULE_6__.registerCommands)(jupyterApp, palette, launcher, sidebarWidget);
    }
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (plugin);


/***/ }),

/***/ "./node_modules/jupyter-simple-extension/lib/sidebar-widget.js":
/*!*********************************************************************!*\
  !*** ./node_modules/jupyter-simple-extension/lib/sidebar-widget.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SimpleSidebarWidget: () => (/* binding */ SimpleSidebarWidget)
/* harmony export */ });
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @lumino/widgets */ "webpack/sharing/consume/default/@lumino/widgets/@lumino/widgets");
/* harmony import */ var _lumino_widgets__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lumino_widgets__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @jupyterlab/notebook */ "webpack/sharing/consume/default/@jupyterlab/notebook/@jupyterlab/notebook");
/* harmony import */ var _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var marked__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! marked */ "webpack/sharing/consume/default/marked/marked");
/* harmony import */ var marked__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(marked__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! dompurify */ "webpack/sharing/consume/default/dompurify/dompurify");
/* harmony import */ var dompurify__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(dompurify__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _icons__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./icons */ "./node_modules/jupyter-simple-extension/lib/icons.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./node_modules/jupyter-simple-extension/lib/globals.js");






/**
 * Main sidebar widget for the AI chat interface
 */
class SimpleSidebarWidget extends _lumino_widgets__WEBPACK_IMPORTED_MODULE_0__.Widget {
    constructor(docManager) {
        super();
        this.isMarkdownMode = false;
        this.isInputExpanded = false;
        this.chatHistory = [];
        this.currentChatId = '';
        this.isHistoryViewActive = false;
        this.docManager = docManager;
        this.id = 'simple-sidebar';
        this.title.label = '';
        this.title.caption = 'AI Chat Interface';
        this.title.icon = _icons__WEBPACK_IMPORTED_MODULE_4__.extensionIcon;
        this.title.closable = true;
        // Initialize container elements before creating layout
        this.messageContainer = document.createElement('div');
        this.inputContainer = document.createElement('div');
        this.inputField = document.createElement('textarea');
        this.titleInput = document.createElement('input');
        this.historyContainer = document.createElement('div');
        // Create a new chat on start
        this.createNewChat();
        this.node.appendChild(this.createLayout());
    }
    /**
     * Creates the main layout for the sidebar
     */
    createLayout() {
        // Create the main container
        const content = document.createElement('div');
        content.className = 'simple-sidebar-content';
        // Create title input container
        const titleContainer = document.createElement('div');
        titleContainer.className = 'title-container';
        // Set up title input
        this.titleInput.className = 'chat-title-input';
        this.titleInput.type = 'text';
        this.titleInput.placeholder = 'Chat title';
        this.titleInput.value = 'New Chat';
        this.titleInput.addEventListener('change', () => this.updateCurrentChatTitle());
        titleContainer.appendChild(this.titleInput);
        // Configure top action buttons (New Chat & History)
        const topActionsContainer = document.createElement('div');
        topActionsContainer.className = 'top-actions-container';
        const newChatButton = document.createElement('button');
        newChatButton.className = 'jp-Button action-button';
        newChatButton.textContent = '+ New Chat';
        newChatButton.title = 'Start a new chat';
        newChatButton.addEventListener('click', () => this.createNewChat());
        const historyButton = document.createElement('button');
        historyButton.className = 'jp-Button action-button';
        historyButton.textContent = 'History';
        historyButton.title = 'View chat history';
        historyButton.addEventListener('click', () => this.toggleHistoryView());
        topActionsContainer.appendChild(newChatButton);
        topActionsContainer.appendChild(historyButton);
        // Configure message container
        this.messageContainer.className = 'message-container';
        // Configure history container
        this.historyContainer.className = 'history-container';
        this.historyContainer.style.display = 'none'; // Initially hidden
        // Configure input container
        this.inputContainer.className = 'input-container';
        // Create controls container
        const controlsContainer = this.createControlsContainer();
        // Configure input field
        this.inputField.placeholder = 'Ask me anything...';
        this.inputField.style.flexGrow = '1';
        this.inputField.style.padding = '5px';
        this.inputField.style.border = '1px solid #ccc';
        this.inputField.style.borderRadius = '3px';
        this.inputField.style.resize = 'none';
        this.inputField.rows = 1;
        this.inputField.style.overflowY = 'auto';
        // Add keypress listener to input field
        this.inputField.addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                this.handleSendMessage();
            }
        });
        // Create send button container
        const inputActionsContainer = document.createElement('div');
        inputActionsContainer.className = 'input-actions-container';
        // Create send button
        const sendButton = document.createElement('button');
        sendButton.className = 'jp-Button send-button';
        sendButton.textContent = 'Send';
        sendButton.addEventListener('click', () => this.handleSendMessage());
        // Add button to actions container
        inputActionsContainer.appendChild(sendButton);
        // Assemble the input components
        this.inputContainer.appendChild(controlsContainer);
        this.inputContainer.appendChild(this.inputField);
        this.inputContainer.appendChild(inputActionsContainer);
        // Assemble all components
        content.appendChild(topActionsContainer);
        content.appendChild(titleContainer);
        content.appendChild(this.messageContainer);
        content.appendChild(this.historyContainer);
        content.appendChild(this.inputContainer);
        return content;
    }
    /**
     * Creates a new chat session
     */
    createNewChat() {
        // Generate a unique ID for the chat
        const chatId = `chat-${Date.now()}`;
        // Create a new chat item
        const newChat = {
            id: chatId,
            title: 'New Chat',
            messages: []
        };
        // Add to history
        this.chatHistory.push(newChat);
        // Set as current chat
        this.currentChatId = chatId;
        // Update title input
        this.titleInput.value = newChat.title;
        // Clear message container
        if (this.messageContainer) {
            this.messageContainer.innerHTML = '';
        }
        // Hide history if it's visible
        if (this.isHistoryViewActive) {
            this.toggleHistoryView();
        }
    }
    /**
     * Toggles between chat view and history view
     */
    toggleHistoryView() {
        this.isHistoryViewActive = !this.isHistoryViewActive;
        if (this.isHistoryViewActive) {
            // Show history view, hide message view
            this.messageContainer.style.display = 'none';
            this.historyContainer.style.display = 'block';
            this.inputContainer.style.display = 'none';
            this.titleInput.style.display = 'none';
            // Populate history
            this.renderChatHistory();
        }
        else {
            // Show message view, hide history view
            this.messageContainer.style.display = 'block';
            this.historyContainer.style.display = 'none';
            this.inputContainer.style.display = 'flex';
            this.titleInput.style.display = 'block';
        }
    }
    /**
     * Renders the chat history in the history container
     */
    renderChatHistory() {
        this.historyContainer.innerHTML = '';
        if (this.chatHistory.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-history-message';
            emptyMessage.textContent = 'No chat history yet';
            this.historyContainer.appendChild(emptyMessage);
            return;
        }
        // Create a list of chat history items
        this.chatHistory.forEach(chat => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            if (chat.id === this.currentChatId) {
                historyItem.classList.add('active');
            }
            // Add title
            const title = document.createElement('div');
            title.className = 'history-title';
            title.textContent = chat.title;
            // Add message preview
            const preview = document.createElement('div');
            preview.className = 'history-preview';
            const lastMessage = chat.messages[chat.messages.length - 1];
            preview.textContent = lastMessage
                ? `${lastMessage.text.substring(0, 40)}${lastMessage.text.length > 40 ? '...' : ''}`
                : 'Empty chat';
            // Add click event
            historyItem.addEventListener('click', () => this.loadChat(chat.id));
            historyItem.appendChild(title);
            historyItem.appendChild(preview);
            this.historyContainer.appendChild(historyItem);
        });
    }
    /**
     * Loads a chat from history
     */
    loadChat(chatId) {
        const chat = this.chatHistory.find(c => c.id === chatId);
        if (!chat)
            return;
        // Set as current chat
        this.currentChatId = chatId;
        // Update title
        this.titleInput.value = chat.title;
        // Clear and re-populate message container
        this.messageContainer.innerHTML = '';
        chat.messages.forEach(msg => {
            this.addMessage(msg.text, msg.sender, msg.isMarkdown, false);
        });
        // Switch back to chat view
        if (this.isHistoryViewActive) {
            this.toggleHistoryView();
        }
    }
    /**
     * Updates the title of the current chat
     */
    updateCurrentChatTitle() {
        const chat = this.chatHistory.find(c => c.id === this.currentChatId);
        if (chat) {
            chat.title = this.titleInput.value;
        }
    }
    /**
     * Creates the controls container with toggles and action buttons
     */
    createControlsContainer() {
        const controlsContainer = document.createElement('div');
        controlsContainer.className = 'controls-container';
        // Create markdown toggle container
        const toggleContainer = document.createElement('div');
        toggleContainer.className = 'toggle-container';
        // Create markdown toggle
        const markdownToggle = document.createElement('input');
        markdownToggle.type = 'checkbox';
        markdownToggle.id = 'markdown-toggle';
        markdownToggle.style.marginRight = '5px';
        markdownToggle.addEventListener('change', (e) => {
            const target = e.target;
            this.isMarkdownMode = target.checked;
            this.inputField.placeholder = this.isMarkdownMode ?
                'Write markdown here...\n\n# Example heading\n- List item\n\n```code block```' :
                'Ask me anything...';
        });
        // Create toggle label
        const toggleLabel = document.createElement('label');
        toggleLabel.htmlFor = 'markdown-toggle';
        toggleLabel.textContent = 'Markdown mode';
        toggleLabel.style.fontSize = '12px';
        // Add toggle elements to container
        toggleContainer.appendChild(markdownToggle);
        toggleContainer.appendChild(toggleLabel);
        // Create action buttons container
        const actionButtonsContainer = document.createElement('div');
        actionButtonsContainer.className = 'action-buttons-container';
        // Create all action buttons
        const buttons = [
            { text: '@', title: 'Command list', action: () => { } },
            { text: '📎', title: 'Upload file', action: () => { } },
            { text: '🔍', title: 'Browse files', action: () => { } },
            {
                text: '⤢',
                title: 'Expand input',
                action: () => this.toggleInputExpansion(actionButtonsContainer.children[3])
            },
            { text: '⚙️', title: 'Settings', action: () => { } },
            { text: '📁', title: 'List Directory Contents', action: () => this.listCurrentDirectoryContents() }
        ];
        // Add all buttons to the container
        buttons.forEach(button => {
            const btn = this.createButton(button.text, button.title);
            btn.addEventListener('click', button.action);
            actionButtonsContainer.appendChild(btn);
        });
        // Add toggle and action buttons to the controls container
        controlsContainer.appendChild(toggleContainer);
        controlsContainer.appendChild(actionButtonsContainer);
        return controlsContainer;
    }
    /**
     * Toggles the expansion state of the input field
     */
    toggleInputExpansion(button) {
        this.isInputExpanded = !this.isInputExpanded;
        if (this.isInputExpanded) {
            this.inputField.style.height = '100px';
            this.inputField.style.resize = 'vertical';
            button.textContent = '⤡';
            button.title = 'Collapse input';
        }
        else {
            this.inputField.style.height = 'auto';
            this.inputField.style.resize = 'none';
            button.textContent = '⤢';
            button.title = 'Expand input';
        }
    }
    /**
     * Helper function to create a button with given text and tooltip
     */
    createButton(text, tooltip) {
        const button = document.createElement('button');
        button.textContent = text;
        button.title = tooltip;
        button.className = 'jp-Button action-button';
        return button;
    }
    /**
     * Handles sending a message from the input field
     */
    handleSendMessage() {
        const message = this.inputField.value.trim();
        if (message) {
            // Add to UI
            this.addMessage(message, 'user', this.isMarkdownMode);
            this.inputField.value = '';
            // Reset expanded state if needed after sending
            if (this.isInputExpanded) {
                this.inputField.style.height = '100px';
            }
            else {
                this.inputField.style.height = 'auto';
                this.inputField.rows = 1;
            }
            // In the future, this will call the backend sidecar service
            setTimeout(() => {
                this.addMessage(`Echo: ${message}`, 'bot', true);
            }, 500);
        }
    }
    /**
     * Adds a message to the chat interface
     */
    addMessage(text, sender, isMarkdown = false, saveToHistory = true) {
        const messageDiv = document.createElement('div');
        messageDiv.className = sender === 'user' ? 'user-message' : 'bot-message';
        // Add message content
        if (isMarkdown || sender === 'bot') {
            // Bot messages are always rendered as markdown
            const markdownIndicator = document.createElement('div');
            markdownIndicator.textContent = "MD";
            markdownIndicator.className = 'markdown-indicator';
            messageDiv.appendChild(markdownIndicator);
            // Create a container for the rendered markdown
            const contentDiv = document.createElement('div');
            contentDiv.className = 'markdown-content';
            try {
                const rawHtml = marked__WEBPACK_IMPORTED_MODULE_2__.marked.parse(text);
                const sanitizedHtml = dompurify__WEBPACK_IMPORTED_MODULE_3___default().sanitize(rawHtml);
                contentDiv.innerHTML = sanitizedHtml;
            }
            catch (error) {
                contentDiv.textContent = text;
                console.error('Failed to render markdown:', error);
            }
            messageDiv.appendChild(contentDiv);
        }
        else {
            messageDiv.textContent = text;
        }
        this.messageContainer.appendChild(messageDiv);
        this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
        // Save to chat history
        if (saveToHistory) {
            const chat = this.chatHistory.find(c => c.id === this.currentChatId);
            if (chat) {
                chat.messages.push({
                    text,
                    sender,
                    isMarkdown: isMarkdown || sender === 'bot'
                });
            }
        }
    }
    /**
     * Lists the contents of the current directory
     */
    async listCurrentDirectoryContents() {
        let dirPath = null;
        let source = null;
        // Try to get directory path from current widget
        const app = _globals__WEBPACK_IMPORTED_MODULE_5__.globals.app;
        if (!app) {
            this.addMessage('Error: Application reference not available', 'bot', false);
            return;
        }
        const currentShellWidget = app.shell.currentWidget;
        if (currentShellWidget) {
            const widgetContext = this.docManager.contextForWidget(currentShellWidget);
            if (widgetContext) {
                const path = widgetContext.path;
                const lastSlash = path.lastIndexOf('/');
                dirPath = lastSlash === -1 ? '' : path.substring(0, lastSlash);
                source = 'widget context';
            }
        }
        // Fallback to notebook tracker if no context from widget
        if (dirPath === null && _globals__WEBPACK_IMPORTED_MODULE_5__.globals.notebookTracker) {
            const currentNotebookPanel = _globals__WEBPACK_IMPORTED_MODULE_5__.globals.notebookTracker.currentWidget;
            if (currentNotebookPanel instanceof _jupyterlab_notebook__WEBPACK_IMPORTED_MODULE_1__.NotebookPanel) {
                const nbPath = currentNotebookPanel.context.path;
                const lastSlash = nbPath.lastIndexOf('/');
                dirPath = lastSlash === -1 ? '' : nbPath.substring(0, lastSlash);
                source = 'active notebook';
            }
        }
        // List contents if path was found
        if (dirPath !== null) {
            try {
                const contents = await this.docManager.services.contents.get(dirPath);
                if (contents.content && contents.content.length > 0) {
                    const messageContent = `Directory contents (${source}):\n${contents.content.map((item) => `- ${item.name} (${item.type})`).join('\n')}`;
                    this.addMessage(messageContent, 'bot', true);
                }
                else {
                    this.addMessage(`Directory "${dirPath || '/'}" is empty.`, 'bot', true);
                }
            }
            catch (error) {
                this.addMessage(`Error listing directory contents for "${dirPath}": ${error}`, 'bot', true);
            }
        }
        else {
            this.addMessage('Could not determine current directory context.', 'bot', true);
        }
    }
}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uX2xpYl9pbmRleF9qcy5jYTcyNTlkYmQwMmNiNTlkZjllYS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ087QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FDekl3QztBQUN4QztBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBLGNBQWMsaURBQWE7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxZQUFZO0FBQ25FO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7Ozs7Ozs7Ozs7Ozs7OztBQzdCQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQ1ZvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLDBCQUEwQiw4REFBTztBQUN4QztBQUNBO0FBQ0EsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDZGdEO0FBQ007QUFDQztBQUNFO0FBQ0g7QUFDTjtBQUNIO0FBQ2M7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSwyREFBUyxFQUFFLGlFQUFlLEVBQUUsa0VBQWdCLEVBQUUsb0VBQWdCO0FBQzdFO0FBQ0E7QUFDQTtBQUNBLFFBQVEscURBQVc7QUFDbkI7QUFDQSxRQUFRLDZDQUFPLDBCQUEwQixxRUFBa0I7QUFDM0Q7QUFDQSxrQ0FBa0MsZ0VBQW1CO0FBQ3JELHNEQUFzRCxZQUFZO0FBQ2xFO0FBQ0EsUUFBUSwyREFBZ0I7QUFDeEI7QUFDQTtBQUNBLGlFQUFlLE1BQU0sRUFBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzVCbUI7QUFDWTtBQUNyQjtBQUNFO0FBQ007QUFDSjtBQUNwQztBQUNBO0FBQ0E7QUFDTyxrQ0FBa0MsbURBQU07QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixpREFBYTtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0RBQXNEO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixXQUFXO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIsa0NBQWtDLEVBQUUsMENBQTBDO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMscURBQXFEO0FBQ25FLGNBQWMscURBQXFEO0FBQ25FLGNBQWMsc0RBQXNEO0FBQ3BFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLGNBQWMsa0RBQWtEO0FBQ2hFLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsUUFBUTtBQUNqRCxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsMENBQU07QUFDdEMsc0NBQXNDLHlEQUFrQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsNkNBQU87QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLDZDQUFPO0FBQ3ZDLHlDQUF5Qyw2Q0FBTztBQUNoRCxnREFBZ0QsK0RBQWE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSxPQUFPLE1BQU0sb0NBQW9DLFdBQVcsR0FBRyxVQUFVLGVBQWU7QUFDMUo7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELGVBQWU7QUFDakU7QUFDQTtBQUNBO0FBQ0EseUVBQXlFLFFBQVEsS0FBSyxNQUFNO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4vbm9kZV9tb2R1bGVzL2p1cHl0ZXItc2ltcGxlLWV4dGVuc2lvbi9saWIvY2VsbC1jb250ZXh0LXRyYWNrZXIuanMiLCJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4vbm9kZV9tb2R1bGVzL2p1cHl0ZXItc2ltcGxlLWV4dGVuc2lvbi9saWIvY29tbWFuZHMuanMiLCJ3ZWJwYWNrOi8vQGp1cHl0ZXJsYWIvYXBwbGljYXRpb24tdG9wLy4vbm9kZV9tb2R1bGVzL2p1cHl0ZXItc2ltcGxlLWV4dGVuc2lvbi9saWIvZ2xvYmFscy5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uL2xpYi9pY29ucy5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uL2xpYi9pbmRleC5qcyIsIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi9ub2RlX21vZHVsZXMvanVweXRlci1zaW1wbGUtZXh0ZW5zaW9uL2xpYi9zaWRlYmFyLXdpZGdldC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRyYWNrcyBjZWxsIGNvbnRleHQgYW5kIGN1cnNvciBwb3NpdGlvbiB3aXRoaW4gSnVweXRlciBub3RlYm9va3NcbiAqL1xuZXhwb3J0IGNsYXNzIENlbGxDb250ZXh0VHJhY2tlciB7XG4gICAgY29uc3RydWN0b3IoYXBwLCBub3RlYm9va1RyYWNrZXIpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVDZWxsRWRpdG9yTm9kZSA9IG51bGw7XG4gICAgICAgIHRoaXMubGFzdENlbGxDb250ZXh0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5faXNEaXNwb3NlZCA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyBlZGl0b3IgZXZlbnRzIChrZXlkb3duLCBtb3VzZXVwKVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oYW5kbGVFZGl0b3JFdmVudCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgYWN0aXZlIGNlbGwgZnJvbSB0aGUgdHJhY2tlclxuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLm5vdGVib29rVHJhY2tlci5hY3RpdmVDZWxsO1xuICAgICAgICAgICAgICAgIGlmICghY2VsbCB8fCAhY2VsbC5lZGl0b3IpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyBGaW5kIHRoZSBpbm5lciBFZGl0b3JWaWV3IGluc3RhbmNlXG4gICAgICAgICAgICAgICAgY29uc3QgZWRpdG9yID0gY2VsbC5lZGl0b3I7XG4gICAgICAgICAgICAgICAgY29uc3QgdmlldyA9IGVkaXRvci5lZGl0b3I7XG4gICAgICAgICAgICAgICAgaWYgKCF2aWV3KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gR2V0IGFuZCBzdG9yZSB0aGUgY3Vyc29yIGNvbnRleHRcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RDZWxsQ29udGV4dCA9IHRoaXMuZ2V0Q21Db250ZXh0KHZpZXcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIGVkaXRvciBldmVudCBoYW5kbGVyOlwiLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubm90ZWJvb2tUcmFja2VyID0gbm90ZWJvb2tUcmFja2VyO1xuICAgICAgICB0aGlzLnNldHVwVHJhY2tlcnMoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGlzIG9iamVjdCBoYXMgYmVlbiBkaXNwb3NlZFxuICAgICAqL1xuICAgIGdldCBpc0Rpc3Bvc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNEaXNwb3NlZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB1cCBhbGwgdGhlIG5lY2Vzc2FyeSBldmVudCB0cmFja2Vyc1xuICAgICAqL1xuICAgIHNldHVwVHJhY2tlcnMoKSB7XG4gICAgICAgIC8vIEhhbmRsZSBhY3RpdmUgY2VsbCBjaGFuZ2VzXG4gICAgICAgIHRoaXMubm90ZWJvb2tUcmFja2VyLmFjdGl2ZUNlbGxDaGFuZ2VkLmNvbm5lY3QodGhpcy5zZXR1cENlbGxMaXN0ZW5lcnMsIHRoaXMpO1xuICAgICAgICAvLyBIYW5kbGUgbm90ZWJvb2sgY2hhbmdlc1xuICAgICAgICB0aGlzLm5vdGVib29rVHJhY2tlci5jdXJyZW50Q2hhbmdlZC5jb25uZWN0KHRoaXMuaGFuZGxlTm90ZWJvb2tDaGFuZ2UsIHRoaXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIG5vdGVib29rIGNoYW5nZXNcbiAgICAgKi9cbiAgICBoYW5kbGVOb3RlYm9va0NoYW5nZSh0cmFja2VyLCBwYW5lbCkge1xuICAgICAgICB0aGlzLmNsZWFudXBQcmV2aW91c0xpc3RlbmVycygpO1xuICAgICAgICBpZiAocGFuZWwgJiYgcGFuZWwuY29udGVudCkge1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHBhbmVsLmNvbnRlbnQuYWN0aXZlQ2VsbDtcbiAgICAgICAgICAgIHRoaXMuc2V0dXBDZWxsTGlzdGVuZXJzKHRyYWNrZXIsIGNlbGwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgZXZlbnQgbGlzdGVuZXJzIG9uIHRoZSBhY3RpdmUgY2VsbFxuICAgICAqL1xuICAgIHNldHVwQ2VsbExpc3RlbmVycyhfdHJhY2tlciwgY2VsbCkge1xuICAgICAgICBpZiAoIWNlbGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuY2xlYW51cFByZXZpb3VzTGlzdGVuZXJzKCk7XG4gICAgICAgIGlmIChjZWxsLmVkaXRvcikge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjZWxsTm9kZSA9IGNlbGwubm9kZTtcbiAgICAgICAgICAgICAgICBjb25zdCBlZGl0b3JOb2RlID0gY2VsbE5vZGUucXVlcnlTZWxlY3RvcignLmpwLUVkaXRvcicpIHx8XG4gICAgICAgICAgICAgICAgICAgIGNlbGxOb2RlLnF1ZXJ5U2VsZWN0b3IoJy5qcC1JbnB1dEFyZWEtZWRpdG9yJyk7XG4gICAgICAgICAgICAgICAgaWYgKGVkaXRvck5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVDZWxsRWRpdG9yTm9kZSA9IGVkaXRvck5vZGU7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgZm9yIGtleSBhbmQgbW91c2UgZXZlbnRzXG4gICAgICAgICAgICAgICAgICAgIGVkaXRvck5vZGUuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuaGFuZGxlRWRpdG9yRXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3JOb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLmhhbmRsZUVkaXRvckV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGNhcHR1cmUgaW1tZWRpYXRlIGNvbnRleHQgaWYgRWRpdG9yVmlldyBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmlldyA9IGNlbGwuZWRpdG9yLmVkaXRvcjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdENlbGxDb250ZXh0ID0gdGhpcy5nZXRDbUNvbnRleHQodmlldyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyB1cCBjZWxsIGxpc3RlbmVyczpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsZWFucyB1cCBldmVudCBsaXN0ZW5lcnMgZnJvbSB0aGUgcHJldmlvdXMgYWN0aXZlIGNlbGxcbiAgICAgKi9cbiAgICBjbGVhbnVwUHJldmlvdXNMaXN0ZW5lcnMoKSB7XG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZUNlbGxFZGl0b3JOb2RlKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZUNlbGxFZGl0b3JOb2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmhhbmRsZUVkaXRvckV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlQ2VsbEVkaXRvck5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuaGFuZGxlRWRpdG9yRXZlbnQpO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVDZWxsRWRpdG9yTm9kZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBjb250ZXh0IGluZm9ybWF0aW9uIGZyb20gQ29kZU1pcnJvciBFZGl0b3JWaWV3XG4gICAgICovXG4gICAgZ2V0Q21Db250ZXh0KHZpZXcpIHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB2aWV3LnN0YXRlO1xuICAgICAgICBjb25zdCBvZmZzZXQgPSBzdGF0ZS5zZWxlY3Rpb24ubWFpbi5oZWFkO1xuICAgICAgICBjb25zdCBmdWxsVGV4dCA9IHN0YXRlLmRvYy50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBsaW5lID0gc3RhdGUuZG9jLmxpbmVBdChvZmZzZXQpO1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHtcbiAgICAgICAgICAgIGxpbmU6IGxpbmUubnVtYmVyIC0gMSxcbiAgICAgICAgICAgIGNvbHVtbjogb2Zmc2V0IC0gbGluZS5mcm9tLFxuICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXRcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgY29udGV4dFJhZGl1cyA9IDEwMDtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBvZmZzZXQgLSBjb250ZXh0UmFkaXVzKTtcbiAgICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oZnVsbFRleHQubGVuZ3RoLCBvZmZzZXQgKyBjb250ZXh0UmFkaXVzKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRleHQ6IGZ1bGxUZXh0LFxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICAgICAgY29udGV4dEJlZm9yZTogZnVsbFRleHQuc3Vic3RyaW5nKHN0YXJ0LCBvZmZzZXQpLFxuICAgICAgICAgICAgY29udGV4dEFmdGVyOiBmdWxsVGV4dC5zdWJzdHJpbmcob2Zmc2V0LCBlbmQpXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGN1cnJlbnQgY2VsbCBjb250ZXh0XG4gICAgICovXG4gICAgZ2V0Q3VycmVudENlbGxDb250ZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sYXN0Q2VsbENvbnRleHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERpc3Bvc2VzIGFsbCByZXNvdXJjZXNcbiAgICAgKi9cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5faXNEaXNwb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2lzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmNsZWFudXBQcmV2aW91c0xpc3RlbmVycygpO1xuICAgICAgICB0aGlzLm5vdGVib29rVHJhY2tlci5hY3RpdmVDZWxsQ2hhbmdlZC5kaXNjb25uZWN0KHRoaXMuc2V0dXBDZWxsTGlzdGVuZXJzLCB0aGlzKTtcbiAgICAgICAgdGhpcy5ub3RlYm9va1RyYWNrZXIuY3VycmVudENoYW5nZWQuZGlzY29ubmVjdCh0aGlzLmhhbmRsZU5vdGVib29rQ2hhbmdlLCB0aGlzKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgeyBleHRlbnNpb25JY29uIH0gZnJvbSAnLi9pY29ucyc7XG4vKipcbiAqIFJlZ2lzdGVycyBjb21tYW5kcyBmb3IgdGhlIGV4dGVuc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJDb21tYW5kcyhhcHAsIHBhbGV0dGUsIGxhdW5jaGVyLCBzaWRlYmFyV2lkZ2V0KSB7XG4gICAgLy8gQWRkIGNvbW1hbmQgdG8gdG9nZ2xlIHRoZSBzaWRlYmFyXG4gICAgYXBwLmNvbW1hbmRzLmFkZENvbW1hbmQoJ3NpbXBsZS1leHRlbnNpb246dG9nZ2xlLXNpZGViYXInLCB7XG4gICAgICAgIGxhYmVsOiAnVG9nZ2xlIEFJIEFzc2lzdGFudCBTaWRlYmFyJyxcbiAgICAgICAgaWNvbjogZXh0ZW5zaW9uSWNvbixcbiAgICAgICAgZXhlY3V0ZTogKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHNpZGViYXJXaWRnZXQuaXNBdHRhY2hlZCkge1xuICAgICAgICAgICAgICAgIHNpZGViYXJXaWRnZXQucGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFwcC5zaGVsbC5hZGQoc2lkZWJhcldpZGdldCwgJ2xlZnQnLCB7IHJhbms6IDk5OTkgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBBZGQgdGhlIGNvbW1hbmQgdG8gdGhlIGNvbW1hbmQgcGFsZXR0ZVxuICAgIHBhbGV0dGUuYWRkSXRlbSh7XG4gICAgICAgIGNvbW1hbmQ6ICdzaW1wbGUtZXh0ZW5zaW9uOnRvZ2dsZS1zaWRlYmFyJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdFeHRlbnNpb24nXG4gICAgfSk7XG4gICAgLy8gQWRkIGEgbGF1bmNoZXIgaXRlbVxuICAgIGxhdW5jaGVyLmFkZCh7XG4gICAgICAgIGNvbW1hbmQ6ICdzaW1wbGUtZXh0ZW5zaW9uOnRvZ2dsZS1zaWRlYmFyJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdPdGhlcicsXG4gICAgICAgIHJhbms6IDk5OTlcbiAgICB9KTtcbn1cbiIsIi8qKlxuICogR2xvYmFsIHJlZmVyZW5jZXMgdG8ga2V5IGNvbXBvbmVudHMgaW4gdGhlIGFwcGxpY2F0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBnbG9iYWxzID0ge307XG4vKipcbiAqIEluaXRpYWxpemUgZ2xvYmFsIHJlZmVyZW5jZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRHbG9iYWxzKGFwcCwgbm90ZWJvb2tUcmFja2VyKSB7XG4gICAgZ2xvYmFscy5hcHAgPSBhcHA7XG4gICAgZ2xvYmFscy5ub3RlYm9va1RyYWNrZXIgPSBub3RlYm9va1RyYWNrZXI7XG59XG4iLCJpbXBvcnQgeyBMYWJJY29uIH0gZnJvbSAnQGp1cHl0ZXJsYWIvdWktY29tcG9uZW50cyc7XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJY29uIERlZmluaXRpb25cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmNvbnN0IGljb25TdmdTdHIgPSAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjE2XCIgZmlsbD1cImN1cnJlbnRDb2xvclwiIGNsYXNzPVwiYmkgYmktY2hhdC1sZWZ0LXRleHRcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCI+JyArXG4gICAgJzxwYXRoIGQ9XCJNMTQgMWExIDEgMCAwIDEgMSAxdjhhMSAxIDAgMCAxLTEgMUg0LjQxNEEyIDIgMCAwIDAgMyAxMS41ODZsLTIgMlYyYTEgMSAwIDAgMSAxLTFoMTJ6TTIgMGEyIDIgMCAwIDAtMiAydjEyLjc5M2EuNS41IDAgMCAwIC44NTQuMzUzbDIuODUzLTIuODUzQTEgMSAwIDAgMSA0LjQxNCAxMkgxNGEyIDIgMCAwIDAgMi0yVjJhMiAyIDAgMCAwLTItMkgyelwiLz4nICtcbiAgICAnPHBhdGggZD1cIk0zIDMuNWEuNS41IDAgMCAxIC41LS41aDlhLjUuNSAwIDAgMSAwIDFoLTlhLjUuNSAwIDAgMS0uNS0uNXpNMyA2YS41LjUgMCAwIDEgLjUtLjVoOWEuNS41IDAgMCAxIDAgMWgtOUEuNS41IDAgMCAxIDMgNnptMCAyLjVhLjUuNSAwIDAgMSAuNS0uNWg1YS41LjUgMCAwIDEgMCAxaC01YS41LjUgMCAwIDEtLjUtLjV6XCIvPicgK1xuICAgICc8L3N2Zz4nO1xuLyoqXG4gKiBJY29uIGZvciB0aGUgQUkgQXNzaXN0YW50IGV4dGVuc2lvblxuICovXG5leHBvcnQgY29uc3QgZXh0ZW5zaW9uSWNvbiA9IG5ldyBMYWJJY29uKHtcbiAgICBuYW1lOiAnc2ltcGxlOmljb24nLFxuICAgIHN2Z3N0cjogaWNvblN2Z1N0clxufSk7XG4iLCJpbXBvcnQgeyBJTGF1bmNoZXIgfSBmcm9tICdAanVweXRlcmxhYi9sYXVuY2hlcic7XG5pbXBvcnQgeyBJQ29tbWFuZFBhbGV0dGUgfSBmcm9tICdAanVweXRlcmxhYi9hcHB1dGlscyc7XG5pbXBvcnQgeyBJTm90ZWJvb2tUcmFja2VyIH0gZnJvbSAnQGp1cHl0ZXJsYWIvbm90ZWJvb2snO1xuaW1wb3J0IHsgSURvY3VtZW50TWFuYWdlciB9IGZyb20gJ0BqdXB5dGVybGFiL2RvY21hbmFnZXInO1xuaW1wb3J0IHsgU2ltcGxlU2lkZWJhcldpZGdldCB9IGZyb20gJy4vc2lkZWJhci13aWRnZXQnO1xuaW1wb3J0IHsgaW5pdEdsb2JhbHMsIGdsb2JhbHMgfSBmcm9tICcuL2dsb2JhbHMnO1xuaW1wb3J0IHsgcmVnaXN0ZXJDb21tYW5kcyB9IGZyb20gJy4vY29tbWFuZHMnO1xuaW1wb3J0IHsgQ2VsbENvbnRleHRUcmFja2VyIH0gZnJvbSAnLi9jZWxsLWNvbnRleHQtdHJhY2tlcic7XG4vKipcbiAqIEluaXRpYWxpemF0aW9uIGRhdGEgZm9yIHRoZSBqdXB5dGVyLXNpbXBsZS1leHRlbnNpb24gZXh0ZW5zaW9uLlxuICovXG5jb25zdCBwbHVnaW4gPSB7XG4gICAgaWQ6ICdqdXB5dGVyLXNpbXBsZS1leHRlbnNpb246cGx1Z2luJyxcbiAgICBhdXRvU3RhcnQ6IHRydWUsXG4gICAgcmVxdWlyZXM6IFtJTGF1bmNoZXIsIElDb21tYW5kUGFsZXR0ZSwgSU5vdGVib29rVHJhY2tlciwgSURvY3VtZW50TWFuYWdlcl0sXG4gICAgYWN0aXZhdGU6IChqdXB5dGVyQXBwLCBsYXVuY2hlciwgcGFsZXR0ZSwgdHJhY2tlciwgZG9jTWFuYWdlcikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnSnVweXRlckxhYiBleHRlbnNpb24ganVweXRlci1zaW1wbGUtZXh0ZW5zaW9uIGlzIGFjdGl2YXRlZCEnKTtcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBnbG9iYWwgcmVmZXJlbmNlc1xuICAgICAgICBpbml0R2xvYmFscyhqdXB5dGVyQXBwLCB0cmFja2VyKTtcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBjZWxsIGNvbnRleHQgdHJhY2tlclxuICAgICAgICBnbG9iYWxzLmNlbGxDb250ZXh0VHJhY2tlciA9IG5ldyBDZWxsQ29udGV4dFRyYWNrZXIoanVweXRlckFwcCwgdHJhY2tlcik7XG4gICAgICAgIC8vIENyZWF0ZSBhbmQgYWRkIHNpZGViYXIgd2lkZ2V0XG4gICAgICAgIGNvbnN0IHNpZGViYXJXaWRnZXQgPSBuZXcgU2ltcGxlU2lkZWJhcldpZGdldChkb2NNYW5hZ2VyKTtcbiAgICAgICAganVweXRlckFwcC5zaGVsbC5hZGQoc2lkZWJhcldpZGdldCwgJ2xlZnQnLCB7IHJhbms6IDk5OTkgfSk7XG4gICAgICAgIC8vIFJlZ2lzdGVyIGNvbW1hbmRzXG4gICAgICAgIHJlZ2lzdGVyQ29tbWFuZHMoanVweXRlckFwcCwgcGFsZXR0ZSwgbGF1bmNoZXIsIHNpZGViYXJXaWRnZXQpO1xuICAgIH1cbn07XG5leHBvcnQgZGVmYXVsdCBwbHVnaW47XG4iLCJpbXBvcnQgeyBXaWRnZXQgfSBmcm9tICdAbHVtaW5vL3dpZGdldHMnO1xuaW1wb3J0IHsgTm90ZWJvb2tQYW5lbCB9IGZyb20gJ0BqdXB5dGVybGFiL25vdGVib29rJztcbmltcG9ydCB7IG1hcmtlZCB9IGZyb20gJ21hcmtlZCc7XG5pbXBvcnQgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7XG5pbXBvcnQgeyBleHRlbnNpb25JY29uIH0gZnJvbSAnLi9pY29ucyc7XG5pbXBvcnQgeyBnbG9iYWxzIH0gZnJvbSAnLi9nbG9iYWxzJztcbi8qKlxuICogTWFpbiBzaWRlYmFyIHdpZGdldCBmb3IgdGhlIEFJIGNoYXQgaW50ZXJmYWNlXG4gKi9cbmV4cG9ydCBjbGFzcyBTaW1wbGVTaWRlYmFyV2lkZ2V0IGV4dGVuZHMgV2lkZ2V0IHtcbiAgICBjb25zdHJ1Y3Rvcihkb2NNYW5hZ2VyKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuaXNNYXJrZG93bk1vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc0lucHV0RXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jaGF0SGlzdG9yeSA9IFtdO1xuICAgICAgICB0aGlzLmN1cnJlbnRDaGF0SWQgPSAnJztcbiAgICAgICAgdGhpcy5pc0hpc3RvcnlWaWV3QWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZG9jTWFuYWdlciA9IGRvY01hbmFnZXI7XG4gICAgICAgIHRoaXMuaWQgPSAnc2ltcGxlLXNpZGViYXInO1xuICAgICAgICB0aGlzLnRpdGxlLmxhYmVsID0gJyc7XG4gICAgICAgIHRoaXMudGl0bGUuY2FwdGlvbiA9ICdBSSBDaGF0IEludGVyZmFjZSc7XG4gICAgICAgIHRoaXMudGl0bGUuaWNvbiA9IGV4dGVuc2lvbkljb247XG4gICAgICAgIHRoaXMudGl0bGUuY2xvc2FibGUgPSB0cnVlO1xuICAgICAgICAvLyBJbml0aWFsaXplIGNvbnRhaW5lciBlbGVtZW50cyBiZWZvcmUgY3JlYXRpbmcgbGF5b3V0XG4gICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmlucHV0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgY2hhdCBvbiBzdGFydFxuICAgICAgICB0aGlzLmNyZWF0ZU5ld0NoYXQoKTtcbiAgICAgICAgdGhpcy5ub2RlLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlTGF5b3V0KCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIHRoZSBtYWluIGxheW91dCBmb3IgdGhlIHNpZGViYXJcbiAgICAgKi9cbiAgICBjcmVhdGVMYXlvdXQoKSB7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgbWFpbiBjb250YWluZXJcbiAgICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjb250ZW50LmNsYXNzTmFtZSA9ICdzaW1wbGUtc2lkZWJhci1jb250ZW50JztcbiAgICAgICAgLy8gQ3JlYXRlIHRpdGxlIGlucHV0IGNvbnRhaW5lclxuICAgICAgICBjb25zdCB0aXRsZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aXRsZUNvbnRhaW5lci5jbGFzc05hbWUgPSAndGl0bGUtY29udGFpbmVyJztcbiAgICAgICAgLy8gU2V0IHVwIHRpdGxlIGlucHV0XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC5jbGFzc05hbWUgPSAnY2hhdC10aXRsZS1pbnB1dCc7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC50eXBlID0gJ3RleHQnO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXQucGxhY2Vob2xkZXIgPSAnQ2hhdCB0aXRsZSc7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC52YWx1ZSA9ICdOZXcgQ2hhdCc7XG4gICAgICAgIHRoaXMudGl0bGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB0aGlzLnVwZGF0ZUN1cnJlbnRDaGF0VGl0bGUoKSk7XG4gICAgICAgIHRpdGxlQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMudGl0bGVJbnB1dCk7XG4gICAgICAgIC8vIENvbmZpZ3VyZSB0b3AgYWN0aW9uIGJ1dHRvbnMgKE5ldyBDaGF0ICYgSGlzdG9yeSlcbiAgICAgICAgY29uc3QgdG9wQWN0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0b3BBY3Rpb25zQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0b3AtYWN0aW9ucy1jb250YWluZXInO1xuICAgICAgICBjb25zdCBuZXdDaGF0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIG5ld0NoYXRCdXR0b24uY2xhc3NOYW1lID0gJ2pwLUJ1dHRvbiBhY3Rpb24tYnV0dG9uJztcbiAgICAgICAgbmV3Q2hhdEJ1dHRvbi50ZXh0Q29udGVudCA9ICcrIE5ldyBDaGF0JztcbiAgICAgICAgbmV3Q2hhdEJ1dHRvbi50aXRsZSA9ICdTdGFydCBhIG5ldyBjaGF0JztcbiAgICAgICAgbmV3Q2hhdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuY3JlYXRlTmV3Q2hhdCgpKTtcbiAgICAgICAgY29uc3QgaGlzdG9yeUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBoaXN0b3J5QnV0dG9uLmNsYXNzTmFtZSA9ICdqcC1CdXR0b24gYWN0aW9uLWJ1dHRvbic7XG4gICAgICAgIGhpc3RvcnlCdXR0b24udGV4dENvbnRlbnQgPSAnSGlzdG9yeSc7XG4gICAgICAgIGhpc3RvcnlCdXR0b24udGl0bGUgPSAnVmlldyBjaGF0IGhpc3RvcnknO1xuICAgICAgICBoaXN0b3J5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy50b2dnbGVIaXN0b3J5VmlldygpKTtcbiAgICAgICAgdG9wQWN0aW9uc0NvbnRhaW5lci5hcHBlbmRDaGlsZChuZXdDaGF0QnV0dG9uKTtcbiAgICAgICAgdG9wQWN0aW9uc0NvbnRhaW5lci5hcHBlbmRDaGlsZChoaXN0b3J5QnV0dG9uKTtcbiAgICAgICAgLy8gQ29uZmlndXJlIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5jbGFzc05hbWUgPSAnbWVzc2FnZS1jb250YWluZXInO1xuICAgICAgICAvLyBDb25maWd1cmUgaGlzdG9yeSBjb250YWluZXJcbiAgICAgICAgdGhpcy5oaXN0b3J5Q29udGFpbmVyLmNsYXNzTmFtZSA9ICdoaXN0b3J5LWNvbnRhaW5lcic7XG4gICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAvLyBJbml0aWFsbHkgaGlkZGVuXG4gICAgICAgIC8vIENvbmZpZ3VyZSBpbnB1dCBjb250YWluZXJcbiAgICAgICAgdGhpcy5pbnB1dENvbnRhaW5lci5jbGFzc05hbWUgPSAnaW5wdXQtY29udGFpbmVyJztcbiAgICAgICAgLy8gQ3JlYXRlIGNvbnRyb2xzIGNvbnRhaW5lclxuICAgICAgICBjb25zdCBjb250cm9sc0NvbnRhaW5lciA9IHRoaXMuY3JlYXRlQ29udHJvbHNDb250YWluZXIoKTtcbiAgICAgICAgLy8gQ29uZmlndXJlIGlucHV0IGZpZWxkXG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5wbGFjZWhvbGRlciA9ICdBc2sgbWUgYW55dGhpbmcuLi4nO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUuZmxleEdyb3cgPSAnMSc7XG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5wYWRkaW5nID0gJzVweCc7XG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICNjY2MnO1xuICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUuYm9yZGVyUmFkaXVzID0gJzNweCc7XG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5yZXNpemUgPSAnbm9uZSc7XG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5yb3dzID0gMTtcbiAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLm92ZXJmbG93WSA9ICdhdXRvJztcbiAgICAgICAgLy8gQWRkIGtleXByZXNzIGxpc3RlbmVyIHRvIGlucHV0IGZpZWxkXG4gICAgICAgIHRoaXMuaW5wdXRGaWVsZC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJyAmJiAhZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU2VuZE1lc3NhZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENyZWF0ZSBzZW5kIGJ1dHRvbiBjb250YWluZXJcbiAgICAgICAgY29uc3QgaW5wdXRBY3Rpb25zQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGlucHV0QWN0aW9uc0NvbnRhaW5lci5jbGFzc05hbWUgPSAnaW5wdXQtYWN0aW9ucy1jb250YWluZXInO1xuICAgICAgICAvLyBDcmVhdGUgc2VuZCBidXR0b25cbiAgICAgICAgY29uc3Qgc2VuZEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICBzZW5kQnV0dG9uLmNsYXNzTmFtZSA9ICdqcC1CdXR0b24gc2VuZC1idXR0b24nO1xuICAgICAgICBzZW5kQnV0dG9uLnRleHRDb250ZW50ID0gJ1NlbmQnO1xuICAgICAgICBzZW5kQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5oYW5kbGVTZW5kTWVzc2FnZSgpKTtcbiAgICAgICAgLy8gQWRkIGJ1dHRvbiB0byBhY3Rpb25zIGNvbnRhaW5lclxuICAgICAgICBpbnB1dEFjdGlvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VuZEJ1dHRvbik7XG4gICAgICAgIC8vIEFzc2VtYmxlIHRoZSBpbnB1dCBjb21wb25lbnRzXG4gICAgICAgIHRoaXMuaW5wdXRDb250YWluZXIuYXBwZW5kQ2hpbGQoY29udHJvbHNDb250YWluZXIpO1xuICAgICAgICB0aGlzLmlucHV0Q29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuaW5wdXRGaWVsZCk7XG4gICAgICAgIHRoaXMuaW5wdXRDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXRBY3Rpb25zQ29udGFpbmVyKTtcbiAgICAgICAgLy8gQXNzZW1ibGUgYWxsIGNvbXBvbmVudHNcbiAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZCh0b3BBY3Rpb25zQ29udGFpbmVyKTtcbiAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZCh0aXRsZUNvbnRhaW5lcik7XG4gICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQodGhpcy5tZXNzYWdlQ29udGFpbmVyKTtcbiAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZCh0aGlzLmhpc3RvcnlDb250YWluZXIpO1xuICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHRoaXMuaW5wdXRDb250YWluZXIpO1xuICAgICAgICByZXR1cm4gY29udGVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBjaGF0IHNlc3Npb25cbiAgICAgKi9cbiAgICBjcmVhdGVOZXdDaGF0KCkge1xuICAgICAgICAvLyBHZW5lcmF0ZSBhIHVuaXF1ZSBJRCBmb3IgdGhlIGNoYXRcbiAgICAgICAgY29uc3QgY2hhdElkID0gYGNoYXQtJHtEYXRlLm5vdygpfWA7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBjaGF0IGl0ZW1cbiAgICAgICAgY29uc3QgbmV3Q2hhdCA9IHtcbiAgICAgICAgICAgIGlkOiBjaGF0SWQsXG4gICAgICAgICAgICB0aXRsZTogJ05ldyBDaGF0JyxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICAvLyBBZGQgdG8gaGlzdG9yeVxuICAgICAgICB0aGlzLmNoYXRIaXN0b3J5LnB1c2gobmV3Q2hhdCk7XG4gICAgICAgIC8vIFNldCBhcyBjdXJyZW50IGNoYXRcbiAgICAgICAgdGhpcy5jdXJyZW50Q2hhdElkID0gY2hhdElkO1xuICAgICAgICAvLyBVcGRhdGUgdGl0bGUgaW5wdXRcbiAgICAgICAgdGhpcy50aXRsZUlucHV0LnZhbHVlID0gbmV3Q2hhdC50aXRsZTtcbiAgICAgICAgLy8gQ2xlYXIgbWVzc2FnZSBjb250YWluZXJcbiAgICAgICAgaWYgKHRoaXMubWVzc2FnZUNvbnRhaW5lcikge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlQ29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhpZGUgaGlzdG9yeSBpZiBpdCdzIHZpc2libGVcbiAgICAgICAgaWYgKHRoaXMuaXNIaXN0b3J5Vmlld0FjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVIaXN0b3J5VmlldygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRvZ2dsZXMgYmV0d2VlbiBjaGF0IHZpZXcgYW5kIGhpc3Rvcnkgdmlld1xuICAgICAqL1xuICAgIHRvZ2dsZUhpc3RvcnlWaWV3KCkge1xuICAgICAgICB0aGlzLmlzSGlzdG9yeVZpZXdBY3RpdmUgPSAhdGhpcy5pc0hpc3RvcnlWaWV3QWN0aXZlO1xuICAgICAgICBpZiAodGhpcy5pc0hpc3RvcnlWaWV3QWN0aXZlKSB7XG4gICAgICAgICAgICAvLyBTaG93IGhpc3RvcnkgdmlldywgaGlkZSBtZXNzYWdlIHZpZXdcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy5oaXN0b3J5Q29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgdGhpcy5pbnB1dENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICAvLyBQb3B1bGF0ZSBoaXN0b3J5XG4gICAgICAgICAgICB0aGlzLnJlbmRlckNoYXRIaXN0b3J5KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBTaG93IG1lc3NhZ2UgdmlldywgaGlkZSBoaXN0b3J5IHZpZXdcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy5pbnB1dENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICAgICAgICAgICAgdGhpcy50aXRsZUlucHV0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbmRlcnMgdGhlIGNoYXQgaGlzdG9yeSBpbiB0aGUgaGlzdG9yeSBjb250YWluZXJcbiAgICAgKi9cbiAgICByZW5kZXJDaGF0SGlzdG9yeSgpIHtcbiAgICAgICAgdGhpcy5oaXN0b3J5Q29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBpZiAodGhpcy5jaGF0SGlzdG9yeS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGVtcHR5TWVzc2FnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZW1wdHlNZXNzYWdlLmNsYXNzTmFtZSA9ICdlbXB0eS1oaXN0b3J5LW1lc3NhZ2UnO1xuICAgICAgICAgICAgZW1wdHlNZXNzYWdlLnRleHRDb250ZW50ID0gJ05vIGNoYXQgaGlzdG9yeSB5ZXQnO1xuICAgICAgICAgICAgdGhpcy5oaXN0b3J5Q29udGFpbmVyLmFwcGVuZENoaWxkKGVtcHR5TWVzc2FnZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIGEgbGlzdCBvZiBjaGF0IGhpc3RvcnkgaXRlbXNcbiAgICAgICAgdGhpcy5jaGF0SGlzdG9yeS5mb3JFYWNoKGNoYXQgPT4ge1xuICAgICAgICAgICAgY29uc3QgaGlzdG9yeUl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGhpc3RvcnlJdGVtLmNsYXNzTmFtZSA9ICdoaXN0b3J5LWl0ZW0nO1xuICAgICAgICAgICAgaWYgKGNoYXQuaWQgPT09IHRoaXMuY3VycmVudENoYXRJZCkge1xuICAgICAgICAgICAgICAgIGhpc3RvcnlJdGVtLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQWRkIHRpdGxlXG4gICAgICAgICAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgdGl0bGUuY2xhc3NOYW1lID0gJ2hpc3RvcnktdGl0bGUnO1xuICAgICAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBjaGF0LnRpdGxlO1xuICAgICAgICAgICAgLy8gQWRkIG1lc3NhZ2UgcHJldmlld1xuICAgICAgICAgICAgY29uc3QgcHJldmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgcHJldmlldy5jbGFzc05hbWUgPSAnaGlzdG9yeS1wcmV2aWV3JztcbiAgICAgICAgICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gY2hhdC5tZXNzYWdlc1tjaGF0Lm1lc3NhZ2VzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgcHJldmlldy50ZXh0Q29udGVudCA9IGxhc3RNZXNzYWdlXG4gICAgICAgICAgICAgICAgPyBgJHtsYXN0TWVzc2FnZS50ZXh0LnN1YnN0cmluZygwLCA0MCl9JHtsYXN0TWVzc2FnZS50ZXh0Lmxlbmd0aCA+IDQwID8gJy4uLicgOiAnJ31gXG4gICAgICAgICAgICAgICAgOiAnRW1wdHkgY2hhdCc7XG4gICAgICAgICAgICAvLyBBZGQgY2xpY2sgZXZlbnRcbiAgICAgICAgICAgIGhpc3RvcnlJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5sb2FkQ2hhdChjaGF0LmlkKSk7XG4gICAgICAgICAgICBoaXN0b3J5SXRlbS5hcHBlbmRDaGlsZCh0aXRsZSk7XG4gICAgICAgICAgICBoaXN0b3J5SXRlbS5hcHBlbmRDaGlsZChwcmV2aWV3KTtcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUNvbnRhaW5lci5hcHBlbmRDaGlsZChoaXN0b3J5SXRlbSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb2FkcyBhIGNoYXQgZnJvbSBoaXN0b3J5XG4gICAgICovXG4gICAgbG9hZENoYXQoY2hhdElkKSB7XG4gICAgICAgIGNvbnN0IGNoYXQgPSB0aGlzLmNoYXRIaXN0b3J5LmZpbmQoYyA9PiBjLmlkID09PSBjaGF0SWQpO1xuICAgICAgICBpZiAoIWNoYXQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIFNldCBhcyBjdXJyZW50IGNoYXRcbiAgICAgICAgdGhpcy5jdXJyZW50Q2hhdElkID0gY2hhdElkO1xuICAgICAgICAvLyBVcGRhdGUgdGl0bGVcbiAgICAgICAgdGhpcy50aXRsZUlucHV0LnZhbHVlID0gY2hhdC50aXRsZTtcbiAgICAgICAgLy8gQ2xlYXIgYW5kIHJlLXBvcHVsYXRlIG1lc3NhZ2UgY29udGFpbmVyXG4gICAgICAgIHRoaXMubWVzc2FnZUNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgY2hhdC5tZXNzYWdlcy5mb3JFYWNoKG1zZyA9PiB7XG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UobXNnLnRleHQsIG1zZy5zZW5kZXIsIG1zZy5pc01hcmtkb3duLCBmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBTd2l0Y2ggYmFjayB0byBjaGF0IHZpZXdcbiAgICAgICAgaWYgKHRoaXMuaXNIaXN0b3J5Vmlld0FjdGl2ZSkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVIaXN0b3J5VmlldygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHRpdGxlIG9mIHRoZSBjdXJyZW50IGNoYXRcbiAgICAgKi9cbiAgICB1cGRhdGVDdXJyZW50Q2hhdFRpdGxlKCkge1xuICAgICAgICBjb25zdCBjaGF0ID0gdGhpcy5jaGF0SGlzdG9yeS5maW5kKGMgPT4gYy5pZCA9PT0gdGhpcy5jdXJyZW50Q2hhdElkKTtcbiAgICAgICAgaWYgKGNoYXQpIHtcbiAgICAgICAgICAgIGNoYXQudGl0bGUgPSB0aGlzLnRpdGxlSW5wdXQudmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyB0aGUgY29udHJvbHMgY29udGFpbmVyIHdpdGggdG9nZ2xlcyBhbmQgYWN0aW9uIGJ1dHRvbnNcbiAgICAgKi9cbiAgICBjcmVhdGVDb250cm9sc0NvbnRhaW5lcigpIHtcbiAgICAgICAgY29uc3QgY29udHJvbHNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY29udHJvbHNDb250YWluZXIuY2xhc3NOYW1lID0gJ2NvbnRyb2xzLWNvbnRhaW5lcic7XG4gICAgICAgIC8vIENyZWF0ZSBtYXJrZG93biB0b2dnbGUgY29udGFpbmVyXG4gICAgICAgIGNvbnN0IHRvZ2dsZUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0b2dnbGVDb250YWluZXIuY2xhc3NOYW1lID0gJ3RvZ2dsZS1jb250YWluZXInO1xuICAgICAgICAvLyBDcmVhdGUgbWFya2Rvd24gdG9nZ2xlXG4gICAgICAgIGNvbnN0IG1hcmtkb3duVG9nZ2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgbWFya2Rvd25Ub2dnbGUudHlwZSA9ICdjaGVja2JveCc7XG4gICAgICAgIG1hcmtkb3duVG9nZ2xlLmlkID0gJ21hcmtkb3duLXRvZ2dsZSc7XG4gICAgICAgIG1hcmtkb3duVG9nZ2xlLnN0eWxlLm1hcmdpblJpZ2h0ID0gJzVweCc7XG4gICAgICAgIG1hcmtkb3duVG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAgICAgICAgIHRoaXMuaXNNYXJrZG93bk1vZGUgPSB0YXJnZXQuY2hlY2tlZDtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC5wbGFjZWhvbGRlciA9IHRoaXMuaXNNYXJrZG93bk1vZGUgP1xuICAgICAgICAgICAgICAgICdXcml0ZSBtYXJrZG93biBoZXJlLi4uXFxuXFxuIyBFeGFtcGxlIGhlYWRpbmdcXG4tIExpc3QgaXRlbVxcblxcbmBgYGNvZGUgYmxvY2tgYGAnIDpcbiAgICAgICAgICAgICAgICAnQXNrIG1lIGFueXRoaW5nLi4uJztcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENyZWF0ZSB0b2dnbGUgbGFiZWxcbiAgICAgICAgY29uc3QgdG9nZ2xlTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgICAgICB0b2dnbGVMYWJlbC5odG1sRm9yID0gJ21hcmtkb3duLXRvZ2dsZSc7XG4gICAgICAgIHRvZ2dsZUxhYmVsLnRleHRDb250ZW50ID0gJ01hcmtkb3duIG1vZGUnO1xuICAgICAgICB0b2dnbGVMYWJlbC5zdHlsZS5mb250U2l6ZSA9ICcxMnB4JztcbiAgICAgICAgLy8gQWRkIHRvZ2dsZSBlbGVtZW50cyB0byBjb250YWluZXJcbiAgICAgICAgdG9nZ2xlQ29udGFpbmVyLmFwcGVuZENoaWxkKG1hcmtkb3duVG9nZ2xlKTtcbiAgICAgICAgdG9nZ2xlQ29udGFpbmVyLmFwcGVuZENoaWxkKHRvZ2dsZUxhYmVsKTtcbiAgICAgICAgLy8gQ3JlYXRlIGFjdGlvbiBidXR0b25zIGNvbnRhaW5lclxuICAgICAgICBjb25zdCBhY3Rpb25CdXR0b25zQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGFjdGlvbkJ1dHRvbnNDb250YWluZXIuY2xhc3NOYW1lID0gJ2FjdGlvbi1idXR0b25zLWNvbnRhaW5lcic7XG4gICAgICAgIC8vIENyZWF0ZSBhbGwgYWN0aW9uIGJ1dHRvbnNcbiAgICAgICAgY29uc3QgYnV0dG9ucyA9IFtcbiAgICAgICAgICAgIHsgdGV4dDogJ0AnLCB0aXRsZTogJ0NvbW1hbmQgbGlzdCcsIGFjdGlvbjogKCkgPT4geyB9IH0sXG4gICAgICAgICAgICB7IHRleHQ6ICfwn5OOJywgdGl0bGU6ICdVcGxvYWQgZmlsZScsIGFjdGlvbjogKCkgPT4geyB9IH0sXG4gICAgICAgICAgICB7IHRleHQ6ICfwn5SNJywgdGl0bGU6ICdCcm93c2UgZmlsZXMnLCBhY3Rpb246ICgpID0+IHsgfSB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRleHQ6ICfipKInLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRXhwYW5kIGlucHV0JyxcbiAgICAgICAgICAgICAgICBhY3Rpb246ICgpID0+IHRoaXMudG9nZ2xlSW5wdXRFeHBhbnNpb24oYWN0aW9uQnV0dG9uc0NvbnRhaW5lci5jaGlsZHJlblszXSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHRleHQ6ICfimpnvuI8nLCB0aXRsZTogJ1NldHRpbmdzJywgYWN0aW9uOiAoKSA9PiB7IH0gfSxcbiAgICAgICAgICAgIHsgdGV4dDogJ/Cfk4EnLCB0aXRsZTogJ0xpc3QgRGlyZWN0b3J5IENvbnRlbnRzJywgYWN0aW9uOiAoKSA9PiB0aGlzLmxpc3RDdXJyZW50RGlyZWN0b3J5Q29udGVudHMoKSB9XG4gICAgICAgIF07XG4gICAgICAgIC8vIEFkZCBhbGwgYnV0dG9ucyB0byB0aGUgY29udGFpbmVyXG4gICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgICAgICAgY29uc3QgYnRuID0gdGhpcy5jcmVhdGVCdXR0b24oYnV0dG9uLnRleHQsIGJ1dHRvbi50aXRsZSk7XG4gICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBidXR0b24uYWN0aW9uKTtcbiAgICAgICAgICAgIGFjdGlvbkJ1dHRvbnNDb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEFkZCB0b2dnbGUgYW5kIGFjdGlvbiBidXR0b25zIHRvIHRoZSBjb250cm9scyBjb250YWluZXJcbiAgICAgICAgY29udHJvbHNDb250YWluZXIuYXBwZW5kQ2hpbGQodG9nZ2xlQ29udGFpbmVyKTtcbiAgICAgICAgY29udHJvbHNDb250YWluZXIuYXBwZW5kQ2hpbGQoYWN0aW9uQnV0dG9uc0NvbnRhaW5lcik7XG4gICAgICAgIHJldHVybiBjb250cm9sc0NvbnRhaW5lcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVG9nZ2xlcyB0aGUgZXhwYW5zaW9uIHN0YXRlIG9mIHRoZSBpbnB1dCBmaWVsZFxuICAgICAqL1xuICAgIHRvZ2dsZUlucHV0RXhwYW5zaW9uKGJ1dHRvbikge1xuICAgICAgICB0aGlzLmlzSW5wdXRFeHBhbmRlZCA9ICF0aGlzLmlzSW5wdXRFeHBhbmRlZDtcbiAgICAgICAgaWYgKHRoaXMuaXNJbnB1dEV4cGFuZGVkKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0RmllbGQuc3R5bGUuaGVpZ2h0ID0gJzEwMHB4JztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5yZXNpemUgPSAndmVydGljYWwnO1xuICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ+KkoSc7XG4gICAgICAgICAgICBidXR0b24udGl0bGUgPSAnQ29sbGFwc2UgaW5wdXQnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5yZXNpemUgPSAnbm9uZSc7XG4gICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAn4qSiJztcbiAgICAgICAgICAgIGJ1dHRvbi50aXRsZSA9ICdFeHBhbmQgaW5wdXQnO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgYSBidXR0b24gd2l0aCBnaXZlbiB0ZXh0IGFuZCB0b29sdGlwXG4gICAgICovXG4gICAgY3JlYXRlQnV0dG9uKHRleHQsIHRvb2x0aXApIHtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgIGJ1dHRvbi50aXRsZSA9IHRvb2x0aXA7XG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSAnanAtQnV0dG9uIGFjdGlvbi1idXR0b24nO1xuICAgICAgICByZXR1cm4gYnV0dG9uO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIHNlbmRpbmcgYSBtZXNzYWdlIGZyb20gdGhlIGlucHV0IGZpZWxkXG4gICAgICovXG4gICAgaGFuZGxlU2VuZE1lc3NhZ2UoKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0aGlzLmlucHV0RmllbGQudmFsdWUudHJpbSgpO1xuICAgICAgICBpZiAobWVzc2FnZSkge1xuICAgICAgICAgICAgLy8gQWRkIHRvIFVJXG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UobWVzc2FnZSwgJ3VzZXInLCB0aGlzLmlzTWFya2Rvd25Nb2RlKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgLy8gUmVzZXQgZXhwYW5kZWQgc3RhdGUgaWYgbmVlZGVkIGFmdGVyIHNlbmRpbmdcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSW5wdXRFeHBhbmRlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRGaWVsZC5zdHlsZS5oZWlnaHQgPSAnMTAwcHgnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkLnN0eWxlLmhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0RmllbGQucm93cyA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJbiB0aGUgZnV0dXJlLCB0aGlzIHdpbGwgY2FsbCB0aGUgYmFja2VuZCBzaWRlY2FyIHNlcnZpY2VcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShgRWNobzogJHttZXNzYWdlfWAsICdib3QnLCB0cnVlKTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG1lc3NhZ2UgdG8gdGhlIGNoYXQgaW50ZXJmYWNlXG4gICAgICovXG4gICAgYWRkTWVzc2FnZSh0ZXh0LCBzZW5kZXIsIGlzTWFya2Rvd24gPSBmYWxzZSwgc2F2ZVRvSGlzdG9yeSA9IHRydWUpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBtZXNzYWdlRGl2LmNsYXNzTmFtZSA9IHNlbmRlciA9PT0gJ3VzZXInID8gJ3VzZXItbWVzc2FnZScgOiAnYm90LW1lc3NhZ2UnO1xuICAgICAgICAvLyBBZGQgbWVzc2FnZSBjb250ZW50XG4gICAgICAgIGlmIChpc01hcmtkb3duIHx8IHNlbmRlciA9PT0gJ2JvdCcpIHtcbiAgICAgICAgICAgIC8vIEJvdCBtZXNzYWdlcyBhcmUgYWx3YXlzIHJlbmRlcmVkIGFzIG1hcmtkb3duXG4gICAgICAgICAgICBjb25zdCBtYXJrZG93bkluZGljYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgbWFya2Rvd25JbmRpY2F0b3IudGV4dENvbnRlbnQgPSBcIk1EXCI7XG4gICAgICAgICAgICBtYXJrZG93bkluZGljYXRvci5jbGFzc05hbWUgPSAnbWFya2Rvd24taW5kaWNhdG9yJztcbiAgICAgICAgICAgIG1lc3NhZ2VEaXYuYXBwZW5kQ2hpbGQobWFya2Rvd25JbmRpY2F0b3IpO1xuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgY29udGFpbmVyIGZvciB0aGUgcmVuZGVyZWQgbWFya2Rvd25cbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGNvbnRlbnREaXYuY2xhc3NOYW1lID0gJ21hcmtkb3duLWNvbnRlbnQnO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByYXdIdG1sID0gbWFya2VkLnBhcnNlKHRleHQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZEh0bWwgPSBET01QdXJpZnkuc2FuaXRpemUocmF3SHRtbCk7XG4gICAgICAgICAgICAgICAgY29udGVudERpdi5pbm5lckhUTUwgPSBzYW5pdGl6ZWRIdG1sO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29udGVudERpdi50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHJlbmRlciBtYXJrZG93bjonLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtZXNzYWdlRGl2LmFwcGVuZENoaWxkKGNvbnRlbnREaXYpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWVzc2FnZURpdi50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tZXNzYWdlQ29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2VEaXYpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VDb250YWluZXIuc2Nyb2xsVG9wID0gdGhpcy5tZXNzYWdlQ29udGFpbmVyLnNjcm9sbEhlaWdodDtcbiAgICAgICAgLy8gU2F2ZSB0byBjaGF0IGhpc3RvcnlcbiAgICAgICAgaWYgKHNhdmVUb0hpc3RvcnkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoYXQgPSB0aGlzLmNoYXRIaXN0b3J5LmZpbmQoYyA9PiBjLmlkID09PSB0aGlzLmN1cnJlbnRDaGF0SWQpO1xuICAgICAgICAgICAgaWYgKGNoYXQpIHtcbiAgICAgICAgICAgICAgICBjaGF0Lm1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgICAgICAgICBzZW5kZXIsXG4gICAgICAgICAgICAgICAgICAgIGlzTWFya2Rvd246IGlzTWFya2Rvd24gfHwgc2VuZGVyID09PSAnYm90J1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExpc3RzIHRoZSBjb250ZW50cyBvZiB0aGUgY3VycmVudCBkaXJlY3RvcnlcbiAgICAgKi9cbiAgICBhc3luYyBsaXN0Q3VycmVudERpcmVjdG9yeUNvbnRlbnRzKCkge1xuICAgICAgICBsZXQgZGlyUGF0aCA9IG51bGw7XG4gICAgICAgIGxldCBzb3VyY2UgPSBudWxsO1xuICAgICAgICAvLyBUcnkgdG8gZ2V0IGRpcmVjdG9yeSBwYXRoIGZyb20gY3VycmVudCB3aWRnZXRcbiAgICAgICAgY29uc3QgYXBwID0gZ2xvYmFscy5hcHA7XG4gICAgICAgIGlmICghYXBwKSB7XG4gICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoJ0Vycm9yOiBBcHBsaWNhdGlvbiByZWZlcmVuY2Ugbm90IGF2YWlsYWJsZScsICdib3QnLCBmYWxzZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY3VycmVudFNoZWxsV2lkZ2V0ID0gYXBwLnNoZWxsLmN1cnJlbnRXaWRnZXQ7XG4gICAgICAgIGlmIChjdXJyZW50U2hlbGxXaWRnZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IHdpZGdldENvbnRleHQgPSB0aGlzLmRvY01hbmFnZXIuY29udGV4dEZvcldpZGdldChjdXJyZW50U2hlbGxXaWRnZXQpO1xuICAgICAgICAgICAgaWYgKHdpZGdldENvbnRleHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXRoID0gd2lkZ2V0Q29udGV4dC5wYXRoO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RTbGFzaCA9IHBhdGgubGFzdEluZGV4T2YoJy8nKTtcbiAgICAgICAgICAgICAgICBkaXJQYXRoID0gbGFzdFNsYXNoID09PSAtMSA/ICcnIDogcGF0aC5zdWJzdHJpbmcoMCwgbGFzdFNsYXNoKTtcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSAnd2lkZ2V0IGNvbnRleHQnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEZhbGxiYWNrIHRvIG5vdGVib29rIHRyYWNrZXIgaWYgbm8gY29udGV4dCBmcm9tIHdpZGdldFxuICAgICAgICBpZiAoZGlyUGF0aCA9PT0gbnVsbCAmJiBnbG9iYWxzLm5vdGVib29rVHJhY2tlcikge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudE5vdGVib29rUGFuZWwgPSBnbG9iYWxzLm5vdGVib29rVHJhY2tlci5jdXJyZW50V2lkZ2V0O1xuICAgICAgICAgICAgaWYgKGN1cnJlbnROb3RlYm9va1BhbmVsIGluc3RhbmNlb2YgTm90ZWJvb2tQYW5lbCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5iUGF0aCA9IGN1cnJlbnROb3RlYm9va1BhbmVsLmNvbnRleHQucGF0aDtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0U2xhc2ggPSBuYlBhdGgubGFzdEluZGV4T2YoJy8nKTtcbiAgICAgICAgICAgICAgICBkaXJQYXRoID0gbGFzdFNsYXNoID09PSAtMSA/ICcnIDogbmJQYXRoLnN1YnN0cmluZygwLCBsYXN0U2xhc2gpO1xuICAgICAgICAgICAgICAgIHNvdXJjZSA9ICdhY3RpdmUgbm90ZWJvb2snO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIExpc3QgY29udGVudHMgaWYgcGF0aCB3YXMgZm91bmRcbiAgICAgICAgaWYgKGRpclBhdGggIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudHMgPSBhd2FpdCB0aGlzLmRvY01hbmFnZXIuc2VydmljZXMuY29udGVudHMuZ2V0KGRpclBhdGgpO1xuICAgICAgICAgICAgICAgIGlmIChjb250ZW50cy5jb250ZW50ICYmIGNvbnRlbnRzLmNvbnRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlQ29udGVudCA9IGBEaXJlY3RvcnkgY29udGVudHMgKCR7c291cmNlfSk6XFxuJHtjb250ZW50cy5jb250ZW50Lm1hcCgoaXRlbSkgPT4gYC0gJHtpdGVtLm5hbWV9ICgke2l0ZW0udHlwZX0pYCkuam9pbignXFxuJyl9YDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlKG1lc3NhZ2VDb250ZW50LCAnYm90JywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2UoYERpcmVjdG9yeSBcIiR7ZGlyUGF0aCB8fCAnLyd9XCIgaXMgZW1wdHkuYCwgJ2JvdCcsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZShgRXJyb3IgbGlzdGluZyBkaXJlY3RvcnkgY29udGVudHMgZm9yIFwiJHtkaXJQYXRofVwiOiAke2Vycm9yfWAsICdib3QnLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWRkTWVzc2FnZSgnQ291bGQgbm90IGRldGVybWluZSBjdXJyZW50IGRpcmVjdG9yeSBjb250ZXh0LicsICdib3QnLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==