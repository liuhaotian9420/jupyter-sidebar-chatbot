"use strict";
(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["vendors-node_modules_codemirror_legacy-modes_mode_crystal_js"],{

/***/ "./node_modules/@codemirror/legacy-modes/mode/crystal.js":
/*!***************************************************************!*\
  !*** ./node_modules/@codemirror/legacy-modes/mode/crystal.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   crystal: () => (/* binding */ crystal)
/* harmony export */ });
function wordRegExp(words, end) {
  return new RegExp((end ? "" : "^") + "(?:" + words.join("|") + ")" + (end ? "$" : "\\b"));
}

function chain(tokenize, stream, state) {
  state.tokenize.push(tokenize);
  return tokenize(stream, state);
}

var operators = /^(?:[-+/%|&^]|\*\*?|[<>]{2})/;
var conditionalOperators = /^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;
var indexingOperators = /^(?:\[\][?=]?)/;
var anotherOperators = /^(?:\.(?:\.{2})?|->|[?:])/;
var idents = /^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;
var types = /^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;
var keywords = wordRegExp([
  "abstract", "alias", "as", "asm", "begin", "break", "case", "class", "def", "do",
  "else", "elsif", "end", "ensure", "enum", "extend", "for", "fun", "if",
  "include", "instance_sizeof", "lib", "macro", "module", "next", "of", "out", "pointerof",
  "private", "protected", "rescue", "return", "require", "select", "sizeof", "struct",
  "super", "then", "type", "typeof", "uninitialized", "union", "unless", "until", "when", "while", "with",
  "yield", "__DIR__", "__END_LINE__", "__FILE__", "__LINE__"
]);
var atomWords = wordRegExp(["true", "false", "nil", "self"]);
var indentKeywordsArray = [
  "def", "fun", "macro",
  "class", "module", "struct", "lib", "enum", "union",
  "do", "for"
];
var indentKeywords = wordRegExp(indentKeywordsArray);
var indentExpressionKeywordsArray = ["if", "unless", "case", "while", "until", "begin", "then"];
var indentExpressionKeywords = wordRegExp(indentExpressionKeywordsArray);
var dedentKeywordsArray = ["end", "else", "elsif", "rescue", "ensure"];
var dedentKeywords = wordRegExp(dedentKeywordsArray);
var dedentPunctualsArray = ["\\)", "\\}", "\\]"];
var dedentPunctuals = new RegExp("^(?:" + dedentPunctualsArray.join("|") + ")$");
var nextTokenizer = {
  "def": tokenFollowIdent, "fun": tokenFollowIdent, "macro": tokenMacroDef,
  "class": tokenFollowType, "module": tokenFollowType, "struct": tokenFollowType,
  "lib": tokenFollowType, "enum": tokenFollowType, "union": tokenFollowType
};
var matching = {"[": "]", "{": "}", "(": ")", "<": ">"};

function tokenBase(stream, state) {
  if (stream.eatSpace()) {
    return null;
  }

  // Macros
  if (state.lastToken != "\\" && stream.match("{%", false)) {
    return chain(tokenMacro("%", "%"), stream, state);
  }

  if (state.lastToken != "\\" && stream.match("{{", false)) {
    return chain(tokenMacro("{", "}"), stream, state);
  }

  // Comments
  if (stream.peek() == "#") {
    stream.skipToEnd();
    return "comment";
  }

  // Variables and keywords
  var matched;
  if (stream.match(idents)) {
    stream.eat(/[?!]/);

    matched = stream.current();
    if (stream.eat(":")) {
      return "atom";
    } else if (state.lastToken == ".") {
      return "property";
    } else if (keywords.test(matched)) {
      if (indentKeywords.test(matched)) {
        if (!(matched == "fun" && state.blocks.indexOf("lib") >= 0) && !(matched == "def" && state.lastToken == "abstract")) {
          state.blocks.push(matched);
          state.currentIndent += 1;
        }
      } else if ((state.lastStyle == "operator" || !state.lastStyle) && indentExpressionKeywords.test(matched)) {
        state.blocks.push(matched);
        state.currentIndent += 1;
      } else if (matched == "end") {
        state.blocks.pop();
        state.currentIndent -= 1;
      }

      if (nextTokenizer.hasOwnProperty(matched)) {
        state.tokenize.push(nextTokenizer[matched]);
      }

      return "keyword";
    } else if (atomWords.test(matched)) {
      return "atom";
    }

    return "variable";
  }

  // Class variables and instance variables
  // or attributes
  if (stream.eat("@")) {
    if (stream.peek() == "[") {
      return chain(tokenNest("[", "]", "meta"), stream, state);
    }

    stream.eat("@");
    stream.match(idents) || stream.match(types);
    return "propertyName";
  }

  // Constants and types
  if (stream.match(types)) {
    return "tag";
  }

  // Symbols or ':' operator
  if (stream.eat(":")) {
    if (stream.eat("\"")) {
      return chain(tokenQuote("\"", "atom", false), stream, state);
    } else if (stream.match(idents) || stream.match(types) ||
               stream.match(operators) || stream.match(conditionalOperators) || stream.match(indexingOperators)) {
      return "atom";
    }
    stream.eat(":");
    return "operator";
  }

  // Strings
  if (stream.eat("\"")) {
    return chain(tokenQuote("\"", "string", true), stream, state);
  }

  // Strings or regexps or macro variables or '%' operator
  if (stream.peek() == "%") {
    var style = "string";
    var embed = true;
    var delim;

    if (stream.match("%r")) {
      // Regexps
      style = "string.special";
      delim = stream.next();
    } else if (stream.match("%w")) {
      embed = false;
      delim = stream.next();
    } else if (stream.match("%q")) {
      embed = false;
      delim = stream.next();
    } else {
      if(delim = stream.match(/^%([^\w\s=])/)) {
        delim = delim[1];
      } else if (stream.match(/^%[a-zA-Z_\u009F-\uFFFF][\w\u009F-\uFFFF]*/)) {
        // Macro variables
        return "meta";
      } else if (stream.eat('%')) {
        // '%' operator
        return "operator";
      }
    }

    if (matching.hasOwnProperty(delim)) {
      delim = matching[delim];
    }
    return chain(tokenQuote(delim, style, embed), stream, state);
  }

  // Here Docs
  if (matched = stream.match(/^<<-('?)([A-Z]\w*)\1/)) {
    return chain(tokenHereDoc(matched[2], !matched[1]), stream, state)
  }

  // Characters
  if (stream.eat("'")) {
    stream.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);
    stream.eat("'");
    return "atom";
  }

  // Numbers
  if (stream.eat("0")) {
    if (stream.eat("x")) {
      stream.match(/^[0-9a-fA-F_]+/);
    } else if (stream.eat("o")) {
      stream.match(/^[0-7_]+/);
    } else if (stream.eat("b")) {
      stream.match(/^[01_]+/);
    }
    return "number";
  }

  if (stream.eat(/^\d/)) {
    stream.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+-]?\d+)?/);
    return "number";
  }

  // Operators
  if (stream.match(operators)) {
    stream.eat("="); // Operators can follow assign symbol.
    return "operator";
  }

  if (stream.match(conditionalOperators) || stream.match(anotherOperators)) {
    return "operator";
  }

  // Parens and braces
  if (matched = stream.match(/[({[]/, false)) {
    matched = matched[0];
    return chain(tokenNest(matched, matching[matched], null), stream, state);
  }

  // Escapes
  if (stream.eat("\\")) {
    stream.next();
    return "meta";
  }

  stream.next();
  return null;
}

function tokenNest(begin, end, style, started) {
  return function (stream, state) {
    if (!started && stream.match(begin)) {
      state.tokenize[state.tokenize.length - 1] = tokenNest(begin, end, style, true);
      state.currentIndent += 1;
      return style;
    }

    var nextStyle = tokenBase(stream, state);
    if (stream.current() === end) {
      state.tokenize.pop();
      state.currentIndent -= 1;
      nextStyle = style;
    }

    return nextStyle;
  };
}

function tokenMacro(begin, end, started) {
  return function (stream, state) {
    if (!started && stream.match("{" + begin)) {
      state.currentIndent += 1;
      state.tokenize[state.tokenize.length - 1] = tokenMacro(begin, end, true);
      return "meta";
    }

    if (stream.match(end + "}")) {
      state.currentIndent -= 1;
      state.tokenize.pop();
      return "meta";
    }

    return tokenBase(stream, state);
  };
}

function tokenMacroDef(stream, state) {
  if (stream.eatSpace()) {
    return null;
  }

  var matched;
  if (matched = stream.match(idents)) {
    if (matched == "def") {
      return "keyword";
    }
    stream.eat(/[?!]/);
  }

  state.tokenize.pop();
  return "def";
}

function tokenFollowIdent(stream, state) {
  if (stream.eatSpace()) {
    return null;
  }

  if (stream.match(idents)) {
    stream.eat(/[!?]/);
  } else {
    stream.match(operators) || stream.match(conditionalOperators) || stream.match(indexingOperators);
  }
  state.tokenize.pop();
  return "def";
}

function tokenFollowType(stream, state) {
  if (stream.eatSpace()) {
    return null;
  }

  stream.match(types);
  state.tokenize.pop();
  return "def";
}

function tokenQuote(end, style, embed) {
  return function (stream, state) {
    var escaped = false;

    while (stream.peek()) {
      if (!escaped) {
        if (stream.match("{%", false)) {
          state.tokenize.push(tokenMacro("%", "%"));
          return style;
        }

        if (stream.match("{{", false)) {
          state.tokenize.push(tokenMacro("{", "}"));
          return style;
        }

        if (embed && stream.match("#{", false)) {
          state.tokenize.push(tokenNest("#{", "}", "meta"));
          return style;
        }

        var ch = stream.next();

        if (ch == end) {
          state.tokenize.pop();
          return style;
        }

        escaped = embed && ch == "\\";
      } else {
        stream.next();
        escaped = false;
      }
    }

    return style;
  };
}

function tokenHereDoc(phrase, embed) {
  return function (stream, state) {
    if (stream.sol()) {
      stream.eatSpace()
      if (stream.match(phrase)) {
        state.tokenize.pop();
        return "string";
      }
    }

    var escaped = false;
    while (stream.peek()) {
      if (!escaped) {
        if (stream.match("{%", false)) {
          state.tokenize.push(tokenMacro("%", "%"));
          return "string";
        }

        if (stream.match("{{", false)) {
          state.tokenize.push(tokenMacro("{", "}"));
          return "string";
        }

        if (embed && stream.match("#{", false)) {
          state.tokenize.push(tokenNest("#{", "}", "meta"));
          return "string";
        }

        escaped = stream.next() == "\\" && embed;
      } else {
        stream.next();
        escaped = false;
      }
    }

    return "string";
  }
}

const crystal = {
  name: "crystal",
  startState: function () {
    return {
      tokenize: [tokenBase],
      currentIndent: 0,
      lastToken: null,
      lastStyle: null,
      blocks: []
    };
  },

  token: function (stream, state) {
    var style = state.tokenize[state.tokenize.length - 1](stream, state);
    var token = stream.current();

    if (style && style != "comment") {
      state.lastToken = token;
      state.lastStyle = style;
    }

    return style;
  },

  indent: function (state, textAfter, cx) {
    textAfter = textAfter.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g, "");

    if (dedentKeywords.test(textAfter) || dedentPunctuals.test(textAfter)) {
      return cx.unit * (state.currentIndent - 1);
    }

    return cx.unit * state.currentIndent;
  },

  languageData: {
    indentOnInput: wordRegExp(dedentPunctualsArray.concat(dedentKeywordsArray), true),
    commentTokens: {line: "#"}
  }
};


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfY29kZW1pcnJvcl9sZWdhY3ktbW9kZXNfbW9kZV9jcnlzdGFsX2pzLmYwZmU0MzQzZWFlYWYyNTY0MTlhLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMENBQTBDLEVBQUU7QUFDNUMsNERBQTRELEVBQUU7QUFDOUQ7QUFDQSxvQ0FBb0MsRUFBRTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFlBQVksS0FBSzs7QUFFakM7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTs7QUFFQSxpREFBaUQ7QUFDakQsOEJBQThCLEtBQUs7QUFDbkM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG1EQUFtRCxFQUFFLGlCQUFpQixFQUFFLEdBQUcsWUFBWSxJQUFJLEVBQUU7QUFDN0Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG1DQUFtQztBQUNuQztBQUNBO0FBQ0E7QUFDQTs7QUFFQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBOztBQUVBLDRCQUE0QjtBQUM1QiwyQ0FBMkMsS0FBSztBQUNoRDtBQUNBOztBQUVBLHFDQUFxQztBQUNyQywyQ0FBMkMsS0FBSztBQUNoRDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTs7QUFFQSw0QkFBNEI7QUFDNUIsMkNBQTJDLEtBQUs7QUFDaEQ7QUFDQTs7QUFFQSxxQ0FBcUM7QUFDckMsMkNBQTJDLEtBQUs7QUFDaEQ7QUFDQTs7QUFFQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSw0Q0FBNEMsZ0JBQWdCOztBQUU1RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL0BqdXB5dGVybGFiL2FwcGxpY2F0aW9uLXRvcC8uL25vZGVfbW9kdWxlcy9AY29kZW1pcnJvci9sZWdhY3ktbW9kZXMvbW9kZS9jcnlzdGFsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHdvcmRSZWdFeHAod29yZHMsIGVuZCkge1xuICByZXR1cm4gbmV3IFJlZ0V4cCgoZW5kID8gXCJcIiA6IFwiXlwiKSArIFwiKD86XCIgKyB3b3Jkcy5qb2luKFwifFwiKSArIFwiKVwiICsgKGVuZCA/IFwiJFwiIDogXCJcXFxcYlwiKSk7XG59XG5cbmZ1bmN0aW9uIGNoYWluKHRva2VuaXplLCBzdHJlYW0sIHN0YXRlKSB7XG4gIHN0YXRlLnRva2VuaXplLnB1c2godG9rZW5pemUpO1xuICByZXR1cm4gdG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7XG59XG5cbnZhciBvcGVyYXRvcnMgPSAvXig/OlstKy8lfCZeXXxcXCpcXCo/fFs8Pl17Mn0pLztcbnZhciBjb25kaXRpb25hbE9wZXJhdG9ycyA9IC9eKD86Wz0hXX58PT09fDw9PnxbPD49IV09P3xbfCZdezJ9fH4pLztcbnZhciBpbmRleGluZ09wZXJhdG9ycyA9IC9eKD86XFxbXFxdWz89XT8pLztcbnZhciBhbm90aGVyT3BlcmF0b3JzID0gL14oPzpcXC4oPzpcXC57Mn0pP3wtPnxbPzpdKS87XG52YXIgaWRlbnRzID0gL15bYS16X1xcdTAwOUYtXFx1RkZGRl1bYS16QS1aMC05X1xcdTAwOUYtXFx1RkZGRl0qLztcbnZhciB0eXBlcyA9IC9eW0EtWl9cXHUwMDlGLVxcdUZGRkZdW2EtekEtWjAtOV9cXHUwMDlGLVxcdUZGRkZdKi87XG52YXIga2V5d29yZHMgPSB3b3JkUmVnRXhwKFtcbiAgXCJhYnN0cmFjdFwiLCBcImFsaWFzXCIsIFwiYXNcIiwgXCJhc21cIiwgXCJiZWdpblwiLCBcImJyZWFrXCIsIFwiY2FzZVwiLCBcImNsYXNzXCIsIFwiZGVmXCIsIFwiZG9cIixcbiAgXCJlbHNlXCIsIFwiZWxzaWZcIiwgXCJlbmRcIiwgXCJlbnN1cmVcIiwgXCJlbnVtXCIsIFwiZXh0ZW5kXCIsIFwiZm9yXCIsIFwiZnVuXCIsIFwiaWZcIixcbiAgXCJpbmNsdWRlXCIsIFwiaW5zdGFuY2Vfc2l6ZW9mXCIsIFwibGliXCIsIFwibWFjcm9cIiwgXCJtb2R1bGVcIiwgXCJuZXh0XCIsIFwib2ZcIiwgXCJvdXRcIiwgXCJwb2ludGVyb2ZcIixcbiAgXCJwcml2YXRlXCIsIFwicHJvdGVjdGVkXCIsIFwicmVzY3VlXCIsIFwicmV0dXJuXCIsIFwicmVxdWlyZVwiLCBcInNlbGVjdFwiLCBcInNpemVvZlwiLCBcInN0cnVjdFwiLFxuICBcInN1cGVyXCIsIFwidGhlblwiLCBcInR5cGVcIiwgXCJ0eXBlb2ZcIiwgXCJ1bmluaXRpYWxpemVkXCIsIFwidW5pb25cIiwgXCJ1bmxlc3NcIiwgXCJ1bnRpbFwiLCBcIndoZW5cIiwgXCJ3aGlsZVwiLCBcIndpdGhcIixcbiAgXCJ5aWVsZFwiLCBcIl9fRElSX19cIiwgXCJfX0VORF9MSU5FX19cIiwgXCJfX0ZJTEVfX1wiLCBcIl9fTElORV9fXCJcbl0pO1xudmFyIGF0b21Xb3JkcyA9IHdvcmRSZWdFeHAoW1widHJ1ZVwiLCBcImZhbHNlXCIsIFwibmlsXCIsIFwic2VsZlwiXSk7XG52YXIgaW5kZW50S2V5d29yZHNBcnJheSA9IFtcbiAgXCJkZWZcIiwgXCJmdW5cIiwgXCJtYWNyb1wiLFxuICBcImNsYXNzXCIsIFwibW9kdWxlXCIsIFwic3RydWN0XCIsIFwibGliXCIsIFwiZW51bVwiLCBcInVuaW9uXCIsXG4gIFwiZG9cIiwgXCJmb3JcIlxuXTtcbnZhciBpbmRlbnRLZXl3b3JkcyA9IHdvcmRSZWdFeHAoaW5kZW50S2V5d29yZHNBcnJheSk7XG52YXIgaW5kZW50RXhwcmVzc2lvbktleXdvcmRzQXJyYXkgPSBbXCJpZlwiLCBcInVubGVzc1wiLCBcImNhc2VcIiwgXCJ3aGlsZVwiLCBcInVudGlsXCIsIFwiYmVnaW5cIiwgXCJ0aGVuXCJdO1xudmFyIGluZGVudEV4cHJlc3Npb25LZXl3b3JkcyA9IHdvcmRSZWdFeHAoaW5kZW50RXhwcmVzc2lvbktleXdvcmRzQXJyYXkpO1xudmFyIGRlZGVudEtleXdvcmRzQXJyYXkgPSBbXCJlbmRcIiwgXCJlbHNlXCIsIFwiZWxzaWZcIiwgXCJyZXNjdWVcIiwgXCJlbnN1cmVcIl07XG52YXIgZGVkZW50S2V5d29yZHMgPSB3b3JkUmVnRXhwKGRlZGVudEtleXdvcmRzQXJyYXkpO1xudmFyIGRlZGVudFB1bmN0dWFsc0FycmF5ID0gW1wiXFxcXClcIiwgXCJcXFxcfVwiLCBcIlxcXFxdXCJdO1xudmFyIGRlZGVudFB1bmN0dWFscyA9IG5ldyBSZWdFeHAoXCJeKD86XCIgKyBkZWRlbnRQdW5jdHVhbHNBcnJheS5qb2luKFwifFwiKSArIFwiKSRcIik7XG52YXIgbmV4dFRva2VuaXplciA9IHtcbiAgXCJkZWZcIjogdG9rZW5Gb2xsb3dJZGVudCwgXCJmdW5cIjogdG9rZW5Gb2xsb3dJZGVudCwgXCJtYWNyb1wiOiB0b2tlbk1hY3JvRGVmLFxuICBcImNsYXNzXCI6IHRva2VuRm9sbG93VHlwZSwgXCJtb2R1bGVcIjogdG9rZW5Gb2xsb3dUeXBlLCBcInN0cnVjdFwiOiB0b2tlbkZvbGxvd1R5cGUsXG4gIFwibGliXCI6IHRva2VuRm9sbG93VHlwZSwgXCJlbnVtXCI6IHRva2VuRm9sbG93VHlwZSwgXCJ1bmlvblwiOiB0b2tlbkZvbGxvd1R5cGVcbn07XG52YXIgbWF0Y2hpbmcgPSB7XCJbXCI6IFwiXVwiLCBcIntcIjogXCJ9XCIsIFwiKFwiOiBcIilcIiwgXCI8XCI6IFwiPlwifTtcblxuZnVuY3Rpb24gdG9rZW5CYXNlKHN0cmVhbSwgc3RhdGUpIHtcbiAgaWYgKHN0cmVhbS5lYXRTcGFjZSgpKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvLyBNYWNyb3NcbiAgaWYgKHN0YXRlLmxhc3RUb2tlbiAhPSBcIlxcXFxcIiAmJiBzdHJlYW0ubWF0Y2goXCJ7JVwiLCBmYWxzZSkpIHtcbiAgICByZXR1cm4gY2hhaW4odG9rZW5NYWNybyhcIiVcIiwgXCIlXCIpLCBzdHJlYW0sIHN0YXRlKTtcbiAgfVxuXG4gIGlmIChzdGF0ZS5sYXN0VG9rZW4gIT0gXCJcXFxcXCIgJiYgc3RyZWFtLm1hdGNoKFwie3tcIiwgZmFsc2UpKSB7XG4gICAgcmV0dXJuIGNoYWluKHRva2VuTWFjcm8oXCJ7XCIsIFwifVwiKSwgc3RyZWFtLCBzdGF0ZSk7XG4gIH1cblxuICAvLyBDb21tZW50c1xuICBpZiAoc3RyZWFtLnBlZWsoKSA9PSBcIiNcIikge1xuICAgIHN0cmVhbS5za2lwVG9FbmQoKTtcbiAgICByZXR1cm4gXCJjb21tZW50XCI7XG4gIH1cblxuICAvLyBWYXJpYWJsZXMgYW5kIGtleXdvcmRzXG4gIHZhciBtYXRjaGVkO1xuICBpZiAoc3RyZWFtLm1hdGNoKGlkZW50cykpIHtcbiAgICBzdHJlYW0uZWF0KC9bPyFdLyk7XG5cbiAgICBtYXRjaGVkID0gc3RyZWFtLmN1cnJlbnQoKTtcbiAgICBpZiAoc3RyZWFtLmVhdChcIjpcIikpIHtcbiAgICAgIHJldHVybiBcImF0b21cIjtcbiAgICB9IGVsc2UgaWYgKHN0YXRlLmxhc3RUb2tlbiA9PSBcIi5cIikge1xuICAgICAgcmV0dXJuIFwicHJvcGVydHlcIjtcbiAgICB9IGVsc2UgaWYgKGtleXdvcmRzLnRlc3QobWF0Y2hlZCkpIHtcbiAgICAgIGlmIChpbmRlbnRLZXl3b3Jkcy50ZXN0KG1hdGNoZWQpKSB7XG4gICAgICAgIGlmICghKG1hdGNoZWQgPT0gXCJmdW5cIiAmJiBzdGF0ZS5ibG9ja3MuaW5kZXhPZihcImxpYlwiKSA+PSAwKSAmJiAhKG1hdGNoZWQgPT0gXCJkZWZcIiAmJiBzdGF0ZS5sYXN0VG9rZW4gPT0gXCJhYnN0cmFjdFwiKSkge1xuICAgICAgICAgIHN0YXRlLmJsb2Nrcy5wdXNoKG1hdGNoZWQpO1xuICAgICAgICAgIHN0YXRlLmN1cnJlbnRJbmRlbnQgKz0gMTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgoc3RhdGUubGFzdFN0eWxlID09IFwib3BlcmF0b3JcIiB8fCAhc3RhdGUubGFzdFN0eWxlKSAmJiBpbmRlbnRFeHByZXNzaW9uS2V5d29yZHMudGVzdChtYXRjaGVkKSkge1xuICAgICAgICBzdGF0ZS5ibG9ja3MucHVzaChtYXRjaGVkKTtcbiAgICAgICAgc3RhdGUuY3VycmVudEluZGVudCArPSAxO1xuICAgICAgfSBlbHNlIGlmIChtYXRjaGVkID09IFwiZW5kXCIpIHtcbiAgICAgICAgc3RhdGUuYmxvY2tzLnBvcCgpO1xuICAgICAgICBzdGF0ZS5jdXJyZW50SW5kZW50IC09IDE7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZXh0VG9rZW5pemVyLmhhc093blByb3BlcnR5KG1hdGNoZWQpKSB7XG4gICAgICAgIHN0YXRlLnRva2VuaXplLnB1c2gobmV4dFRva2VuaXplclttYXRjaGVkXSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBcImtleXdvcmRcIjtcbiAgICB9IGVsc2UgaWYgKGF0b21Xb3Jkcy50ZXN0KG1hdGNoZWQpKSB7XG4gICAgICByZXR1cm4gXCJhdG9tXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwidmFyaWFibGVcIjtcbiAgfVxuXG4gIC8vIENsYXNzIHZhcmlhYmxlcyBhbmQgaW5zdGFuY2UgdmFyaWFibGVzXG4gIC8vIG9yIGF0dHJpYnV0ZXNcbiAgaWYgKHN0cmVhbS5lYXQoXCJAXCIpKSB7XG4gICAgaWYgKHN0cmVhbS5wZWVrKCkgPT0gXCJbXCIpIHtcbiAgICAgIHJldHVybiBjaGFpbih0b2tlbk5lc3QoXCJbXCIsIFwiXVwiLCBcIm1ldGFcIiksIHN0cmVhbSwgc3RhdGUpO1xuICAgIH1cblxuICAgIHN0cmVhbS5lYXQoXCJAXCIpO1xuICAgIHN0cmVhbS5tYXRjaChpZGVudHMpIHx8IHN0cmVhbS5tYXRjaCh0eXBlcyk7XG4gICAgcmV0dXJuIFwicHJvcGVydHlOYW1lXCI7XG4gIH1cblxuICAvLyBDb25zdGFudHMgYW5kIHR5cGVzXG4gIGlmIChzdHJlYW0ubWF0Y2godHlwZXMpKSB7XG4gICAgcmV0dXJuIFwidGFnXCI7XG4gIH1cblxuICAvLyBTeW1ib2xzIG9yICc6JyBvcGVyYXRvclxuICBpZiAoc3RyZWFtLmVhdChcIjpcIikpIHtcbiAgICBpZiAoc3RyZWFtLmVhdChcIlxcXCJcIikpIHtcbiAgICAgIHJldHVybiBjaGFpbih0b2tlblF1b3RlKFwiXFxcIlwiLCBcImF0b21cIiwgZmFsc2UpLCBzdHJlYW0sIHN0YXRlKTtcbiAgICB9IGVsc2UgaWYgKHN0cmVhbS5tYXRjaChpZGVudHMpIHx8IHN0cmVhbS5tYXRjaCh0eXBlcykgfHxcbiAgICAgICAgICAgICAgIHN0cmVhbS5tYXRjaChvcGVyYXRvcnMpIHx8IHN0cmVhbS5tYXRjaChjb25kaXRpb25hbE9wZXJhdG9ycykgfHwgc3RyZWFtLm1hdGNoKGluZGV4aW5nT3BlcmF0b3JzKSkge1xuICAgICAgcmV0dXJuIFwiYXRvbVwiO1xuICAgIH1cbiAgICBzdHJlYW0uZWF0KFwiOlwiKTtcbiAgICByZXR1cm4gXCJvcGVyYXRvclwiO1xuICB9XG5cbiAgLy8gU3RyaW5nc1xuICBpZiAoc3RyZWFtLmVhdChcIlxcXCJcIikpIHtcbiAgICByZXR1cm4gY2hhaW4odG9rZW5RdW90ZShcIlxcXCJcIiwgXCJzdHJpbmdcIiwgdHJ1ZSksIHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgLy8gU3RyaW5ncyBvciByZWdleHBzIG9yIG1hY3JvIHZhcmlhYmxlcyBvciAnJScgb3BlcmF0b3JcbiAgaWYgKHN0cmVhbS5wZWVrKCkgPT0gXCIlXCIpIHtcbiAgICB2YXIgc3R5bGUgPSBcInN0cmluZ1wiO1xuICAgIHZhciBlbWJlZCA9IHRydWU7XG4gICAgdmFyIGRlbGltO1xuXG4gICAgaWYgKHN0cmVhbS5tYXRjaChcIiVyXCIpKSB7XG4gICAgICAvLyBSZWdleHBzXG4gICAgICBzdHlsZSA9IFwic3RyaW5nLnNwZWNpYWxcIjtcbiAgICAgIGRlbGltID0gc3RyZWFtLm5leHQoKTtcbiAgICB9IGVsc2UgaWYgKHN0cmVhbS5tYXRjaChcIiV3XCIpKSB7XG4gICAgICBlbWJlZCA9IGZhbHNlO1xuICAgICAgZGVsaW0gPSBzdHJlYW0ubmV4dCgpO1xuICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKFwiJXFcIikpIHtcbiAgICAgIGVtYmVkID0gZmFsc2U7XG4gICAgICBkZWxpbSA9IHN0cmVhbS5uZXh0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKGRlbGltID0gc3RyZWFtLm1hdGNoKC9eJShbXlxcd1xccz1dKS8pKSB7XG4gICAgICAgIGRlbGltID0gZGVsaW1bMV07XG4gICAgICB9IGVsc2UgaWYgKHN0cmVhbS5tYXRjaCgvXiVbYS16QS1aX1xcdTAwOUYtXFx1RkZGRl1bXFx3XFx1MDA5Ri1cXHVGRkZGXSovKSkge1xuICAgICAgICAvLyBNYWNybyB2YXJpYWJsZXNcbiAgICAgICAgcmV0dXJuIFwibWV0YVwiO1xuICAgICAgfSBlbHNlIGlmIChzdHJlYW0uZWF0KCclJykpIHtcbiAgICAgICAgLy8gJyUnIG9wZXJhdG9yXG4gICAgICAgIHJldHVybiBcIm9wZXJhdG9yXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1hdGNoaW5nLmhhc093blByb3BlcnR5KGRlbGltKSkge1xuICAgICAgZGVsaW0gPSBtYXRjaGluZ1tkZWxpbV07XG4gICAgfVxuICAgIHJldHVybiBjaGFpbih0b2tlblF1b3RlKGRlbGltLCBzdHlsZSwgZW1iZWQpLCBzdHJlYW0sIHN0YXRlKTtcbiAgfVxuXG4gIC8vIEhlcmUgRG9jc1xuICBpZiAobWF0Y2hlZCA9IHN0cmVhbS5tYXRjaCgvXjw8LSgnPykoW0EtWl1cXHcqKVxcMS8pKSB7XG4gICAgcmV0dXJuIGNoYWluKHRva2VuSGVyZURvYyhtYXRjaGVkWzJdLCAhbWF0Y2hlZFsxXSksIHN0cmVhbSwgc3RhdGUpXG4gIH1cblxuICAvLyBDaGFyYWN0ZXJzXG4gIGlmIChzdHJlYW0uZWF0KFwiJ1wiKSkge1xuICAgIHN0cmVhbS5tYXRjaCgvXig/OlteJ118XFxcXCg/OltiZWZucnR2MCdcIl18WzAtN117M318dSg/OlswLTlhLWZBLUZdezR9fFxce1swLTlhLWZBLUZdezEsNn1cXH0pKSkvKTtcbiAgICBzdHJlYW0uZWF0KFwiJ1wiKTtcbiAgICByZXR1cm4gXCJhdG9tXCI7XG4gIH1cblxuICAvLyBOdW1iZXJzXG4gIGlmIChzdHJlYW0uZWF0KFwiMFwiKSkge1xuICAgIGlmIChzdHJlYW0uZWF0KFwieFwiKSkge1xuICAgICAgc3RyZWFtLm1hdGNoKC9eWzAtOWEtZkEtRl9dKy8pO1xuICAgIH0gZWxzZSBpZiAoc3RyZWFtLmVhdChcIm9cIikpIHtcbiAgICAgIHN0cmVhbS5tYXRjaCgvXlswLTdfXSsvKTtcbiAgICB9IGVsc2UgaWYgKHN0cmVhbS5lYXQoXCJiXCIpKSB7XG4gICAgICBzdHJlYW0ubWF0Y2goL15bMDFfXSsvKTtcbiAgICB9XG4gICAgcmV0dXJuIFwibnVtYmVyXCI7XG4gIH1cblxuICBpZiAoc3RyZWFtLmVhdCgvXlxcZC8pKSB7XG4gICAgc3RyZWFtLm1hdGNoKC9eW1xcZF9dKig/OlxcLltcXGRfXSspPyg/OltlRV1bKy1dP1xcZCspPy8pO1xuICAgIHJldHVybiBcIm51bWJlclwiO1xuICB9XG5cbiAgLy8gT3BlcmF0b3JzXG4gIGlmIChzdHJlYW0ubWF0Y2gob3BlcmF0b3JzKSkge1xuICAgIHN0cmVhbS5lYXQoXCI9XCIpOyAvLyBPcGVyYXRvcnMgY2FuIGZvbGxvdyBhc3NpZ24gc3ltYm9sLlxuICAgIHJldHVybiBcIm9wZXJhdG9yXCI7XG4gIH1cblxuICBpZiAoc3RyZWFtLm1hdGNoKGNvbmRpdGlvbmFsT3BlcmF0b3JzKSB8fCBzdHJlYW0ubWF0Y2goYW5vdGhlck9wZXJhdG9ycykpIHtcbiAgICByZXR1cm4gXCJvcGVyYXRvclwiO1xuICB9XG5cbiAgLy8gUGFyZW5zIGFuZCBicmFjZXNcbiAgaWYgKG1hdGNoZWQgPSBzdHJlYW0ubWF0Y2goL1soe1tdLywgZmFsc2UpKSB7XG4gICAgbWF0Y2hlZCA9IG1hdGNoZWRbMF07XG4gICAgcmV0dXJuIGNoYWluKHRva2VuTmVzdChtYXRjaGVkLCBtYXRjaGluZ1ttYXRjaGVkXSwgbnVsbCksIHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgLy8gRXNjYXBlc1xuICBpZiAoc3RyZWFtLmVhdChcIlxcXFxcIikpIHtcbiAgICBzdHJlYW0ubmV4dCgpO1xuICAgIHJldHVybiBcIm1ldGFcIjtcbiAgfVxuXG4gIHN0cmVhbS5uZXh0KCk7XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiB0b2tlbk5lc3QoYmVnaW4sIGVuZCwgc3R5bGUsIHN0YXJ0ZWQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKCFzdGFydGVkICYmIHN0cmVhbS5tYXRjaChiZWdpbikpIHtcbiAgICAgIHN0YXRlLnRva2VuaXplW3N0YXRlLnRva2VuaXplLmxlbmd0aCAtIDFdID0gdG9rZW5OZXN0KGJlZ2luLCBlbmQsIHN0eWxlLCB0cnVlKTtcbiAgICAgIHN0YXRlLmN1cnJlbnRJbmRlbnQgKz0gMTtcbiAgICAgIHJldHVybiBzdHlsZTtcbiAgICB9XG5cbiAgICB2YXIgbmV4dFN0eWxlID0gdG9rZW5CYXNlKHN0cmVhbSwgc3RhdGUpO1xuICAgIGlmIChzdHJlYW0uY3VycmVudCgpID09PSBlbmQpIHtcbiAgICAgIHN0YXRlLnRva2VuaXplLnBvcCgpO1xuICAgICAgc3RhdGUuY3VycmVudEluZGVudCAtPSAxO1xuICAgICAgbmV4dFN0eWxlID0gc3R5bGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5leHRTdHlsZTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gdG9rZW5NYWNybyhiZWdpbiwgZW5kLCBzdGFydGVkKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmICghc3RhcnRlZCAmJiBzdHJlYW0ubWF0Y2goXCJ7XCIgKyBiZWdpbikpIHtcbiAgICAgIHN0YXRlLmN1cnJlbnRJbmRlbnQgKz0gMTtcbiAgICAgIHN0YXRlLnRva2VuaXplW3N0YXRlLnRva2VuaXplLmxlbmd0aCAtIDFdID0gdG9rZW5NYWNybyhiZWdpbiwgZW5kLCB0cnVlKTtcbiAgICAgIHJldHVybiBcIm1ldGFcIjtcbiAgICB9XG5cbiAgICBpZiAoc3RyZWFtLm1hdGNoKGVuZCArIFwifVwiKSkge1xuICAgICAgc3RhdGUuY3VycmVudEluZGVudCAtPSAxO1xuICAgICAgc3RhdGUudG9rZW5pemUucG9wKCk7XG4gICAgICByZXR1cm4gXCJtZXRhXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRva2VuQmFzZShzdHJlYW0sIHN0YXRlKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gdG9rZW5NYWNyb0RlZihzdHJlYW0sIHN0YXRlKSB7XG4gIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdmFyIG1hdGNoZWQ7XG4gIGlmIChtYXRjaGVkID0gc3RyZWFtLm1hdGNoKGlkZW50cykpIHtcbiAgICBpZiAobWF0Y2hlZCA9PSBcImRlZlwiKSB7XG4gICAgICByZXR1cm4gXCJrZXl3b3JkXCI7XG4gICAgfVxuICAgIHN0cmVhbS5lYXQoL1s/IV0vKTtcbiAgfVxuXG4gIHN0YXRlLnRva2VuaXplLnBvcCgpO1xuICByZXR1cm4gXCJkZWZcIjtcbn1cblxuZnVuY3Rpb24gdG9rZW5Gb2xsb3dJZGVudChzdHJlYW0sIHN0YXRlKSB7XG4gIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKHN0cmVhbS5tYXRjaChpZGVudHMpKSB7XG4gICAgc3RyZWFtLmVhdCgvWyE/XS8pO1xuICB9IGVsc2Uge1xuICAgIHN0cmVhbS5tYXRjaChvcGVyYXRvcnMpIHx8IHN0cmVhbS5tYXRjaChjb25kaXRpb25hbE9wZXJhdG9ycykgfHwgc3RyZWFtLm1hdGNoKGluZGV4aW5nT3BlcmF0b3JzKTtcbiAgfVxuICBzdGF0ZS50b2tlbml6ZS5wb3AoKTtcbiAgcmV0dXJuIFwiZGVmXCI7XG59XG5cbmZ1bmN0aW9uIHRva2VuRm9sbG93VHlwZShzdHJlYW0sIHN0YXRlKSB7XG4gIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc3RyZWFtLm1hdGNoKHR5cGVzKTtcbiAgc3RhdGUudG9rZW5pemUucG9wKCk7XG4gIHJldHVybiBcImRlZlwiO1xufVxuXG5mdW5jdGlvbiB0b2tlblF1b3RlKGVuZCwgc3R5bGUsIGVtYmVkKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoc3RyZWFtLCBzdGF0ZSkge1xuICAgIHZhciBlc2NhcGVkID0gZmFsc2U7XG5cbiAgICB3aGlsZSAoc3RyZWFtLnBlZWsoKSkge1xuICAgICAgaWYgKCFlc2NhcGVkKSB7XG4gICAgICAgIGlmIChzdHJlYW0ubWF0Y2goXCJ7JVwiLCBmYWxzZSkpIHtcbiAgICAgICAgICBzdGF0ZS50b2tlbml6ZS5wdXNoKHRva2VuTWFjcm8oXCIlXCIsIFwiJVwiKSk7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaChcInt7XCIsIGZhbHNlKSkge1xuICAgICAgICAgIHN0YXRlLnRva2VuaXplLnB1c2godG9rZW5NYWNybyhcIntcIiwgXCJ9XCIpKTtcbiAgICAgICAgICByZXR1cm4gc3R5bGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW1iZWQgJiYgc3RyZWFtLm1hdGNoKFwiI3tcIiwgZmFsc2UpKSB7XG4gICAgICAgICAgc3RhdGUudG9rZW5pemUucHVzaCh0b2tlbk5lc3QoXCIje1wiLCBcIn1cIiwgXCJtZXRhXCIpKTtcbiAgICAgICAgICByZXR1cm4gc3R5bGU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgICAgIGlmIChjaCA9PSBlbmQpIHtcbiAgICAgICAgICBzdGF0ZS50b2tlbml6ZS5wb3AoKTtcbiAgICAgICAgICByZXR1cm4gc3R5bGU7XG4gICAgICAgIH1cblxuICAgICAgICBlc2NhcGVkID0gZW1iZWQgJiYgY2ggPT0gXCJcXFxcXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdHJlYW0ubmV4dCgpO1xuICAgICAgICBlc2NhcGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0eWxlO1xuICB9O1xufVxuXG5mdW5jdGlvbiB0b2tlbkhlcmVEb2MocGhyYXNlLCBlbWJlZCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLnNvbCgpKSB7XG4gICAgICBzdHJlYW0uZWF0U3BhY2UoKVxuICAgICAgaWYgKHN0cmVhbS5tYXRjaChwaHJhc2UpKSB7XG4gICAgICAgIHN0YXRlLnRva2VuaXplLnBvcCgpO1xuICAgICAgICByZXR1cm4gXCJzdHJpbmdcIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZXNjYXBlZCA9IGZhbHNlO1xuICAgIHdoaWxlIChzdHJlYW0ucGVlaygpKSB7XG4gICAgICBpZiAoIWVzY2FwZWQpIHtcbiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaChcInslXCIsIGZhbHNlKSkge1xuICAgICAgICAgIHN0YXRlLnRva2VuaXplLnB1c2godG9rZW5NYWNybyhcIiVcIiwgXCIlXCIpKTtcbiAgICAgICAgICByZXR1cm4gXCJzdHJpbmdcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdHJlYW0ubWF0Y2goXCJ7e1wiLCBmYWxzZSkpIHtcbiAgICAgICAgICBzdGF0ZS50b2tlbml6ZS5wdXNoKHRva2VuTWFjcm8oXCJ7XCIsIFwifVwiKSk7XG4gICAgICAgICAgcmV0dXJuIFwic3RyaW5nXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW1iZWQgJiYgc3RyZWFtLm1hdGNoKFwiI3tcIiwgZmFsc2UpKSB7XG4gICAgICAgICAgc3RhdGUudG9rZW5pemUucHVzaCh0b2tlbk5lc3QoXCIje1wiLCBcIn1cIiwgXCJtZXRhXCIpKTtcbiAgICAgICAgICByZXR1cm4gXCJzdHJpbmdcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGVzY2FwZWQgPSBzdHJlYW0ubmV4dCgpID09IFwiXFxcXFwiICYmIGVtYmVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RyZWFtLm5leHQoKTtcbiAgICAgICAgZXNjYXBlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBcInN0cmluZ1wiO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBjcnlzdGFsID0ge1xuICBuYW1lOiBcImNyeXN0YWxcIixcbiAgc3RhcnRTdGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0b2tlbml6ZTogW3Rva2VuQmFzZV0sXG4gICAgICBjdXJyZW50SW5kZW50OiAwLFxuICAgICAgbGFzdFRva2VuOiBudWxsLFxuICAgICAgbGFzdFN0eWxlOiBudWxsLFxuICAgICAgYmxvY2tzOiBbXVxuICAgIH07XG4gIH0sXG5cbiAgdG9rZW46IGZ1bmN0aW9uIChzdHJlYW0sIHN0YXRlKSB7XG4gICAgdmFyIHN0eWxlID0gc3RhdGUudG9rZW5pemVbc3RhdGUudG9rZW5pemUubGVuZ3RoIC0gMV0oc3RyZWFtLCBzdGF0ZSk7XG4gICAgdmFyIHRva2VuID0gc3RyZWFtLmN1cnJlbnQoKTtcblxuICAgIGlmIChzdHlsZSAmJiBzdHlsZSAhPSBcImNvbW1lbnRcIikge1xuICAgICAgc3RhdGUubGFzdFRva2VuID0gdG9rZW47XG4gICAgICBzdGF0ZS5sYXN0U3R5bGUgPSBzdHlsZTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3R5bGU7XG4gIH0sXG5cbiAgaW5kZW50OiBmdW5jdGlvbiAoc3RhdGUsIHRleHRBZnRlciwgY3gpIHtcbiAgICB0ZXh0QWZ0ZXIgPSB0ZXh0QWZ0ZXIucmVwbGFjZSgvXlxccyooPzpcXHslKT9cXHMqfFxccyooPzolXFx9KT9cXHMqJC9nLCBcIlwiKTtcblxuICAgIGlmIChkZWRlbnRLZXl3b3Jkcy50ZXN0KHRleHRBZnRlcikgfHwgZGVkZW50UHVuY3R1YWxzLnRlc3QodGV4dEFmdGVyKSkge1xuICAgICAgcmV0dXJuIGN4LnVuaXQgKiAoc3RhdGUuY3VycmVudEluZGVudCAtIDEpO1xuICAgIH1cblxuICAgIHJldHVybiBjeC51bml0ICogc3RhdGUuY3VycmVudEluZGVudDtcbiAgfSxcblxuICBsYW5ndWFnZURhdGE6IHtcbiAgICBpbmRlbnRPbklucHV0OiB3b3JkUmVnRXhwKGRlZGVudFB1bmN0dWFsc0FycmF5LmNvbmNhdChkZWRlbnRLZXl3b3Jkc0FycmF5KSwgdHJ1ZSksXG4gICAgY29tbWVudFRva2Vuczoge2xpbmU6IFwiI1wifVxuICB9XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9